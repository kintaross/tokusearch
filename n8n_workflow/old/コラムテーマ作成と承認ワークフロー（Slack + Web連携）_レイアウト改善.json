{
  "name": "ã‚³ãƒ©ãƒ ãƒ†ãƒ¼ãƒä½œæˆã¨æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆSlack + Webé€£æºï¼‰",
  "nodes": [
    {
      "parameters": {
        "content": "## ğŸ“‹ ã‚³ãƒ©ãƒ ãƒ†ãƒ¼ãƒä½œæˆã¨æ‰¿èªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼\n\n**æ¦‚è¦**: Slack ã¾ãŸã¯ Webã‚µã‚¤ãƒˆã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å—ã‘å–ã‚Šã€ãƒ†ãƒ¼ãƒã‚’ç”Ÿæˆãƒ»æ‰¿èªå¾Œã«è¨˜äº‹ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚\n\n**ãƒˆãƒªã‚¬ãƒ¼**:\n1. SlackTrigger: #column-request ã®ãƒ¡ãƒ³ã‚·ãƒ§ãƒ³\n2. WebhookTrigger: Webã‚µã‚¤ãƒˆã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\n\n**ãƒ•ãƒ­ãƒ¼**:\n```\nãƒ¡ãƒ³ã‚·ãƒ§ãƒ³/Webhook â†’ ãƒ†ãƒ¼ãƒç”Ÿæˆï¼ˆ1ä»¶ï¼‰ â†’ Wait + resumeUrlã§æ‰¿èªå¾…æ©Ÿ\n        â†“\nãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒœã‚¿ãƒ³ã§æ‰¿èª/å´ä¸‹ â†’ æ‰¿èªåˆ¤å®š\n        â†“\næ‰¿èª â†’ è¨˜äº‹ç”Ÿæˆ â†’ APIæŠ•ç¨¿ â†’ å®Œäº†é€šçŸ¥\nå´ä¸‹ â†’ å†ç”Ÿæˆï¼ˆæœ€å¤§2å›ï¼‰ â†’ 2å›ã¨ã‚‚å´ä¸‹ãªã‚‰ä¸­æ–­\n```\n\n**æ‰¿èªæ–¹å¼**: Wait + resumeUrlæ–¹å¼ï¼ˆå‚è€ƒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’å†ç¾ï¼‰",
        "height": 480,
        "width": 500,
        "color": 4
      },
      "id": "b8d3a25d-bf7a-48a6-8e73-ef0eede26a1b",
      "name": "ğŸ“‹ æ¦‚è¦",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -864,
        -384
      ]
    },
    {
      "parameters": {
        "content": "â‘  Slack/Webã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡",
        "height": 150,
        "width": 300,
        "color": 7
      },
      "id": "66177b75-a1d7-41bf-b6d4-1fdcbf280e41",
      "name": "StickyNote_å…¥åŠ›",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -900,
        -200
      ]
    },
    {
      "parameters": {
        "content": "â‘¡ AIã§ã‚³ãƒ©ãƒ ãƒ†ãƒ¼ãƒç”Ÿæˆï¼ˆGeminiï¼‰",
        "height": 150,
        "width": 300,
        "color": 7
      },
      "id": "2c8421c3-d5fb-4b81-b6b1-53fd797a3083",
      "name": "StickyNote_ãƒ†ãƒ¼ãƒç”Ÿæˆ",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -100,
        -200
      ]
    },
    {
      "parameters": {
        "content": "â‘¢ ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±ã‚’ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«ä¿å­˜",
        "height": 150,
        "width": 300,
        "color": 7
      },
      "id": "15a187f0-34f3-45e4-b37f-c323eb359d03",
      "name": "StickyNote_ãƒ‡ãƒ¼ã‚¿ä¿å­˜",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        650,
        -200
      ]
    },
    {
      "parameters": {
        "content": "â‘£ Slackã§ãƒ†ãƒ¼ãƒæ¡ˆã®æ‰¿èªã‚’ä¾é ¼",
        "height": 150,
        "width": 300,
        "color": 7
      },
      "id": "d406040b-2714-43cb-a97d-81d019b80c46",
      "name": "StickyNote_æ‰¿èªè¦æ±‚",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1200,
        -200
      ]
    },
    {
      "parameters": {
        "content": "â‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿”ä¿¡ã‚’AIã§åˆ¤å®šï¼ˆæ‰¿èª/ä¿®æ­£/å´ä¸‹ï¼‰",
        "height": 150,
        "width": 300,
        "color": 7
      },
      "id": "1bf9a680-9816-442e-b974-3075873c88c0",
      "name": "StickyNote_æ‰¿èªåˆ¤å®š",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        1850,
        -200
      ]
    },
    {
      "parameters": {
        "content": "â‘¥ æ‰¿èªå¾Œï¼šã‚³ãƒ©ãƒ è¨˜äº‹ç”Ÿæˆãƒ»æŠ•ç¨¿ãƒ»å®Œäº†é€šçŸ¥",
        "height": 150,
        "width": 300,
        "color": 7
      },
      "id": "ac27b06d-83b9-4042-8080-cd5aaa501ef8",
      "name": "StickyNote_è¨˜äº‹ç”Ÿæˆ",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2200,
        50
      ]
    },
    {
      "parameters": {
        "content": "â‘¦ å´ä¸‹æ™‚ï¼šãƒ†ãƒ¼ãƒå†ç”Ÿæˆï¼ˆæœ€å¤§2å›ï¼‰ã¾ãŸã¯ä¸­æ–­",
        "height": 150,
        "width": 300,
        "color": 6
      },
      "id": "68b19374-ec04-4b15-b469-258816408aaa",
      "name": "StickyNote_å†ç”Ÿæˆ",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        2200,
        -350
      ]
    },
    {
      "parameters": {
        "trigger": [
          "app_mention"
        ],
        "channelId": {
          "__rl": true,
          "value": "C0A0AAKQ7D1",
          "mode": "id",
          "cachedResultName": "column-request"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.slackTrigger",
      "typeVersion": 1,
      "position": [
        -856,
        -144
      ],
      "id": "526b25aa-686c-4d41-b14b-c9b482e58326",
      "name": "SlackTrigger",
      "webhookId": "slack-column-theme-trigger",
      "credentials": {
        "slackApi": {
          "id": "kahTvH10blaEP2kb",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// SlackTriggerã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡¦ç†\nconsole.log('ğŸ” å—ä¿¡ãƒ‡ãƒ¼ã‚¿å…¨ä½“:', JSON.stringify($json, null, 2));\n\nconst message = $json.text || $json.event?.text || '';\nconst userId = $json.user || $json.event?.user || '';\nconst channelId = $json.channel || $json.event?.channel || '';\nconst ts = $json.ts || $json.event?.ts || '';\n\nconsole.log('ğŸ“¥ Slackãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡:', message);\n\n// ãƒœãƒƒãƒˆãƒ¡ãƒ³ã‚·ãƒ§ãƒ³ã‚’é™¤å»ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡º\nlet requestText = message.replace(/<@[A-Z0-9]+>/g, '').trim();\n\nif (!requestText || requestText.length === 0) {\n  throw new Error('ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ãŒç©ºã§ã™ã€‚ãƒ†ãƒ¼ãƒã®å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');\n}\n\nconsole.log('âœ… ãƒªã‚¯ã‚¨ã‚¹ãƒˆæŠ½å‡º:', requestText);\n\nreturn [{\n  json: {\n    requestText: requestText,\n    source: 'slack',\n    userId: userId,\n    channelId: channelId,\n    messageTs: ts,\n    parent_thread_ts: ts,\n    originalMessage: message,\n    retryCount: 0\n  }\n}];"
      },
      "id": "dca2df9d-1ba0-4970-a5d3-800da8ac68ff",
      "name": "ExtractSlackRequest",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -856,
        96
      ]
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "column-request",
        "options": {}
      },
      "id": "1c486be4-309f-4921-b07e-75c2e37f8c6f",
      "name": "WebhookTrigger",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -456,
        -144
      ],
      "webhookId": "column-request-webhook"
    },
    {
      "parameters": {
        "jsCode": "// Webhookã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡º\nconst body = $json.body || $json;\nconst requestText = body.requestText || body.request || '';\n\nconsole.log('ğŸ“¥ Webhookãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä¿¡:', requestText);\n\nif (!requestText || requestText.length === 0) {\n  throw new Error('ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹ãŒç©ºã§ã™ã€‚');\n}\n\nconst channelId = 'column-request';\nconst now = new Date().toISOString();\n\nconsole.log('âœ… Webãƒªã‚¯ã‚¨ã‚¹ãƒˆæŠ½å‡º:', requestText);\n\nreturn [{\n  json: {\n    requestText: requestText,\n    source: 'web',\n    userId: 'web-user',\n    channelId: channelId,\n    messageTs: now,\n    parent_thread_ts: '',\n    originalMessage: requestText,\n    retryCount: 0\n  }\n}];"
      },
      "id": "b54fa99b-7c05-4721-ba61-2a35135f2a16",
      "name": "ExtractWebhookRequest",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -456,
        96
      ]
    },
    {
      "parameters": {},
      "id": "c151da2d-6d71-4865-8409-f825bf122fc0",
      "name": "MergeRequests",
      "type": "n8n-nodes-base.merge",
      "typeVersion": 3.2,
      "position": [
        -656,
        336
      ]
    },
    {
      "parameters": {
        "jsCode": "// ãƒ†ãƒ¼ãƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰ï¼ˆretryCountã«å¿œã˜ã¦èª¿æ•´ï¼‰\nconst requestText = $json.requestText;\nconst retryCount = $json.retryCount || 0;\nconst modificationFeedback = $json.feedback || ''; // ä¿®æ­£æŒ‡ç¤ºã‚’å–å¾—\n\nlet basePrompt = `ã‚ãªãŸã¯ãƒã‚¤æ´»ãƒ»ç¯€ç´„ãƒ¡ãƒ‡ã‚£ã‚¢ã€ŒTokuSearchã€ã®ç·¨é›†è€…ã§ã™ã€‚\n\nä»¥ä¸‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ã€å…·ä½“çš„ãªã‚³ãƒ©ãƒ è¨˜äº‹ã®ãƒ†ãƒ¼ãƒæ¡ˆã‚’1ä»¶ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚\n\n## ãƒªã‚¯ã‚¨ã‚¹ãƒˆå†…å®¹\n${requestText}\n${modificationFeedback ? `\n## ä¿®æ­£æŒ‡ç¤º\n${modificationFeedback}\nä¸Šè¨˜ã®ä¿®æ­£æŒ‡ç¤ºã‚’åæ˜ ã—ã¦ã€ãƒ†ãƒ¼ãƒã‚’æ”¹å–„ã—ã¦ãã ã•ã„ã€‚` : ''}\n\n## å‡ºåŠ›å½¢å¼ï¼ˆé‡è¦ï¼‰\nä»¥ä¸‹ã®JSONå½¢å¼ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜æ–‡ã‚„ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã¯ä¸è¦ã§ã™ã€‚\n\n{\n  \"title\": \"ãƒ†ãƒ¼ãƒã‚¿ã‚¤ãƒˆãƒ«ï¼ˆ30ã€œ50æ–‡å­—ç¨‹åº¦ã€ã‚­ãƒ£ãƒƒãƒãƒ¼ã«ï¼‰\",\n  \"level\": \"åˆå¿ƒè€…å‘ã‘\",\n  \"description\": \"ã“ã®ãƒ†ãƒ¼ãƒã§æ›¸ãè¨˜äº‹ã®æ¦‚è¦ï¼ˆ50ã€œ100æ–‡å­—ï¼‰\"\n}\n\n## ãƒ†ãƒ¼ãƒè¨­è¨ˆãƒ«ãƒ¼ãƒ«\n- ã‚¿ã‚¤ãƒˆãƒ«ã¯èª­è€…ã®èˆˆå‘³ã‚’å¼•ãå…·ä½“çš„ãªè¡¨ç¾ã«\n- ãƒ¬ãƒ™ãƒ«ã¯ã€Œåˆå¿ƒè€…å‘ã‘ã€ã€Œä¸­ç´šè€…ä»¥ä¸Šå‘ã‘ã€ã€Œä¸Šç´šè€…å‘ã‘ã€ã€Œè¶…ãƒã‚¤æ´»ç‰¹åŒ–ã€ã‹ã‚‰é¸æŠ\n- èª­è€…ãŒå®Ÿè·µã—ã‚„ã™ã„å†…å®¹ã‚’é‡è¦–\n- é•æ³•è¡Œç‚ºã‚„è¦ç´„é•åã«ã¤ãªãŒã‚‹å†…å®¹ã¯å«ã‚ãªã„`;\n\n// retryCountã«å¿œã˜ã¦ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’èª¿æ•´ï¼ˆä¿®æ­£æŒ‡ç¤ºãŒãªã„å ´åˆã®ã¿ï¼‰\nif (!modificationFeedback) {\n  if (retryCount === 1) {\n    basePrompt += `\n\n## é‡è¦ï¼š1å›ç›®ã®å†ç”Ÿæˆ\nå‰å›ã®ãƒ†ãƒ¼ãƒãŒæ‰¿èªã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ä»¥ä¸‹ã®ç‚¹ã‚’é‡è¦–ã—ã¦ã€ã‚ˆã‚Šå…·ä½“çš„ã§å®Ÿè·µçš„ãªãƒ†ãƒ¼ãƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„:\n- ã‚ˆã‚Šå…·ä½“çš„ãªæ•°å­—ã‚„äº‹ä¾‹ã‚’å«ã‚ã‚‹\n- èª­è€…ãŒã™ãã«å®Ÿè·µã§ãã‚‹å†…å®¹ã«ã™ã‚‹\n- å‰å›ã¨ã¯ç•°ãªã‚‹åˆ‡ã‚Šå£ã§ææ¡ˆã™ã‚‹`;\n  } else if (retryCount === 2) {\n    basePrompt += `\n\n## é‡è¦ï¼š2å›ç›®ã®å†ç”Ÿæˆ\n2å›ç›®ã®å†ç”Ÿæˆã§ã™ã€‚ä»¥ä¸‹ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§åˆ¥ã®è¦–ç‚¹ã‹ã‚‰ãƒ†ãƒ¼ãƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„:\n- ã‚ˆã‚ŠåŸºæœ¬çš„ãªå†…å®¹ã‹ã‚‰å§‹ã‚ã‚‹ã€ã¾ãŸã¯ã‚ˆã‚Šé«˜åº¦ãªå†…å®¹ã«æŒ‘æˆ¦ã™ã‚‹\n- ç•°ãªã‚‹ã‚¿ãƒ¼ã‚²ãƒƒãƒˆå±¤ã‚’æƒ³å®šã™ã‚‹\n- å…¨ãé•ã†è§’åº¦ã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è§£é‡ˆã™ã‚‹`;\n  }\n}\n\nbasePrompt += `\n\n## å‡ºåŠ›é–‹å§‹\nJSONã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„:`;\n\nreturn [{ json: { prompt: basePrompt, requestText, retryCount, feedback: modificationFeedback, ...($json) } }];"
      },
      "id": "7a70e171-1fec-45c1-8c32-aa2c17697149",
      "name": "BuildThemePrompt",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        0,
        -200
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list"
        },
        "messages": {
          "values": [
            {
              "content": "={{$json.prompt}}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        240,
        -200
      ],
      "id": "c63ed4c9-5305-4dea-ba0e-c260ddf0d87e",
      "name": "GenerateTheme",
      "credentials": {
        "googlePalmApi": {
          "id": "gojn353h4HLDUzF2",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Geminiã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‹ã‚‰ãƒ†ãƒ¼ãƒæ¡ˆã‚’æŠ½å‡ºï¼ˆ1ä»¶ã®ã¿ï¼‰\nconst rawText = $json.content.parts[0].text;\nconsole.log('ğŸ“¥ Geminiå‡ºåŠ›:', rawText.substring(0, 500));\n\n// JSONã‚’æŠ½å‡º\nlet jsonString = rawText.trim();\njsonString = jsonString.replace(/^```(?:json)?\\s*/i, '').replace(/\\s*```$/i, '').trim();\n\nconst jsonStart = jsonString.indexOf('{');\nconst jsonEnd = jsonString.lastIndexOf('}');\n\nif (jsonStart === -1 || jsonEnd === -1) {\n  throw new Error('JSONãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ' + rawText.substring(0, 200));\n}\n\njsonString = jsonString.substring(jsonStart, jsonEnd + 1);\n\nlet themeData;\ntry {\n  themeData = JSON.parse(jsonString);\n} catch (e) {\n  throw new Error('JSONãƒ‘ãƒ¼ã‚¹å¤±æ•—: ' + e.message);\n}\n\n// ãƒ†ãƒ¼ãƒã‚’1ä»¶ã®ã¿ã¨ã—ã¦æ‰±ã†\nif (!themeData.title) {\n  throw new Error('ãƒ†ãƒ¼ãƒã‚¿ã‚¤ãƒˆãƒ«ãŒç”Ÿæˆã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ');\n}\n\nconst theme = {\n  no: 1,\n  title: themeData.title,\n  level: themeData.level || 'åˆå¿ƒè€…å‘ã‘',\n  description: themeData.description || '',\n  retryCount: $items('BuildThemePrompt')[0].json.retryCount || 0\n};\n\nconsole.log(`âœ… ãƒ†ãƒ¼ãƒæŠ½å‡ºå®Œäº†: ${theme.title}`);\n\n// å‰ã®ãƒãƒ¼ãƒ‰ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¼•ãç¶™ã\nconst prevData = $items('BuildThemePrompt')[0].json;\n\nreturn [{\n  json: {\n    theme: theme,\n    themes: [theme], // é…åˆ—å½¢å¼ã‚‚ä¿æŒï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ã¨ã®äº’æ›æ€§ï¼‰\n    themesJson: JSON.stringify([theme]),\n    requestText: prevData.requestText,\n    source: prevData.source,\n    userId: prevData.userId,\n    channelId: prevData.channelId,\n    messageTs: prevData.messageTs,\n    parent_thread_ts: prevData.parent_thread_ts,\n    retryCount: prevData.retryCount\n  }\n}];"
      },
      "id": "32beb063-bd1f-4272-bcdb-7fef4480d411",
      "name": "ParseTheme",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        480,
        -200
      ]
    },
    {
      "parameters": {
        "jsCode": "// column_requestsã‚·ãƒ¼ãƒˆã«ä¿å­˜ã™ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™\nconst data = $json;\nconst now = new Date().toISOString();\n\n// request_idã‚’ç”Ÿæˆï¼ˆSlack ts ã¾ãŸã¯ timestampï¼‰\nconst requestId = data.messageTs || `req_${Date.now()}`;\n\nconst saveData = {\n  request_id: requestId,\n  source: data.source || 'slack',\n  channel_id: data.channelId || '',\n  thread_ts: '',\n  original_text: data.requestText || '',\n  themes_json: data.themesJson || '[]',\n  status: 'pending',\n  created_at: now,\n  parent_thread_ts: data.parent_thread_ts || ''\n};\n\nconsole.log('âœ… SaveRequestç”¨ãƒ‡ãƒ¼ã‚¿æº–å‚™å®Œäº†:', JSON.stringify(saveData, null, 2));\n\nreturn [{ json: { ...saveData, ...data } }];"
      },
      "id": "2daa22f4-4940-4eb1-9f58-d1cc16c7c3e2",
      "name": "PrepareSaveData",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        800,
        -200
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14",
          "mode": "list",
          "cachedResultName": "TokuSearch"
        },
        "sheetName": {
          "__rl": true,
          "value": "column_requests",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "request_id": "={{ $json.request_id }}",
            "source": "={{ $json.source }}",
            "channel_id": "={{ $json.channel_id }}",
            "thread_ts": "={{ $json.thread_ts }}",
            "original_text": "={{ $json.original_text }}",
            "themes_json": "={{ $json.themes_json }}",
            "status": "={{ $json.status }}",
            "created_at": "={{ $json.created_at }}",
            "parent_thread_ts": "={{ $json.parent_thread_ts }}"
          },
          "schema": [
            {
              "id": "request_id",
              "displayName": "request_id",
              "type": "string"
            },
            {
              "id": "source",
              "displayName": "source",
              "type": "string"
            },
            {
              "id": "channel_id",
              "displayName": "channel_id",
              "type": "string"
            },
            {
              "id": "thread_ts",
              "displayName": "thread_ts",
              "type": "string"
            },
            {
              "id": "original_text",
              "displayName": "original_text",
              "type": "string"
            },
            {
              "id": "themes_json",
              "displayName": "themes_json",
              "type": "string"
            },
            {
              "id": "status",
              "displayName": "status",
              "type": "string"
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "type": "string"
            },
            {
              "id": "parent_thread_ts",
              "displayName": "parent_thread_ts",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "a3308d41-d260-4f8b-847a-050751f6fe5c",
      "name": "SaveToSheet",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1040,
        -200
      ],
      "credentials": {
        "googleApi": {
          "id": "r9kAyVencycJeNjy",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Human in the loopç”¨ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ§‹ç¯‰\nconst theme = $json.theme || $items('ParseTheme')[0].json.theme;\nconst source = $json.source || $items('ParseTheme')[0].json.source;\nconst requestText = $json.requestText || $items('ParseTheme')[0].json.requestText;\nconst retryCount = $json.retryCount || $items('ParseTheme')[0].json.retryCount || 0;\nconst prevData = $items('SaveToSheet')[0].json || $items('ParseTheme')[0].json;\n\nconst requestId = prevData.request_id || prevData.messageTs || `req_${Date.now()}`;\n\n// ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ§‹ç¯‰\nlet textMessage = '';\nif (source === 'web') {\n  textMessage += `ğŸŒ *Webã‚µã‚¤ãƒˆã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆ*\\nã€Œ${requestText}ã€\\n\\n`;\n}\nif (retryCount > 0) {\n  textMessage += `âš ï¸ *å†ç”Ÿæˆ (${retryCount}å›ç›®)*\\n\\n`;\n}\ntextMessage += `ğŸ“ *ã‚³ãƒ©ãƒ ãƒ†ãƒ¼ãƒæ¡ˆ*\\n\\n*${theme.title}*\\nãƒ¬ãƒ™ãƒ«: ${theme.level}\\n${theme.description}\\n\\nã“ã®ãƒ†ãƒ¼ãƒã§ã‚³ãƒ©ãƒ ã‚’ç”Ÿæˆã—ã¾ã™ã‹ï¼Ÿ`;\n\nreturn [{\n  json: {\n    slackMessage: textMessage,\n    theme: theme,\n    themes: [theme],\n    themesJson: prevData.themesJson || JSON.stringify([theme]),\n    requestText: requestText,\n    source: source,\n    userId: prevData.userId,\n    channelId: prevData.channelId || prevData.channel_id,\n    messageTs: prevData.messageTs,\n    parent_thread_ts: prevData.parent_thread_ts,\n    request_id: requestId,\n    retryCount: retryCount\n  }\n}];"
      },
      "id": "6800a8d6-53fb-4735-95aa-a9a7267a019e",
      "name": "BuildApprovalMessage",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1520,
        -200
      ]
    },
    {
      "parameters": {
        "operation": "sendAndWait",
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C0A0AAKQ7D1",
          "mode": "list",
          "cachedResultName": "column-request"
        },
        "message": "={{ $json.slackMessage }}",
        "responseType": "freeText",
        "options": {}
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        1760,
        -200
      ],
      "id": "87c170d3-12b8-425c-b02d-b9de018517e5",
      "name": "SendApprovalRequest",
      "webhookId": "bd8f0833-ac74-484b-941d-f4d7a8639776",
      "credentials": {
        "slackApi": {
          "id": "kahTvH10blaEP2kb",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’AIã«åˆ¤å®šã•ã›ã‚‹ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰\n// SendApprovalRequestï¼ˆsendAndWaitæ“ä½œã€freeTextã‚¿ã‚¤ãƒ—ï¼‰ã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å–å¾—\n// sendAndWaitæ“ä½œã§ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¿”ä¿¡ã¯$json.data.textã«å«ã¾ã‚Œã‚‹\nconst userResponse = ($json.data.text || $json.text || '').trim();\n\n// å‰ã®ãƒãƒ¼ãƒ‰ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆãƒ†ãƒ¼ãƒæƒ…å ±ãªã©ï¼‰\nconst prevData = $items('BuildApprovalMessage')[0].json;\nconst theme = prevData.theme;\n\nif (!userResponse) {\n  throw new Error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®è¿”ä¿¡ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚$json.data.textã¾ãŸã¯$json.textãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');\n}\n\n// ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’æ§‹ç¯‰\nconst prompt = `ã‚³ãƒ©ãƒ ãƒ†ãƒ¼ãƒæ‰¿èªåˆ¤å®šã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼è¿”ä¿¡ã‚’åˆ†æã—ã€3ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰1ã¤é¸æŠ:\n\n1. approved: æ‰¿èªï¼ˆä¾‹: OK/æ‰¿èª/è‰¯ã„/é€²ã‚ã¦/ç”Ÿæˆ/ã„ã„/ã‚ˆã‚ã—ã„ï¼‰\n2. modification: ä¿®æ­£æŒ‡ç¤ºï¼ˆä¾‹: ã‚‚ã£ã¨åˆå¿ƒè€…å‘ã‘/ã‚ˆã‚Šå…·ä½“çš„ã«/ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´/å¤‰æ›´ã—ã¦/ä¿®æ­£ã—ã¦ï¼‰\n3. rejected: å´ä¸‹ï¼ˆä¾‹: ãƒ€ãƒ¡/é•ã†/åˆ¥ã®ãƒ†ãƒ¼ãƒ/å…¨ãé•ã†/å´ä¸‹ï¼‰\n\nãƒ†ãƒ¼ãƒ: ${theme.title}\nè¿”ä¿¡: ${userResponse}\n\nåˆ¤å®šåŸºæº–:\n- ã€Œã‚‚ã£ã¨ã€ã€Œã‚ˆã‚Šã€ã€Œå¤‰æ›´ã€ã€Œä¿®æ­£ã€ãªã©ã®æ”¹å–„èªãŒå«ã¾ã‚Œã‚‹ â†’ modification\n- çŸ­ã„è‚¯å®šï¼ˆOK/ã„ã„/ã‚ˆã‚ã—ã„ï¼‰â†’ approved\n- æ˜ç¢ºãªå¦å®šï¼ˆãƒ€ãƒ¡/é•ã†/å´ä¸‹ï¼‰â†’ rejected\n\nJSONã®ã¿å‡ºåŠ›ï¼ˆèª¬æ˜ä¸è¦ï¼‰:\n{\"judgment\": \"approved|modification|rejected\", \"feedback\": \"ä¿®æ­£æŒ‡ç¤ºã®å†…å®¹ï¼ˆæ‰¿èªãƒ»å´ä¸‹æ™‚ã¯ç©ºæ–‡å­—ï¼‰\"}`;\n\nreturn [{\n  json: {\n    prompt: prompt,\n    userResponse: userResponse,\n    ...prevData\n  }\n}];"
      },
      "id": "9bbd439a-08ef-4fc6-82a6-c151c574572a",
      "name": "BuildApprovalJudgmentPrompt",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2000,
        -200
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list"
        },
        "messages": {
          "values": [
            {
              "content": "={{ $json.prompt }}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        2240,
        -200
      ],
      "id": "30524250-2773-4dbc-8e19-58ad7a7c9b51",
      "name": "JudgeApprovalResponse",
      "credentials": {
        "googlePalmApi": {
          "id": "gojn353h4HLDUzF2",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// AIåˆ¤å®šçµæœã‚’ãƒ‘ãƒ¼ã‚¹\nconst rawText = $json.content.parts[0].text;\nconsole.log('ğŸ“¥ AIåˆ¤å®šçµæœ:', rawText.substring(0, 500));\n\n// JSONã‚’æŠ½å‡º\nlet jsonString = rawText.trim();\njsonString = jsonString.replace(/^```(?:json)?\\s*/i, '').replace(/\\s*```$/i, '').trim();\n\nconst jsonStart = jsonString.indexOf('{');\nconst jsonEnd = jsonString.lastIndexOf('}');\n\nif (jsonStart === -1 || jsonEnd === -1) {\n  throw new Error('JSONãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ' + rawText.substring(0, 200));\n}\n\njsonString = jsonString.substring(jsonStart, jsonEnd + 1);\n\nlet judgmentData;\ntry {\n  judgmentData = JSON.parse(jsonString);\n} catch (e) {\n  throw new Error('JSONãƒ‘ãƒ¼ã‚¹å¤±æ•—: ' + e.message);\n}\n\n// åˆ¤å®šçµæœã‚’æ¤œè¨¼\nconst validJudgments = ['approved', 'modification', 'rejected'];\nif (!validJudgments.includes(judgmentData.judgment)) {\n  throw new Error('ç„¡åŠ¹ãªåˆ¤å®šçµæœ: ' + judgmentData.judgment);\n}\n\n// å‰ã®ãƒãƒ¼ãƒ‰ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’å¼•ãç¶™ã\nconst prevData = $items('BuildApprovalJudgmentPrompt')[0].json;\n\nconsole.log(`âœ… åˆ¤å®šçµæœ: ${judgmentData.judgment} - ${judgmentData.feedback || 'ãªã—'}`);\n\nreturn [{\n  json: {\n    judgment: judgmentData.judgment,\n    feedback: judgmentData.feedback || '',\n    userResponse: prevData.userResponse,\n    ...prevData\n  }\n}];"
      },
      "id": "5465ca0b-5ee9-48c1-b56b-2ae39d79c961",
      "name": "ParseApprovalJudgment",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2480,
        -200
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.judgment }}",
                    "rightValue": "approved",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "approved"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.judgment }}",
                    "rightValue": "modification",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "modification"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict"
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.judgment }}",
                    "rightValue": "rejected",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "rejected"
            }
          ]
        },
        "options": {}
      },
      "id": "a70f17f4-7848-4b52-a721-a4c99cb520bf",
      "name": "SwitchApprovalType",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.3,
      "position": [
        2720,
        -200
      ]
    },
    {
      "parameters": {
        "jsCode": "// æ‰¿èªã•ã‚ŒãŸãƒ†ãƒ¼ãƒã§ã‚³ãƒ©ãƒ ç”Ÿæˆæº–å‚™ï¼ˆAIåˆ¤å®šå¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼‰\n// ParseApprovalJudgmentã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆBuildApprovalMessageã®ãƒ‡ãƒ¼ã‚¿ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ï¼‰\nconst approvalData = $json;\nconst theme = approvalData.theme || $items('BuildApprovalMessage')[0].json.theme;\n\nconsole.log('âœ… ãƒ†ãƒ¼ãƒæ‰¿èª:', theme.title);\n\n// è¨˜äº‹ç”Ÿæˆã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã‚’æº–å‚™\nreturn [{\n  json: {\n    theme: theme.title,\n    level: theme.level,\n    themeNo: 1,\n    requestText: approvalData.requestText,\n    source: approvalData.source,\n    channelId: approvalData.channelId,\n    parent_thread_ts: approvalData.parent_thread_ts,\n    request_id: approvalData.request_id\n  }\n}];"
      },
      "id": "27a49174-83ba-499b-afc1-edf4c70ee8f2",
      "name": "PrepareColumnGeneration",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2960,
        200
      ]
    },
    {
      "parameters": {
        "jsCode": "const theme = $json.theme;\nconst level = $json.level;\nconst themeNo = $json.themeNo;\n\n// ã‚¿ã‚¤ãƒˆãƒ«ã¯ãƒ†ãƒ¼ãƒã‚’ãã®ã¾ã¾ä½¿ç”¨\nconst prompt = `\nã‚ãªãŸã¯JSONç”Ÿæˆã®å°‚é–€å®¶ã§ã™ã€‚æœ‰åŠ¹ãªJSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n\n## è¨˜äº‹æƒ…å ±\n- ã‚¿ã‚¤ãƒˆãƒ«: ${theme}\n- ãƒ¬ãƒ™ãƒ«: ${level}\n\n## é‡è¦ãªãƒ«ãƒ¼ãƒ«\n1. JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¿ã‚’å‡ºåŠ›ï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã€èª¬æ˜æ–‡ã¯ä¸è¦ï¼‰\n2. { ã§å§‹ã¾ã‚Š } ã§çµ‚ã‚ã‚‹ã“ã¨\n3. content_markdownå†…ã®æ”¹è¡Œã¯ \\\\n ã‚’ä½¿ç”¨\n4. ç‰¹æ®Šæ–‡å­—ï¼ˆå¼•ç”¨ç¬¦ã€ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼‰ã¯é©åˆ‡ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—\n5. content_markdownã¯2500ã€œ3500æ–‡å­—ç¨‹åº¦\n6. é‡è¦ãªæƒ…å ±ã«ã¯ <mark>ãƒ†ã‚­ã‚¹ãƒˆ</mark> ã‚’ä½¿ç”¨ï¼ˆé»„è‰²èƒŒæ™¯+ä¸‹ç·šã§è¡¨ç¤ºï¼‰\n7. å¼·èª¿ã«ã¯ **å¤ªå­—** ã‚’ä½¿ç”¨\n\n## å‡ºåŠ›ã™ã‚‹JSONã®æ§‹é€ \n{\n  \"title\": \"${theme}\",\n  \"description\": \"è¨˜äº‹ã®è¦ç´„ï¼ˆ80ã€œ120æ–‡å­—ï¼‰\",\n  \"content_markdown\": \"è¨˜äº‹æœ¬æ–‡ï¼ˆMarkdownå½¢å¼ï¼‰\",\n  \"category\": \"ä»¥ä¸‹ã‹ã‚‰1ã¤é¸æŠ: ãƒã‚¤ãƒ³ãƒˆæ´»ç”¨è¡“, æ±ºæ¸ˆã‚µãƒ¼ãƒ“ã‚¹, ãŠå¾—æ´»ç”¨äº‹ä¾‹, åŸºç¤çŸ¥è­˜, ãã®ä»–\",\n  \"tags\": \"ã‚¿ã‚°1,ã‚¿ã‚°2,ã‚¿ã‚°3\"\n}\n\n## è¨˜äº‹ã®æ§‹æˆï¼ˆcontent_markdownï¼‰\n1. **å°å…¥**ï¼ˆèª­è€…ã®æ‚©ã¿ã¨è§£æ±ºç­–ã®æç¤ºï¼‰\n2. **åŸºæœ¬ã®è€ƒãˆæ–¹**ï¼ˆã‚³ã‚¢ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®èª¬æ˜ï¼‰\n3. **å…·ä½“çš„ãªã‚¹ãƒ†ãƒƒãƒ—**ï¼ˆå®Ÿè·µæ–¹æ³•ã‚’é †åºç«‹ã¦ã¦ï¼‰\n4. **æ³¨æ„ç‚¹ãƒ»ã‚ˆãã‚ã‚‹å¤±æ•—**ï¼ˆé¿ã‘ã‚‹ã¹ããƒã‚¤ãƒ³ãƒˆï¼‰\n5. **ã¾ã¨ã‚**ï¼ˆè¦ç‚¹ã®æŒ¯ã‚Šè¿”ã‚Šï¼‰\n\n## èª­ã¿ã‚„ã™ã•ã®ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæŒ‡é‡\n- å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¾Œã«ç©ºè¡Œã‚’å…¥ã‚Œã‚‹ï¼ˆ\\\\n\\\\nï¼‰\n- ç®‡æ¡æ›¸ãã®å‰å¾Œã«ã‚‚ç©ºè¡Œã‚’å…¥ã‚Œã‚‹\n- é•·ã„æ®µè½ã¯2ã€œ3æ–‡ã”ã¨ã«æ”¹è¡Œã‚’å…¥ã‚Œã‚‹\n- è¦‹å‡ºã—ï¼ˆ##ï¼‰ã®å‰ã«ã¯å¿…ãšç©ºè¡Œã‚’å…¥ã‚Œã‚‹\n- 1æ–‡ã¯60æ–‡å­—ä»¥å†…ã‚’ç›®å®‰ã«\n\n## è£…é£¾ã®ä½¿ã„æ–¹\n- **å¤ªå­—**: é‡è¦ãªç”¨èªã€æ•°å­—ï¼ˆå„ã‚»ã‚¯ã‚·ãƒ§ãƒ³2ã€œ3ç®‡æ‰€ï¼‰\n- <mark>ãƒã‚¤ãƒ©ã‚¤ãƒˆ</mark>: çµ¶å¯¾ã«è¦šãˆã¦ã»ã—ã„æƒ…å ±ï¼ˆè¨˜äº‹å…¨ä½“ã§1ã€œ3ç®‡æ‰€ï¼‰\n  - ä½¿ç”¨åŸºæº–: æ ¸å¿ƒã¨ãªã‚‹æ¦‚å¿µã€é‡å¤§ãªæ³¨æ„ç‚¹ã€é‡è¦ãªæ•°å­—ãƒ»æœŸé™\n- ç®‡æ¡æ›¸ãï¼ˆ- ã¾ãŸã¯ *ï¼‰: ãƒªã‚¹ãƒˆã®å ´åˆ\n- ç•ªå·ä»˜ããƒªã‚¹ãƒˆï¼ˆ1. 2. 3.ï¼‰: æ‰‹é †ã®å ´åˆ\n\n## ç”»åƒãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼\n- [IMAGE: èª¬æ˜] ã®å½¢å¼ã§ã€UIçš„ã«ç”»åƒãŒã‚ã‚‹ã¨ç†è§£ã—ã‚„ã™ã„ç®‡æ‰€ã«æŒ¿å…¥\n- è¨˜äº‹å…¨ä½“ã§2ã€œ4ç®‡æ‰€ç¨‹åº¦ã€è‡ªç„¶ãªä½ç½®ã«é…ç½®\n- æ®µè½ã®åŒºåˆ‡ã‚Šï¼ˆç©ºè¡Œã®å¾Œï¼‰ã«é…ç½®ã™ã‚‹ã“ã¨\n\n## å‡ºåŠ›é–‹å§‹\nJSONã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„:\n`.trim();\n\nreturn [{ json: { prompt, theme, level, themeNo, ...($json) } }];"
      },
      "id": "b9de7883-ca2e-49b8-ae69-1c9eb11272e2",
      "name": "BuildArticlePrompt",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3200,
        200
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list"
        },
        "messages": {
          "values": [
            {
              "content": "={{$json.prompt}}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        3440,
        200
      ],
      "id": "07f711fc-6fe7-4ce7-b07a-7c9c086841c9",
      "name": "GenerateArticle",
      "credentials": {
        "googlePalmApi": {
          "id": "gojn353h4HLDUzF2",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// LLMã‹ã‚‰ã®ç”Ÿãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—\nconst rawText = $json.content.parts[0].text;\nconsole.log('ğŸ“¥ LLMå‡ºåŠ›ï¼ˆå…ˆé ­500æ–‡å­—ï¼‰:', rawText.substring(0, 500));\n\n// Step 1: ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»ã—ã¦JSONã‚’æŠ½å‡º\nlet jsonString = rawText.trim();\njsonString = jsonString.replace(/^```(?:json)?\\s*/i, '').replace(/\\s*```$/i, '').trim();\n\n// Step 2: JSONã® { } ã‚’è¦‹ã¤ã‘ã‚‹\nconst jsonStart = jsonString.indexOf('{');\nconst jsonEnd = jsonString.lastIndexOf('}');\n\nif (jsonStart === -1 || jsonEnd === -1 || jsonEnd <= jsonStart) {\n  throw new Error('JSONã® { } ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚LLMå‡ºåŠ›: ' + rawText.substring(0, 200));\n}\n\njsonString = jsonString.substring(jsonStart, jsonEnd + 1);\nconsole.log('ğŸ“ JSONæŠ½å‡ºå®Œäº†ï¼ˆé•·ã•: ' + jsonString.length + 'æ–‡å­—ï¼‰');\n\n// Step 3: å …ç‰¢ãªJSONãƒ‘ãƒ¼ã‚µãƒ¼\nfunction robustJSONParse(str) {\n  // è©¦è¡Œ1: ãã®ã¾ã¾ãƒ‘ãƒ¼ã‚¹\n  try {\n    return JSON.parse(str);\n  } catch (e1) {\n    console.log('âš ï¸ é€šå¸¸ãƒ‘ãƒ¼ã‚¹å¤±æ•—ã€ä¿®æ­£ã‚’è©¦è¡Œ...');\n  }\n  \n  // è©¦è¡Œ2: åˆ¶å¾¡æ–‡å­—ã‚’é™¤å»\n  let fixed = str;\n  fixed = fixed.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F]/g, '');\n  \n  try {\n    return JSON.parse(fixed);\n  } catch (e2) {\n    console.log('âš ï¸ åˆ¶å¾¡æ–‡å­—é™¤å»å¾Œã‚‚å¤±æ•—ã€ã•ã‚‰ã«ä¿®æ­£...');\n  }\n  \n  // è©¦è¡Œ3: content_markdownå†…ã®å•é¡Œã‚’ä¿®æ­£\n  const cmMatch = fixed.match(/\"content_markdown\"\\s*:\\s*\"/);\n  if (cmMatch) {\n    const cmStart = fixed.indexOf(cmMatch[0]) + cmMatch[0].length;\n    let cmEnd = cmStart;\n    let i = cmStart;\n    while (i < fixed.length) {\n      if (fixed[i] === '\\\\') {\n        i += 2;\n        continue;\n      }\n      if (fixed[i] === '\"') {\n        cmEnd = i;\n        break;\n      }\n      i++;\n    }\n    \n    if (cmEnd > cmStart) {\n      let content = fixed.substring(cmStart, cmEnd);\n      content = content.replace(/\\r\\n/g, '\\\\n').replace(/\\n/g, '\\\\n').replace(/\\r/g, '\\\\n');\n      content = content.replace(/\\t/g, '  ');\n      fixed = fixed.substring(0, cmStart) + content + fixed.substring(cmEnd);\n    }\n  }\n  \n  try {\n    return JSON.parse(fixed);\n  } catch (e3) {\n    console.log('âš ï¸ content_markdownä¿®æ­£å¾Œã‚‚å¤±æ•—ã€æœ€çµ‚æ‰‹æ®µ...');\n  }\n  \n  // è©¦è¡Œ4: å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å€‹åˆ¥ã«æŠ½å‡ºã—ã¦å†æ§‹ç¯‰\n  const titleMatch = str.match(/\"title\"\\s*:\\s*\"([^\"]*)\"/i);\n  const descMatch = str.match(/\"description\"\\s*:\\s*\"([^\"]*)\"/i);\n  const categoryMatch = str.match(/\"category\"\\s*:\\s*\"([^\"]*)\"/i);\n  const tagsMatch = str.match(/\"tags\"\\s*:\\s*\"([^\"]*)\"/i);\n  \n  const cmStartMatch = str.match(/\"content_markdown\"\\s*:\\s*\"/);\n  let contentMarkdown = '';\n  \n  if (cmStartMatch) {\n    const startIdx = str.indexOf(cmStartMatch[0]) + cmStartMatch[0].length;\n    const endPatterns = ['\"category\"', '\"tags\"', '\"description\"'];\n    let endIdx = str.length;\n    \n    for (const pattern of endPatterns) {\n      const idx = str.indexOf(pattern, startIdx);\n      if (idx > startIdx && idx < endIdx) {\n        let tempIdx = idx - 1;\n        while (tempIdx > startIdx && str[tempIdx] !== '\"') {\n          tempIdx--;\n        }\n        if (tempIdx > startIdx) {\n          endIdx = Math.min(endIdx, tempIdx);\n        }\n      }\n    }\n    \n    contentMarkdown = str.substring(startIdx, endIdx);\n    contentMarkdown = contentMarkdown.replace(/\\s*,\\s*$/, '').replace(/\"\\s*,\\s*$/, '');\n  }\n  \n  if (titleMatch && contentMarkdown) {\n    console.log('âœ… ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å€‹åˆ¥æŠ½å‡ºã§æˆåŠŸ');\n    return {\n      title: titleMatch[1],\n      description: descMatch ? descMatch[1] : '',\n      content_markdown: contentMarkdown.replace(/\\\\n/g, '\\n').replace(/\\\\t/g, '\\t'),\n      category: categoryMatch ? categoryMatch[1] : 'ãƒã‚¤ãƒ³ãƒˆæ´»ç”¨è¡“',\n      tags: tagsMatch ? tagsMatch[1] : ''\n    };\n  }\n  \n  throw new Error('JSONãƒ‘ãƒ¼ã‚¹å¤±æ•—: ã™ã¹ã¦ã®ä¿®æ­£è©¦è¡ŒãŒå¤±æ•—ã—ã¾ã—ãŸ');\n}\n\nconst article = robustJSONParse(jsonString);\n\n// å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¤œè¨¼\nif (!article.title) {\n  throw new Error('titleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“');\n}\nif (!article.content_markdown) {\n  throw new Error('content_markdownãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“');\n}\n\n// ã‚¿ã‚¤ãƒˆãƒ«ã‚’ãƒ†ãƒ¼ãƒã§ä¸Šæ›¸ãï¼ˆç¢ºå®Ÿã«ãƒ†ãƒ¼ãƒ=ã‚¿ã‚¤ãƒˆãƒ«ã«ã™ã‚‹ï¼‰\nconst theme = $items('BuildArticlePrompt')[0].json.theme;\n\nconst result = {\n  ...article,\n  title: theme, // ãƒ†ãƒ¼ãƒã‚’ãã®ã¾ã¾ã‚¿ã‚¤ãƒˆãƒ«ã¨ã—ã¦ä½¿ç”¨\n  theme: theme,\n  level: $items('BuildArticlePrompt')[0].json.level,\n  themeNo: $items('BuildArticlePrompt')[0].json.themeNo\n};\n\nconsole.log('âœ… è¨˜äº‹ãƒ‘ãƒ¼ã‚¹å®Œäº†:', result.title);\n\nreturn [{ json: result }];"
      },
      "id": "9223e262-8008-415b-8913-a63e86d2c706",
      "name": "ParseArticleJSON",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3680,
        200
      ]
    },
    {
      "parameters": {
        "jsCode": "const articleData = $json;\n\n// æ—¥æœ¬èªå¯¾å¿œã®ã‚¹ãƒ©ãƒƒã‚°ç”Ÿæˆï¼ˆlib/columns.tsã¨å®Œå…¨ä¸€è‡´ï¼‰\nconst slug = articleData.title\n  .toLowerCase()\n  .replace(/[^a-z0-9\\u3040-\\u309f\\u30a0-\\u30ff\\u4e00-\\u9faf]+/g, '-')\n  .replace(/^-+|-+$/g, '');\n\nconst content_html = articleData.content_markdown\n  .replace(/^### (.*$)/gim, '<h3>$1</h3>')\n  .replace(/^## (.*$)/gim, '<h2>$1</h2>')\n  .replace(/^# (.*$)/gim, '<h1>$1</h1>')\n  .replace(/\\*\\*(.*?)\\*\\*/gim, '<strong>$1</strong>')\n  .replace(/\\*(.*?)\\*/gim, '<em>$1</em>')\n  .replace(/\\n\\n/gim, '</p><p>')\n  .replace(/\\n/gim, '<br>');\n\nconst columnData = {\n  slug: slug,\n  title: articleData.title,\n  description: articleData.description,\n  content_markdown: articleData.content_markdown,\n  content_html: '<p>' + content_html + '</p>',\n  category: articleData.category,\n  tags: articleData.tags,\n  thumbnail_url: '',\n  author: 'TokuSearch AI',\n  status: 'published',\n  is_featured: false,\n  theme: articleData.theme,\n  themeNo: articleData.themeNo\n};\n\nconsole.log('âœ… ãƒ‡ãƒ¼ã‚¿æº–å‚™å®Œäº†:', columnData.title);\nconsole.log('ğŸ“ ç”Ÿæˆã•ã‚ŒãŸã‚¹ãƒ©ãƒƒã‚°:', slug);\n\nreturn [{ json: columnData }];"
      },
      "id": "0a99443f-88cb-4066-b2ce-f8cd67e09ceb",
      "name": "PrepareColumnData",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        3920,
        200
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://tokusearch.vercel.app/api/admin/columns",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "id": "303f7bf2-a298-4276-9023-bef3b35d5cb6",
      "name": "PostColumn",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        4160,
        200
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "RT6aq4TB1Vj8V2Tn",
          "name": "Credential Name"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14",
          "mode": "list",
          "cachedResultName": "TokuSearch"
        },
        "sheetName": {
          "__rl": true,
          "value": "column_requests",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "autoMapInputData",
          "value": {
            "request_id": "={{ $items('PrepareColumnGeneration')[0].json.request_id }}",
            "status": "completed"
          },
          "matchingColumns": [
            "request_id"
          ],
          "schema": [
            {
              "id": "request_id",
              "displayName": "request_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "source",
              "displayName": "source",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "channel_id",
              "displayName": "channel_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "thread_ts",
              "displayName": "thread_ts",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "original_text",
              "displayName": "original_text",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "themes_json",
              "displayName": "themes_json",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "status",
              "displayName": "status",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "parent_thread_ts",
              "displayName": "parent_thread_ts",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "slackMessage",
              "displayName": "slackMessage",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "themes",
              "displayName": "themes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "themesJson",
              "displayName": "themesJson",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "requestText",
              "displayName": "requestText",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "userId",
              "displayName": "userId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "channelId",
              "displayName": "channelId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "messageTs",
              "displayName": "messageTs",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "slackBlocks",
              "displayName": "slackBlocks",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "requestId",
              "displayName": "requestId",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "f81c045b-f445-43e2-aea1-68c059ff5b37",
      "name": "UpdateStatus",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        4400,
        200
      ],
      "credentials": {
        "googleApi": {
          "id": "r9kAyVencycJeNjy",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// å®Œäº†é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ§‹ç¯‰\nconst columnData = $items('PrepareColumnData')[0].json;\nconst postResult = $json;\nconst prevData = $items('PrepareColumnGeneration')[0].json;\n\nconst slug = columnData.slug || postResult.slug || '';\nconst columnUrl = slug ? `https://tokusearch.vercel.app/columns/${slug}` : '';\n\nconst message = `ğŸ‰ ã‚³ãƒ©ãƒ ç”Ÿæˆå®Œäº†ï¼\n\nğŸ“ ã‚¿ã‚¤ãƒˆãƒ«: ${columnData.title}\nğŸ·ï¸ ã‚«ãƒ†ã‚´ãƒª: ${columnData.category}\n${columnUrl ? 'ğŸ”— URL: ' + columnUrl : ''}`;\n\nreturn [{\n  json: {\n    text: message,\n    url: columnUrl,\n    title: columnData.title,\n    channelId: prevData.channelId,\n    parent_thread_ts: prevData.parent_thread_ts\n  }\n}];"
      },
      "id": "2da16560-4100-4f00-86f8-0a426a65d052",
      "name": "BuildCompletionMessage",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        4640,
        200
      ]
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "={{ $json.channelId || 'C0A0AAKQ7D1' }}",
          "mode": "id"
        },
        "text": "={{ $json.text }}",
        "otherOptions": {
          "includeLinkToWorkflow": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        4880,
        200
      ],
      "id": "8ade95f7-fef1-431b-b329-73fc7d4bed1f",
      "name": "NotifyCompletion",
      "webhookId": "a1ea8121-abd5-4a24-a6b4-655ddf5a6594",
      "credentials": {
        "slackApi": {
          "id": "kahTvH10blaEP2kb",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// å´ä¸‹ã®å ´åˆã®å‡¦ç†: retryCountã‚’ãƒã‚§ãƒƒã‚¯ï¼ˆAIåˆ¤å®šå¾Œã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ç”¨ï¼‰\n// ParseApprovalJudgmentã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ï¼ˆBuildApprovalMessageã®ãƒ‡ãƒ¼ã‚¿ã‚‚å«ã¾ã‚Œã¦ã„ã‚‹ï¼‰\nconst rejectionData = $json;\nconst retryCount = rejectionData.retryCount || 0;\n\nconsole.log(`âš ï¸ ãƒ†ãƒ¼ãƒå´ä¸‹ã€retryCount: ${retryCount}`);\n\nreturn [{\n  json: {\n    ...rejectionData,\n    retryCount: retryCount\n  }\n}];"
      },
      "id": "7fa71f5c-bc57-4caf-a37d-5cffbefd53c8",
      "name": "CheckRetryCount",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2720,
        -144
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "check-retry-lt-2-001",
              "leftValue": "={{ $json.retryCount || 0 }}",
              "rightValue": 2,
              "operator": {
                "type": "number",
                "operation": "lt",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "26964b40-6e6f-4301-abde-51bda7e0cc81",
      "name": "IfRetryAvailable",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        2720,
        96
      ]
    },
    {
      "parameters": {
        "jsCode": "// å†ç”Ÿæˆ: ä¿®æ­£æŒ‡ç¤ºã®å ´åˆã¯retryCountã‚’å¢—ã‚„ã•ãšã€å´ä¸‹ã®å ´åˆã¯å¢—ã‚„ã™\nconst prevData = $json;\nconst judgment = prevData.judgment || '';\nconst currentRetryCount = prevData.retryCount || 0;\n\n// ä¿®æ­£æŒ‡ç¤ºã®å ´åˆã¯retryCountã‚’å¢—ã‚„ã•ãªã„ï¼ˆfeedbackã‚’ä¿æŒï¼‰\n// å´ä¸‹ã®å ´åˆã¯retryCountã‚’å¢—ã‚„ã™\nconst newRetryCount = judgment === 'modification' ? currentRetryCount : currentRetryCount + 1;\n\nconsole.log(`ğŸ”„ ãƒ†ãƒ¼ãƒå†ç”Ÿæˆé–‹å§‹ (${newRetryCount}å›ç›®) - ç¨®åˆ¥: ${judgment === 'modification' ? 'ä¿®æ­£æŒ‡ç¤º' : 'å´ä¸‹'}`);\n\n// å†ç”Ÿæˆã«å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç¢ºå®Ÿã«å¼•ãç¶™ã\nreturn [{\n  json: {\n    requestText: prevData.requestText,\n    retryCount: newRetryCount,\n    feedback: prevData.feedback || '',\n    source: prevData.source,\n    userId: prevData.userId,\n    channelId: prevData.channelId,\n    messageTs: prevData.messageTs,\n    parent_thread_ts: prevData.parent_thread_ts || prevData.parentThreadTs,\n    request_id: prevData.request_id || prevData.requestId,\n    originalMessage: prevData.originalMessage || prevData.requestText\n  }\n}];"
      },
      "id": "5a0e318b-aba9-4f2c-b981-650abd6643db",
      "name": "IncrementRetryCount",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2720,
        336
      ]
    },
    {
      "parameters": {
        "jsCode": "// ä¸­æ–­é€šçŸ¥ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ§‹ç¯‰\nconst prevData = $json;\n\nconst message = `âŒ ã‚³ãƒ©ãƒ ç”Ÿæˆã‚’ä¸­æ–­ã—ã¾ã—ãŸ\n\nãƒªã‚¯ã‚¨ã‚¹ãƒˆ: ${prevData.requestText}\nç†ç”±: 2å›ã®ãƒ†ãƒ¼ãƒå†ç”ŸæˆãŒã™ã¹ã¦å´ä¸‹ã•ã‚Œã¾ã—ãŸã€‚\n\nåˆ¥ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã§ãƒ†ãƒ¼ãƒã‚’æ¤œè¨ã—ã¦ãã ã•ã„ã€‚`;\n\nreturn [{\n  json: {\n    text: message,\n    channelId: prevData.channelId,\n    parent_thread_ts: prevData.parent_thread_ts\n  }\n}];"
      },
      "id": "dc7f11e8-f03d-4714-80a4-c6308e445a2e",
      "name": "BuildAbortMessage",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        2720,
        576
      ]
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "={{ $json.channelId || 'C0A0AAKQ7D1' }}",
          "mode": "id"
        },
        "text": "={{ $json.text }}",
        "otherOptions": {
          "includeLinkToWorkflow": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        2720,
        816
      ],
      "id": "adcd01df-7892-45a7-90c7-5c63b6ccf2c0",
      "name": "AbortNotification",
      "webhookId": "a1ea8121-abd5-4a24-a6b4-655ddf5a6594",
      "credentials": {
        "slackApi": {
          "id": "kahTvH10blaEP2kb",
          "name": "Slack account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "SlackTrigger": {
      "main": [
        [
          {
            "node": "ExtractSlackRequest",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ExtractSlackRequest": {
      "main": [
        [
          {
            "node": "MergeRequests",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WebhookTrigger": {
      "main": [
        [
          {
            "node": "ExtractWebhookRequest",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ExtractWebhookRequest": {
      "main": [
        [
          {
            "node": "MergeRequests",
            "type": "main",
            "index": 1
          }
        ]
      ]
    },
    "MergeRequests": {
      "main": [
        [
          {
            "node": "BuildThemePrompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildThemePrompt": {
      "main": [
        [
          {
            "node": "GenerateTheme",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GenerateTheme": {
      "main": [
        [
          {
            "node": "ParseTheme",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ParseTheme": {
      "main": [
        [
          {
            "node": "PrepareSaveData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PrepareSaveData": {
      "main": [
        [
          {
            "node": "SaveToSheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SaveToSheet": {
      "main": [
        [
          {
            "node": "BuildApprovalMessage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildApprovalMessage": {
      "main": [
        [
          {
            "node": "SendApprovalRequest",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SendApprovalRequest": {
      "main": [
        [
          {
            "node": "BuildApprovalJudgmentPrompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildApprovalJudgmentPrompt": {
      "main": [
        [
          {
            "node": "JudgeApprovalResponse",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JudgeApprovalResponse": {
      "main": [
        [
          {
            "node": "ParseApprovalJudgment",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ParseApprovalJudgment": {
      "main": [
        [
          {
            "node": "SwitchApprovalType",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SwitchApprovalType": {
      "main": [
        [
          {
            "node": "PrepareColumnGeneration",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "IncrementRetryCount",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "CheckRetryCount",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CheckRetryCount": {
      "main": [
        [
          {
            "node": "IfRetryAvailable",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IfRetryAvailable": {
      "main": [
        [
          {
            "node": "IncrementRetryCount",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "BuildAbortMessage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "IncrementRetryCount": {
      "main": [
        [
          {
            "node": "BuildThemePrompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildAbortMessage": {
      "main": [
        [
          {
            "node": "AbortNotification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PrepareColumnGeneration": {
      "main": [
        [
          {
            "node": "BuildArticlePrompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildArticlePrompt": {
      "main": [
        [
          {
            "node": "GenerateArticle",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GenerateArticle": {
      "main": [
        [
          {
            "node": "ParseArticleJSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ParseArticleJSON": {
      "main": [
        [
          {
            "node": "PrepareColumnData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PrepareColumnData": {
      "main": [
        [
          {
            "node": "PostColumn",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PostColumn": {
      "main": [
        [
          {
            "node": "UpdateStatus",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UpdateStatus": {
      "main": [
        [
          {
            "node": "BuildCompletionMessage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildCompletionMessage": {
      "main": [
        [
          {
            "node": "NotifyCompletion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "a0cc74db-e81b-49e9-8d5c-3f59962d016b",
  "meta": {
    "instanceId": "fefffd21e64fa94994bb4bf38b5a050c59f6cf28bd3cad9da0a5804220d9e97f"
  },
  "id": "YCeUdqmrteN9TXI7",
  "tags": []
}