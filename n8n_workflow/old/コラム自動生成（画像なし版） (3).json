{
  "name": "ã‚³ãƒ©ãƒ è‡ªå‹•ç”Ÿæˆï¼ˆç”»åƒãªã—ç‰ˆï¼‰",
  "nodes": [
    {
      "parameters": {
        "content": "## ğŸ“‹ ã‚³ãƒ©ãƒ è‡ªå‹•ç”Ÿæˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼\n\n**æ¦‚è¦**: æ¯æ—¥9æ™‚ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã€æœªä½¿ç”¨ã®ãƒ†ãƒ¼ãƒã‹ã‚‰ã‚³ãƒ©ãƒ è¨˜äº‹ã‚’ç”Ÿæˆã—ã¦APIã«æŠ•ç¨¿ã—ã¾ã™ã€‚\n\n**ãƒ•ãƒ­ãƒ¼**:\n1. ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒˆãƒªã‚¬ãƒ¼ â†’ ãƒ†ãƒ¼ãƒå–å¾—\n2. ãƒ†ãƒ¼ãƒé¸æŠ â†’ è¨˜äº‹ç”Ÿæˆ\n3. APIæŠ•ç¨¿ â†’ Slacké€šçŸ¥\n\n**ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚**: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã«ã™ã‚‹ã¨Error TriggerãŒå‹•ä½œã—Slacké€šçŸ¥ã•ã‚Œã¾ã™",
        "height": 340,
        "width": 360,
        "color": 4
      },
      "id": "cffe8dc6-472f-4aa9-9258-9c05e2bdb581",
      "name": "ğŸ“‹ æ¦‚è¦",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1520,
        224
      ]
    },
    {
      "parameters": {
        "content": "## ğŸ¯ ãƒ†ãƒ¼ãƒå–å¾—ãƒ»é¸æŠ\n\n**GetUnusedThemes**: å…¨ãƒ†ãƒ¼ãƒã‚’å–å¾—\n\n**FilterUnusedThemes**: used=FALSEã®ãƒ†ãƒ¼ãƒã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°\n\n**CheckThemeCount**: \n- æœªä½¿ç”¨ãƒ†ãƒ¼ãƒã‚ã‚Š â†’ RandomThemeSelection\n- æœªä½¿ç”¨ãƒ†ãƒ¼ãƒãªã— â†’ æ–°ãƒ†ãƒ¼ãƒç”Ÿæˆãƒ•ãƒ­ãƒ¼\n\n**RandomThemeSelection**: ãƒ©ãƒ³ãƒ€ãƒ ã«1ä»¶é¸æŠ",
        "height": 320,
        "width": 300,
        "color": 6
      },
      "id": "819bd340-7dd3-4e2b-bf55-c8c74eac5055",
      "name": "ğŸ¯ ãƒ†ãƒ¼ãƒé¸æŠ",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1040,
        224
      ]
    },
    {
      "parameters": {
        "content": "## ğŸ†• æ–°ãƒ†ãƒ¼ãƒç”Ÿæˆãƒ•ãƒ­ãƒ¼\n\n**æœªä½¿ç”¨ãƒ†ãƒ¼ãƒãŒ0ä»¶ã®å ´åˆã«å®Ÿè¡Œ**\n\n1. GetAllThemes: å…¨ãƒ†ãƒ¼ãƒå–å¾—ï¼ˆé‡è¤‡é˜²æ­¢ç”¨ï¼‰\n2. CalculateNextNo: æ¬¡ã®ç•ªå·è¨ˆç®—\n3. BuildThemeGenerationPrompt: ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰\n4. GenerateThemes: Gemini ã§ãƒ†ãƒ¼ãƒç”Ÿæˆ\n5. ParseThemeCSV: CSVâ†’JSONå¤‰æ›\n6. AddThemesToSheet: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã«è¿½åŠ \n7. NotifySlackThemesGenerated: Slacké€šçŸ¥",
        "height": 320,
        "width": 380,
        "color": 3
      },
      "id": "dd3897aa-8077-4f5f-9b4a-1c456a593a58",
      "name": "ğŸ†• ãƒ†ãƒ¼ãƒç”Ÿæˆ",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -592,
        144
      ]
    },
    {
      "parameters": {
        "content": "## âœï¸ è¨˜äº‹ç”Ÿæˆãƒ•ãƒ­ãƒ¼\n\n1. **BuildArticlePrompt**: è¨˜äº‹ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ§‹ç¯‰\n   - ã‚¿ã‚¤ãƒˆãƒ« = ãƒ†ãƒ¼ãƒã‚’ãã®ã¾ã¾ä½¿ç”¨\n   - [IMAGE: xxx] ãƒãƒ¼ã‚«ãƒ¼ã‚’é©åº¦ã«æŒ¿å…¥\n2. **GenerateArticle**: Gemini ã§è¨˜äº‹ç”Ÿæˆ\n3. **ParseArticleJSON**: JSONè§£æï¼ˆå …ç‰¢ãªãƒ‘ãƒ¼ã‚µãƒ¼ï¼‰\n4. **PrepareColumnData**: APIç”¨ãƒ‡ãƒ¼ã‚¿æ•´å½¢\n5. **PostColumn**: APIã«æŠ•ç¨¿",
        "height": 280,
        "width": 340,
        "color": 5
      },
      "id": "3e3e30cb-2ee5-4221-ab62-8f3d3b2bf1a1",
      "name": "âœï¸ è¨˜äº‹ç”Ÿæˆ",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -720,
        560
      ]
    },
    {
      "parameters": {
        "content": "## ğŸ“¢ Slacké€šçŸ¥\n\n**3ç¨®é¡ã®é€šçŸ¥**:\n\n1. âœ… **æŠ•ç¨¿æˆåŠŸé€šçŸ¥** (NotifySlackPosted)\n   - ã‚¿ã‚¤ãƒˆãƒ«ã€ã‚«ãƒ†ã‚´ãƒªã€URL\n\n2. ğŸ“ **æ–°ãƒ†ãƒ¼ãƒç”Ÿæˆé€šçŸ¥** (NotifySlackThemesGenerated)\n   - ç”Ÿæˆã•ã‚ŒãŸãƒ†ãƒ¼ãƒä¸€è¦§\n\n3. âŒ **ã‚¨ãƒ©ãƒ¼é€šçŸ¥** (NotifySlackError)\n   - ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿãƒãƒ¼ãƒ‰ã€ã‚¨ãƒ©ãƒ¼å†…å®¹\n   - â€»ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ™‚ã®ã¿å‹•ä½œ",
        "height": 320,
        "width": 320,
        "color": 2
      },
      "id": "0aef841e-7483-4847-9eea-bc32f1384be0",
      "name": "ğŸ“¢ Slacké€šçŸ¥",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        496,
        560
      ]
    },
    {
      "parameters": {
        "content": "## âš ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°\n\n**Error Trigger**ã‚’ä½¿ç”¨\n\n- ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆæœ‰åŠ¹åŒ–ï¼‰çŠ¶æ…‹ã®æ™‚ã®ã¿å‹•ä½œ\n- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã§ã¯ç™ºç«ã—ã¾ã›ã‚“\n- æœ¬ç•ªé‹ç”¨æ™‚ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã™ã‚‹ã¨Slacké€šçŸ¥",
        "height": 220,
        "width": 340
      },
      "id": "9d6c2d96-ed70-4f6c-a1c0-ca00187d49e4",
      "name": "âš ï¸ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°",
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1520,
        1104
      ]
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 9
            }
          ]
        }
      },
      "id": "35147b7f-fd74-4ca1-ae4f-e310607f81c9",
      "name": "ScheduleTrigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        -1216,
        480
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14",
          "mode": "list",
          "cachedResultName": "TokuSearch"
        },
        "sheetName": {
          "__rl": true,
          "value": "column_themes",
          "mode": "name"
        },
        "options": {}
      },
      "id": "42a66b26-c9ab-4940-9e6f-1680e4cd3bb2",
      "name": "GetUnusedThemes",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -992,
        480
      ],
      "credentials": {
        "googleApi": {
          "id": "r9kAyVencycJeNjy",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// GetUnusedThemesã‹ã‚‰å…¨ãƒ†ãƒ¼ãƒã‚’å–å¾—\nconst allThemes = $input.all().map(item => item.json);\n\n// used=FALSE ã¾ãŸã¯ used ãŒç©ºã®ãƒ†ãƒ¼ãƒã‚’ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°\nconst unusedThemes = allThemes.filter(theme => {\n  const used = theme.used;\n  return used === 'FALSE' || used === false || used === '' || used === null || used === undefined;\n});\n\nconsole.log(`ğŸ“Š å…¨ãƒ†ãƒ¼ãƒæ•°: ${allThemes.length}ä»¶`);\nconsole.log(`ğŸ“Š æœªä½¿ç”¨ãƒ†ãƒ¼ãƒæ•°: ${unusedThemes.length}ä»¶`);\n\n// æœªä½¿ç”¨ãƒ†ãƒ¼ãƒãŒ0ä»¶ã®å ´åˆã¯ã€æ–°ãƒ†ãƒ¼ãƒç”Ÿæˆãƒ•ãƒ­ãƒ¼ã«é€²ã‚€ãŸã‚ã®ãƒ•ãƒ©ã‚°ã‚’è¿”ã™\nif (unusedThemes.length === 0) {\n  console.log(`âš ï¸ æœªä½¿ç”¨ãƒ†ãƒ¼ãƒãŒ0ä»¶ã§ã™ã€‚æ–°ãƒ†ãƒ¼ãƒç”Ÿæˆãƒ•ãƒ­ãƒ¼ã«é€²ã¿ã¾ã™ã€‚`);\n  return [{ json: { _needsGeneration: true, unusedCount: 0 } }];\n}\n\n// æœªä½¿ç”¨ãƒ†ãƒ¼ãƒãŒã‚ã‚‹å ´åˆã¯ã€æœ€åˆã®ã‚¢ã‚¤ãƒ†ãƒ ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ \nconst result = unusedThemes.map((theme, index) => {\n  if (index === 0) {\n    return { json: { ...theme, _needsGeneration: false, unusedCount: unusedThemes.length } };\n  }\n  return { json: theme };\n});\n\nreturn result;"
      },
      "id": "f8a3c4d5-e6b7-8901-c2d3-e4f5a6b7c8d9",
      "name": "FilterUnusedThemes",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -864,
        480
      ]
    },
    {
      "parameters": {
        "jsCode": "const unusedThemes = $input.all().map(item => item.json);\n\nconst randomIndex = Math.floor(Math.random() * unusedThemes.length);\nconst selectedTheme = unusedThemes[randomIndex];\n\nconsole.log(`âœ… ãƒ†ãƒ¼ãƒé¸æŠ: ${selectedTheme.theme}`);\n\nreturn [{ json: selectedTheme }];"
      },
      "id": "a3feabc9-84fa-4741-b7ab-c24c93d84c26",
      "name": "RandomThemeSelection",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -784,
        800
      ]
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict"
          },
          "conditions": [
            {
              "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
              "leftValue": "={{ $json._needsGeneration }}",
              "rightValue": true,
              "operator": {
                "type": "boolean",
                "operation": "equal",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "id": "8f011eae-ad26-48af-8c61-4e7d0d81970d",
      "name": "CheckThemeCount",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [
        -784,
        464
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14",
          "mode": "list",
          "cachedResultName": "TokuSearch"
        },
        "sheetName": {
          "__rl": true,
          "value": "column_themes",
          "mode": "name"
        },
        "options": {}
      },
      "id": "a875f0a2-26b1-4760-a9b0-b31c0cbee2c1",
      "name": "GetAllThemes",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        -544,
        480
      ],
      "credentials": {
        "googleApi": {
          "id": "r9kAyVencycJeNjy",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const allThemes = $input.all().map(item => item.json);\n\nif (allThemes.length === 0) {\n  return [{ json: { nextNo: 1 } }];\n}\n\n// Noã‚«ãƒ©ãƒ ã‹ã‚‰æœ€å¤§å€¤ã‚’å–å¾—\nconst maxNo = Math.max(...allThemes.map(theme => {\n  const no = parseInt(theme.no) || 0;\n  return no;\n}));\n\nconst nextNo = maxNo + 1;\n\nconsole.log(`ğŸ“Š æ—¢å­˜ãƒ†ãƒ¼ãƒæ•°: ${allThemes.length}ä»¶`);\nconsole.log(`ğŸ“Š æœ€å¤§No: ${maxNo}, æ¬¡ã®No: ${nextNo}`);\n\nreturn [{ json: { nextNo, allThemes } }];"
      },
      "id": "747ecde1-3ec3-4724-ad1c-97597ed83fed",
      "name": "CalculateNextNo",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -368,
        480
      ]
    },
    {
      "parameters": {
        "jsCode": "const { nextNo, allThemes } = $json;\nconst themeCount = 10;\n\n// æ—¢å­˜ãƒ†ãƒ¼ãƒã‚’CSVå½¢å¼ã«å¤‰æ›\nlet existingThemesCSV = 'No,ãƒ¬ãƒ™ãƒ«,ã‚¿ã‚¤ãƒˆãƒ«\\n';\nif (allThemes && allThemes.length > 0) {\n  allThemes.forEach(theme => {\n    const no = theme.no || '';\n    const level = theme.level || '';\n    const title = (theme.theme || '').replace(/,/g, 'ï¼Œ'); // CSVåŒºåˆ‡ã‚Šã‚’ç½®æ›\n    existingThemesCSV += `${no},${level},${title}\\n`;\n  });\n}\n\n// ãƒ¬ãƒ™ãƒ«é…åˆ†ï¼ˆãƒãƒ©ãƒ³ã‚¹é…åˆ†ï¼‰\nconst levelDistribution = 'åˆå¿ƒè€…å‘ã‘3ä»¶ï¼ä¸­ç´šè€…ä»¥ä¸Šå‘ã‘3ä»¶ï¼ä¸Šç´šè€…å‘ã‘2ä»¶ï¼è¶…ãƒã‚¤æ´»ç‰¹åŒ–2ä»¶';\n\nconst prompt = 'ã‚ãªãŸã¯ã€ç”Ÿæ´»ã‚’è±Šã‹ã«ã™ã‚‹ç¯€ç´„ãƒ»ãƒã‚¤æ´»ãƒ»ãŠå¾—æƒ…å ±ã®å°‚é–€ãƒ©ã‚¤ã‚¿ãƒ¼ã§ã™ã€‚\\n\\n# å‰æ\\n- æ—¢å­˜ã®ã€ŒãŠå¾—ã‚³ãƒ©ãƒ ãƒ†ãƒ¼ãƒã€ãŒå­˜åœ¨ã—ã¾ã™ã€‚\\n- ã“ã‚Œã‚‰ã¨é‡è¤‡ã—ãªã„ã€æ–°ã—ã„ã‚³ãƒ©ãƒ ãƒ†ãƒ¼ãƒã‚’è¿½åŠ ã§ä½œæˆã—ã¾ã™ã€‚\\n\\n# ä»Šå›ã®ç›®çš„\\n- æ—¢å­˜ãƒ†ãƒ¼ãƒã¨è¢«ã‚‰ãªã„ã€Œæ–°ã—ã„ã‚³ãƒ©ãƒ ãƒ†ãƒ¼ãƒã€ã‚’ ' + themeCount + 'ä»¶ ç”Ÿæˆã—ã¾ã™ã€‚\\n- Noã¯ ' + nextNo + ' ã‹ã‚‰å§‹ã‚ã¦ã€é€£ç•ªã§ä»˜ä¸ã—ã¾ã™ã€‚\\n- ãƒ¬ãƒ™ãƒ«é…åˆ†: ' + levelDistribution + '\\n\\n# æ—¢å­˜ãƒ†ãƒ¼ãƒä¸€è¦§\\n```csv\\n' + existingThemesCSV + '\\n```\\n\\n# ãƒ†ãƒ¼ãƒè¨­è¨ˆãƒ«ãƒ¼ãƒ«\\n- ã‚¸ãƒ£ãƒ³ãƒ«ã¯ã€Œæ—¥å¸¸ç”Ÿæ´»ãƒ»è²·ã„ç‰©ãƒ»æ—…è¡Œãƒ»ãŠé‡‘ãƒ»ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼ãƒ»ãƒã‚¤ãƒ³ãƒˆãƒ»æ™‚çŸ­ã€ãªã©ã‚’å¹…åºƒãå«ã‚ã‚‹ã€‚\\n- æ—¢å­˜ãƒ†ãƒ¼ãƒã¨åŒã˜ãƒ»é¡ä¼¼ã®åˆ‡ã‚Šå£ã«ãªã‚‰ãªã„ã‚ˆã†ã«ã€ã§ãã‚‹é™ã‚Šé‡è¤‡ã‚’é¿ã‘ã‚‹ã€‚\\n- èª­è€…ã®é–¢å¿ƒã‚’å¼•ã\"ç‹¬è‡ªæ€§\"ã®ã‚ã‚‹ãƒ†ãƒ¼ãƒã‚’å¿…ãšå«ã‚ã‚‹ã€‚\\n- ã‚¿ã‚¤ãƒˆãƒ«ã¯çŸ­ãã€ã‚­ãƒ£ãƒƒãƒãƒ¼ã«ã™ã‚‹ã€‚\\n- å°‚é–€ç”¨èªã¯ã§ãã‚‹ã ã‘é¿ã‘ã€ä¸€èˆ¬ã®èª­è€…ã«ã‚‚ã‚ã‹ã‚‹èªå½™ã‚’ä¸­å¿ƒã«ã™ã‚‹ã€‚\\n- é•æ³•è¡Œç‚ºã‚„è¦ç´„é•åã«ã¤ãªãŒã‚‹å†…å®¹ã¯å«ã‚ãªã„ã€‚\\n\\n# ãƒ¬ãƒ™ãƒ«ã”ã¨ã®ã‚¤ãƒ¡ãƒ¼ã‚¸\\n- åˆå¿ƒè€…å‘ã‘: ã€ŒåŸºç¤çŸ¥è­˜ã€ã€Œå…¥é–€ã€ã€Œä»Šæ—¥ã‹ã‚‰ã§ãã‚‹ç°¡å˜ãƒ†ã‚¯ã€ã€Œå¤±æ•—ã—ã‚„ã™ã„ãƒã‚¤ãƒ³ãƒˆã®æ•´ç†ã€ãŒä¸­å¿ƒã€‚\\n- ä¸­ç´šè€…ä»¥ä¸Šå‘ã‘: ã€Œæ¯”è¼ƒã€ã€Œæˆ¦ç•¥ã€ã€Œçµ„ã¿åˆã‚ã›ã€ã€Œå¹´é–“è¨ˆç”»ã€ãªã©ã€ä¸€æ®µæ·±ã„è¦–ç‚¹ã‚’å…¥ã‚Œã‚‹ã€‚\\n- ä¸Šç´šè€…å‘ã‘: ã€Œä»•çµ„ã¿åŒ–ã€ã€Œæ•°å€¤ç®¡ç†ï¼ˆé‚„å…ƒç‡ãƒ»æ™‚é–“å˜ä¾¡ï¼‰ã€ã€Œè¤‡æ•°ã‚µãƒ¼ãƒ“ã‚¹æ¨ªæ–­ã€ãªã©é«˜åº¦ãªå†…å®¹ã€‚\\n- è¶…ãƒã‚¤æ´»ç‰¹åŒ–: ãƒã‚¤ãƒ³ãƒˆå¤šé‡å–ã‚Šãƒ»ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³æ´»ç”¨ãƒ»å¤±åŠ¹ç®¡ç†ãƒ»ç¨é‡‘æ”¯æ‰•ã„ã§ã®ãƒã‚¤ãƒ³ãƒˆç²å¾—ãªã©ã€ãƒã‚¤æ´»ã«å¼·ãç‰¹åŒ–ã—ãŸãƒãƒ‹ã‚¢å‘ã‘ãƒ†ãƒ¼ãƒã‚’ä¸­å¿ƒã«ã™ã‚‹ã€‚\\n\\n# å‡ºåŠ›å½¢å¼ï¼ˆé‡è¦ï¼‰\\n- å‡ºåŠ›ã¯ **CSVå½¢å¼ã®ã¿** ã¨ã—ã€1è¡Œç›®ã¯ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã¨ã—ã¾ã™ã€‚\\n- 1è¡Œç›®: No,ãƒ¬ãƒ™ãƒ«,ã‚¿ã‚¤ãƒˆãƒ«\\n- 2è¡Œç›®ä»¥é™: No,ãƒ¬ãƒ™ãƒ«,ã‚¿ã‚¤ãƒˆãƒ« ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§ **' + themeCount + 'è¡Œåˆ†** å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\\n- No ã¯ ' + nextNo + ' ã‹ã‚‰å§‹ã‚ã¦ã€1ãšã¤å¢—ã‚„ã—ã¦ãã ã•ã„ã€‚\\n- ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ï¼ˆ```ï¼‰ã‚„èª¬æ˜æ–‡ã€æ—¥æœ¬èªã«ã‚ˆã‚‹å‰ç½®ããƒ»ã‚ã¨ãŒããªã©ã€CSVä»¥å¤–ã®æ–‡å­—ã¯ä¸€åˆ‡å‡ºåŠ›ã—ãªã„ã“ã¨ã€‚\\n\\nå‡ºåŠ›ã‚’é–‹å§‹ã—ã¦ãã ã•ã„:';\n\nreturn [{ json: { prompt, nextNo, themeCount } }];"
      },
      "id": "5d8bdd79-5439-4795-ab78-2c1ad9c100cb",
      "name": "BuildThemeGenerationPrompt",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -192,
        480
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list"
        },
        "messages": {
          "values": [
            {
              "content": "={{$json.prompt}}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        0,
        480
      ],
      "id": "64b0b393-83a4-4a16-bd63-892e42c9feb1",
      "name": "GenerateThemes",
      "credentials": {
        "googlePalmApi": {
          "id": "gojn353h4HLDUzF2",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const rawText = $json.content.parts[0].text;\n\n// CSVæŠ½å‡º\nlet csvString = rawText.trim()\n  .replace(/^```csv\\s*/i, '')\n  .replace(/^```\\s*/i, '')\n  .replace(/\\s*```$/i, '')\n  .trim();\n\n// CSVã‚’ãƒ‘ãƒ¼ã‚¹\nconst lines = csvString.split(/\\r?\\n/).filter(line => line.trim());\n\nif (lines.length < 2) {\n  throw new Error('CSVå½¢å¼ãŒä¸æ­£ã§ã™ã€‚ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã¨ãƒ‡ãƒ¼ã‚¿è¡ŒãŒå¿…è¦ã§ã™ã€‚');\n}\n\n// ãƒ˜ãƒƒãƒ€ãƒ¼è¡Œã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦ãƒ‡ãƒ¼ã‚¿è¡Œã‚’ãƒ‘ãƒ¼ã‚¹\nconst themes = [];\nfor (let i = 1; i < lines.length; i++) {\n  const line = lines[i].trim();\n  if (!line) continue;\n  \n  // ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§åˆ†å‰²ï¼ˆãŸã ã—ã€å¼•ç”¨ç¬¦å†…ã®ã‚«ãƒ³ãƒã¯ç„¡è¦–ï¼‰\n  const parts = line.split(',');\n  if (parts.length >= 3) {\n    const no = parts[0].trim();\n    const level = parts[1].trim();\n    const title = parts.slice(2).join(',').trim().replace(/\"+/g, '\"'); // ã‚¿ã‚¤ãƒˆãƒ«å†…ã®ã‚«ãƒ³ãƒå¯¾å¿œ\n    \n    themes.push({\n      no: parseInt(no) || 0,\n      level: level,\n      theme: title,\n      used: 'FALSE'\n    });\n  }\n}\n\nconsole.log(`âœ… ãƒ†ãƒ¼ãƒãƒ‘ãƒ¼ã‚¹å®Œäº†: ${themes.length}ä»¶`);\n\nreturn themes.map(theme => ({ json: theme }));"
      },
      "id": "776bb658-e71a-4858-8a25-a7f0f81d5a4d",
      "name": "ParseThemeCSV",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        304,
        480
      ]
    },
    {
      "parameters": {
        "jsCode": "// æ—¢å­˜ãƒ†ãƒ¼ãƒã‚’å–å¾—ï¼ˆCalculateNextNoã‹ã‚‰ã€ã¾ãŸã¯GetAllThemesã‹ã‚‰ï¼‰\nlet existingThemes = [];\n\ntry {\n  // ã¾ãšCalculateNextNoã‹ã‚‰å–å¾—ã‚’è©¦ã¿ã‚‹\n  const calcData = $items('CalculateNextNo');\n  if (calcData && calcData.length > 0 && calcData[0].json.allThemes) {\n    existingThemes = calcData[0].json.allThemes;\n    console.log(`ğŸ“Š CalculateNextNoã‹ã‚‰æ—¢å­˜ãƒ†ãƒ¼ãƒå–å¾—: ${existingThemes.length}ä»¶`);\n  } else {\n    // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: GetAllThemesã‹ã‚‰å–å¾—\n    const allThemesData = $items('GetAllThemes');\n    if (allThemesData && allThemesData.length > 0) {\n      existingThemes = allThemesData.map(item => item.json);\n      console.log(`ğŸ“Š GetAllThemesã‹ã‚‰æ—¢å­˜ãƒ†ãƒ¼ãƒå–å¾—: ${existingThemes.length}ä»¶`);\n    }\n  }\n} catch (e) {\n  console.log(`âš ï¸ æ—¢å­˜ãƒ†ãƒ¼ãƒå–å¾—ã‚¨ãƒ©ãƒ¼: ${e.message}`);\n  // ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¦ã‚‚ç¶šè¡Œï¼ˆé‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼‰\n}\n\n// ç”Ÿæˆã•ã‚ŒãŸãƒ†ãƒ¼ãƒã‚’å–å¾—ï¼ˆParseThemeCSVã‹ã‚‰ï¼‰\nconst newThemes = $input.all().map(item => item.json);\n\nif (newThemes.length === 0) {\n  throw new Error('âŒ ç”Ÿæˆã•ã‚ŒãŸãƒ†ãƒ¼ãƒãŒã‚ã‚Šã¾ã›ã‚“');\n}\n\n// æ—¢å­˜ãƒ†ãƒ¼ãƒãŒå–å¾—ã§ããªã‹ã£ãŸå ´åˆã¯ã€é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—\nif (existingThemes.length === 0) {\n  console.log(`âš ï¸ æ—¢å­˜ãƒ†ãƒ¼ãƒãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚é‡è¤‡ãƒã‚§ãƒƒã‚¯ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚`);\n  return newThemes.map(theme => ({ json: theme }));\n}\n\n// ãƒ†ãƒ¼ãƒã‚¿ã‚¤ãƒˆãƒ«ã‚’æ­£è¦åŒ–ã™ã‚‹é–¢æ•°ï¼ˆæ¯”è¼ƒç”¨ï¼‰\nfunction normalizeTheme(theme) {\n  if (!theme || typeof theme !== 'string') return '';\n  return theme\n    .toLowerCase()\n    .replace(/[\\sã€€]/g, '') // å…¨è§’ãƒ»åŠè§’ã‚¹ãƒšãƒ¼ã‚¹ã‚’é™¤å»\n    .replace(/[ï¼ï¼Ÿã€‚ã€]/g, '') // å¥èª­ç‚¹ã‚’é™¤å»\n    .trim();\n}\n\n// æ—¢å­˜ãƒ†ãƒ¼ãƒã®æ­£è¦åŒ–æ¸ˆã¿ã‚¿ã‚¤ãƒˆãƒ«ã‚»ãƒƒãƒˆã‚’ä½œæˆ\nconst existingNormalized = new Set(\n  existingThemes\n    .filter(theme => theme && theme.theme)\n    .map(theme => normalizeTheme(theme.theme))\n    .filter(normalized => normalized.length > 0)\n);\n\nconsole.log(`ğŸ“Š æ—¢å­˜ãƒ†ãƒ¼ãƒï¼ˆæ­£è¦åŒ–æ¸ˆã¿ï¼‰: ${existingNormalized.size}ä»¶`);\n\n// é‡è¤‡ãƒã‚§ãƒƒã‚¯\nconst uniqueThemes = [];\nconst duplicateThemes = [];\n\nfor (const newTheme of newThemes) {\n  if (!newTheme.theme) {\n    console.log(`âš ï¸ ãƒ†ãƒ¼ãƒã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºã§ã™ã€‚ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™ã€‚`);\n    continue;\n  }\n  \n  const normalized = normalizeTheme(newTheme.theme);\n  \n  if (normalized.length === 0) {\n    console.log(`âš ï¸ æ­£è¦åŒ–å¾Œã®ãƒ†ãƒ¼ãƒãŒç©ºã§ã™ã€‚ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™: ${newTheme.theme}`);\n    continue;\n  }\n  \n  // å®Œå…¨ä¸€è‡´ãƒã‚§ãƒƒã‚¯\n  if (existingNormalized.has(normalized)) {\n    duplicateThemes.push(newTheme.theme);\n    console.log(`âš ï¸ é‡è¤‡ãƒ†ãƒ¼ãƒæ¤œå‡º: ${newTheme.theme}`);\n    continue;\n  }\n  \n  // éƒ¨åˆ†ä¸€è‡´ãƒã‚§ãƒƒã‚¯ï¼ˆæ—¢å­˜ãƒ†ãƒ¼ãƒã®80%ä»¥ä¸ŠãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆï¼‰\n  let isDuplicate = false;\n  for (const existingNormalizedTheme of existingNormalized) {\n    if (existingNormalizedTheme.length > 0 && normalized.length > 0) {\n      // çŸ­ã„æ–¹ã®æ–‡å­—åˆ—ãŒé•·ã„æ–¹ã«80%ä»¥ä¸Šå«ã¾ã‚Œã¦ã„ã‚‹ã‹ãƒã‚§ãƒƒã‚¯\n      const shorter = existingNormalizedTheme.length < normalized.length \n        ? existingNormalizedTheme \n        : normalized;\n      const longer = existingNormalizedTheme.length >= normalized.length \n        ? existingNormalizedTheme \n        : normalized;\n      \n      if (longer.includes(shorter) && shorter.length / longer.length >= 0.8) {\n        const similarTheme = existingThemes.find(t => normalizeTheme(t.theme) === existingNormalizedTheme);\n        duplicateThemes.push(newTheme.theme);\n        console.log(`âš ï¸ é¡ä¼¼ãƒ†ãƒ¼ãƒæ¤œå‡º: ${newTheme.theme} (é¡ä¼¼: ${similarTheme?.theme || existingNormalizedTheme})`);\n        isDuplicate = true;\n        break;\n      }\n    }\n  }\n  \n  if (!isDuplicate) {\n    uniqueThemes.push(newTheme);\n  }\n}\n\n// çµæœã‚’ãƒ­ã‚°å‡ºåŠ›\nconsole.log(`âœ… é‡è¤‡ãƒã‚§ãƒƒã‚¯å®Œäº†:`);\nconsole.log(`  - ç”Ÿæˆãƒ†ãƒ¼ãƒæ•°: ${newThemes.length}ä»¶`);\nconsole.log(`  - é‡è¤‡ãƒ†ãƒ¼ãƒæ•°: ${duplicateThemes.length}ä»¶`);\nconsole.log(`  - ãƒ¦ãƒ‹ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒæ•°: ${uniqueThemes.length}ä»¶`);\n\nif (duplicateThemes.length > 0) {\n  console.log(`âš ï¸ é‡è¤‡ãƒ†ãƒ¼ãƒä¸€è¦§: ${duplicateThemes.join(', ')}`);\n}\n\nif (uniqueThemes.length === 0) {\n  throw new Error(`âŒ ã™ã¹ã¦ã®ãƒ†ãƒ¼ãƒãŒé‡è¤‡ã—ã¦ã„ã¾ã™ã€‚ç”Ÿæˆã•ã‚ŒãŸ${newThemes.length}ä»¶ã™ã¹ã¦ãŒæ—¢å­˜ãƒ†ãƒ¼ãƒã¨é‡è¤‡ã—ã¦ã„ã¾ã™ã€‚`);\n}\n\n// ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ†ãƒ¼ãƒã®ã¿ã‚’è¿”ã™\nreturn uniqueThemes.map(theme => ({ json: theme }));"
      },
      "id": "3aec1bb7-5e9d-4c76-a599-921dbac7e683",
      "name": "CheckThemeDuplicates",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        384,
        480
      ]
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14",
          "mode": "list",
          "cachedResultName": "TokuSearch"
        },
        "sheetName": {
          "__rl": true,
          "value": "column_themes",
          "mode": "name"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "no": "={{ $json.no }}",
            "level": "={{ $json.level }}",
            "theme": "={{ $json.theme }}",
            "used": "={{ $json.used }}"
          }
        },
        "options": {}
      },
      "id": "578aa89d-1387-4bc8-b232-afeb7af438ad",
      "name": "AddThemesToSheet",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        464,
        480
      ],
      "credentials": {
        "googleApi": {
          "id": "r9kAyVencycJeNjy",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// BuildSlackThemesMessageã‹ã‚‰æ¸¡ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã«ã¯themesé…åˆ—ãŒå«ã¾ã‚Œã¦ã„ã‚‹\nconst inputData = $json;\n\n// themesé…åˆ—ã‚’å–å¾—ï¼ˆBuildSlackThemesMessageã‹ã‚‰æ¸¡ã•ã‚Œã‚‹å ´åˆï¼‰\nlet newThemes = inputData.themes;\n\n// ã‚‚ã—themesãŒãªã„å ´åˆã¯ã€å…¥åŠ›å…¨ä½“ã‚’ãƒ†ãƒ¼ãƒã¨ã—ã¦æ‰±ã†ï¼ˆãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰\nif (!newThemes || !Array.isArray(newThemes) || newThemes.length === 0) {\n  newThemes = $input.all().map(item => item.json);\n}\n\nif (newThemes.length === 0) {\n  throw new Error('âŒ ç”Ÿæˆã•ã‚ŒãŸãƒ†ãƒ¼ãƒãŒã‚ã‚Šã¾ã›ã‚“');\n}\n\nconst randomIndex = Math.floor(Math.random() * newThemes.length);\nconst selectedTheme = newThemes[randomIndex];\n\nconsole.log(`âœ… æ–°è¦ãƒ†ãƒ¼ãƒã‹ã‚‰é¸æŠ: ${selectedTheme.theme}`);\nconsole.log(`ğŸ“Š é¸æŠã•ã‚ŒãŸãƒ†ãƒ¼ãƒNo: ${selectedTheme.no}`);\n\nreturn [{ json: selectedTheme }];"
      },
      "id": "43771d08-6c26-4985-9632-46bd158b7dd2",
      "name": "SelectFromNewThemes",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -784,
        1056
      ]
    },
    {
      "parameters": {
        "jsCode": "const columnData = $items('PrepareColumnData')[0].json;\n\nconst message = `ğŸ‰ ã‚³ãƒ©ãƒ è‡ªå‹•ç”Ÿæˆå®Œäº†ï¼\n\nã‚¿ã‚¤ãƒˆãƒ«: ${columnData.title}\nã‚«ãƒ†ã‚´ãƒª: ${columnData.category}\nURL: https://tokusearch.vercel.app/columns/${columnData.slug}\n\nâ€»ç”»åƒãªã—ç‰ˆ`;\n\nreturn [{ json: { text: message, url: `https://tokusearch.vercel.app/columns/${columnData.slug}`, title: columnData.title } }];"
      },
      "id": "7f7e2c09-1f80-4204-84b1-f945cd0a9335",
      "name": "BuildSlackPostedMessage",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        576,
        800
      ]
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "#daily_o-toku",
          "mode": "name"
        },
        "text": "={{ $json.text }}",
        "otherOptions": {
          "includeLinkToWorkflow": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        800,
        800
      ],
      "id": "4a4c7e36-07fc-4e57-88da-e5a484e03498",
      "name": "NotifySlackPosted",
      "webhookId": "a1ea8121-abd5-4a24-a6b4-655ddf5a6594",
      "credentials": {
        "slackApi": {
          "id": "kahTvH10blaEP2kb",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const themes = $input.all().map(item => item.json);\n\nlet message = `ğŸ“ æ–°è¦ã‚³ãƒ©ãƒ ãƒ†ãƒ¼ãƒç”Ÿæˆå®Œäº†ï¼\n\nç”Ÿæˆæ•°: ${themes.length}ä»¶\\n\\n`;\n\nmessage += '```\\n';\nmessage += 'No,ãƒ¬ãƒ™ãƒ«,ã‚¿ã‚¤ãƒˆãƒ«\\n';\nthemes.forEach(theme => {\n  message += `${theme.no},${theme.level},${theme.theme}\\n`;\n});\nmessage += '```';\n\nreturn [{ json: { text: message, themes: themes } }];"
      },
      "id": "65ce9a25-a0ab-4b3d-9e98-7a29c31ca410",
      "name": "BuildSlackThemesMessage",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        624,
        480
      ]
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "#daily_o-toku",
          "mode": "name"
        },
        "text": "={{ $json.text }}",
        "otherOptions": {
          "includeLinkToWorkflow": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        1136,
        1104
      ],
      "id": "c28c526d-1377-470a-844c-6094cbcee53e",
      "name": "NotifySlackThemesGenerated",
      "webhookId": "a1ea8121-abd5-4a24-a6b4-655ddf5a6594",
      "credentials": {
        "slackApi": {
          "id": "kahTvH10blaEP2kb",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const theme = $json.theme;\nconst level = $json.level;\nconst themeNo = $json.no;\n\n// ã‚¿ã‚¤ãƒˆãƒ«ã¯ãƒ†ãƒ¼ãƒã‚’ãã®ã¾ã¾ä½¿ç”¨\nconst prompt = `\nã‚ãªãŸã¯JSONç”Ÿæˆã®å°‚é–€å®¶ã§ã™ã€‚æœ‰åŠ¹ãªJSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚\n\n## è¨˜äº‹æƒ…å ±\n- ã‚¿ã‚¤ãƒˆãƒ«: ${theme}\n- ãƒ¬ãƒ™ãƒ«: ${level}\n\n## é‡è¦ãªãƒ«ãƒ¼ãƒ«\n1. JSONã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®ã¿ã‚’å‡ºåŠ›ï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã€èª¬æ˜æ–‡ã¯ä¸è¦ï¼‰\n2. { ã§å§‹ã¾ã‚Š } ã§çµ‚ã‚ã‚‹ã“ã¨\n3. content_markdownå†…ã®æ”¹è¡Œã¯ \\\\n ã‚’ä½¿ç”¨\n4. ç‰¹æ®Šæ–‡å­—ï¼ˆå¼•ç”¨ç¬¦ã€ãƒãƒƒã‚¯ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ï¼‰ã¯é©åˆ‡ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—\n5. content_markdownã¯2500ã€œ3500æ–‡å­—ç¨‹åº¦\n6. é‡è¦ãªæƒ…å ±ã«ã¯ <mark>ãƒ†ã‚­ã‚¹ãƒˆ</mark> ã‚’ä½¿ç”¨ï¼ˆé»„è‰²èƒŒæ™¯+ä¸‹ç·šã§è¡¨ç¤ºï¼‰\n7. å¼·èª¿ã«ã¯ **å¤ªå­—** ã‚’ä½¿ç”¨\n\n## å‡ºåŠ›ã™ã‚‹JSONã®æ§‹é€ \n{\n  \"title\": \"${theme}\",\n  \"description\": \"è¨˜äº‹ã®è¦ç´„ï¼ˆ80ã€œ120æ–‡å­—ï¼‰\",\n  \"content_markdown\": \"è¨˜äº‹æœ¬æ–‡ï¼ˆMarkdownå½¢å¼ï¼‰\",\n  \"category\": \"ä»¥ä¸‹ã‹ã‚‰1ã¤é¸æŠ: ãƒã‚¤ãƒ³ãƒˆæ´»ç”¨, ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰, ç¯€ç´„è¡“, æ—…è¡Œ, ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¬ã‚¹, å®¶è¨ˆç®¡ç†, ãµã‚‹ã•ã¨ç´ç¨\",\n  \"tags\": \"ã‚¿ã‚°1,ã‚¿ã‚°2,ã‚¿ã‚°3\"\n}\n\n## è¨˜äº‹ã®æ§‹æˆï¼ˆcontent_markdownï¼‰\n1. **å°å…¥**ï¼ˆèª­è€…ã®æ‚©ã¿ã¨è§£æ±ºç­–ã®æç¤ºï¼‰\n2. **åŸºæœ¬ã®è€ƒãˆæ–¹**ï¼ˆã‚³ã‚¢ã‚³ãƒ³ã‚»ãƒ—ãƒˆã®èª¬æ˜ï¼‰\n3. **å…·ä½“çš„ãªã‚¹ãƒ†ãƒƒãƒ—**ï¼ˆå®Ÿè·µæ–¹æ³•ã‚’é †åºç«‹ã¦ã¦ï¼‰\n4. **æ³¨æ„ç‚¹ãƒ»ã‚ˆãã‚ã‚‹å¤±æ•—**ï¼ˆé¿ã‘ã‚‹ã¹ããƒã‚¤ãƒ³ãƒˆï¼‰\n5. **ã¾ã¨ã‚**ï¼ˆè¦ç‚¹ã®æŒ¯ã‚Šè¿”ã‚Šï¼‰\n\n## èª­ã¿ã‚„ã™ã•ã®ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæŒ‡é‡\n- å„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¾Œã«ç©ºè¡Œã‚’å…¥ã‚Œã‚‹ï¼ˆ\\\\n\\\\nï¼‰\n- ç®‡æ¡æ›¸ãã®å‰å¾Œã«ã‚‚ç©ºè¡Œã‚’å…¥ã‚Œã‚‹\n- é•·ã„æ®µè½ã¯2ã€œ3æ–‡ã”ã¨ã«æ”¹è¡Œã‚’å…¥ã‚Œã‚‹\n- è¦‹å‡ºã—ï¼ˆ##ï¼‰ã®å‰ã«ã¯å¿…ãšç©ºè¡Œã‚’å…¥ã‚Œã‚‹\n- 1æ–‡ã¯60æ–‡å­—ä»¥å†…ã‚’ç›®å®‰ã«\n\n## è£…é£¾ã®ä½¿ã„æ–¹\n- **å¤ªå­—**: é‡è¦ãªç”¨èªã€æ•°å­—ï¼ˆå„ã‚»ã‚¯ã‚·ãƒ§ãƒ³2ã€œ3ç®‡æ‰€ï¼‰\n- <mark>ãƒã‚¤ãƒ©ã‚¤ãƒˆ</mark>: çµ¶å¯¾ã«è¦šãˆã¦ã»ã—ã„æƒ…å ±ï¼ˆè¨˜äº‹å…¨ä½“ã§1ã€œ3ç®‡æ‰€ï¼‰\n  - ä½¿ç”¨åŸºæº–: æ ¸å¿ƒã¨ãªã‚‹æ¦‚å¿µã€é‡å¤§ãªæ³¨æ„ç‚¹ã€é‡è¦ãªæ•°å­—ãƒ»æœŸé™\n  - ä¾‹: <mark>ãƒã‚¤ãƒ³ãƒˆé‚„å…ƒç‡20%ã¯11æœˆ30æ—¥ã¾ã§</mark>\n- ç®‡æ¡æ›¸ãï¼ˆ- ã¾ãŸã¯ *ï¼‰: ãƒªã‚¹ãƒˆã®å ´åˆ\n- ç•ªå·ä»˜ããƒªã‚¹ãƒˆï¼ˆ1. 2. 3.ï¼‰: æ‰‹é †ã®å ´åˆ\n\n## ç”»åƒãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼\n- [IMAGE: èª¬æ˜] ã®å½¢å¼ã§ã€UIçš„ã«ç”»åƒãŒã‚ã‚‹ã¨ç†è§£ã—ã‚„ã™ã„ç®‡æ‰€ã«æŒ¿å…¥\n- è¨˜äº‹å…¨ä½“ã§2ã€œ4ç®‡æ‰€ç¨‹åº¦ã€è‡ªç„¶ãªä½ç½®ã«é…ç½®\n- æ®µè½ã®åŒºåˆ‡ã‚Šï¼ˆç©ºè¡Œã®å¾Œï¼‰ã«é…ç½®ã™ã‚‹ã“ã¨\n- ä¾‹:\n  * [IMAGE: ãƒã‚¤ãƒ³ãƒˆé‚„å…ƒç‡ã®æ¯”è¼ƒè¡¨]\n  * [IMAGE: ç”³ã—è¾¼ã¿æ‰‹é †ã®ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ]\n  * [IMAGE: ã‚¢ãƒ—ãƒªã®ç”»é¢ã‚¤ãƒ¡ãƒ¼ã‚¸]\n  * [IMAGE: ç¯€ç´„åŠ¹æœã®ã‚°ãƒ©ãƒ•]\n\n## å‡ºåŠ›é–‹å§‹\nJSONã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„:\n`.trim();\n\nreturn [{ json: { prompt, theme, level, themeNo } }];"
      },
      "id": "f195ee61-6021-448c-91c9-12dd1d2d0f77",
      "name": "BuildArticlePrompt",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -608,
        800
      ]
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list"
        },
        "messages": {
          "values": [
            {
              "content": "={{$json.prompt}}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -416,
        800
      ],
      "id": "53905827-5b81-4af0-a427-c4e82a4e008b",
      "name": "GenerateArticle",
      "credentials": {
        "googlePalmApi": {
          "id": "gojn353h4HLDUzF2",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// LLMã‹ã‚‰ã®ç”Ÿãƒ†ã‚­ã‚¹ãƒˆã‚’å–å¾—\nconst rawText = $json.content.parts[0].text;\nconsole.log('ğŸ“¥ LLMå‡ºåŠ›ï¼ˆå…ˆé ­500æ–‡å­—ï¼‰:', rawText.substring(0, 500));\n\n// Step 1: ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã‚’é™¤å»ã—ã¦JSONã‚’æŠ½å‡º\nlet jsonString = rawText.trim();\n\n// ```json ... ``` ã‚„ ``` ... ``` ã‚’é™¤å»\njsonString = jsonString.replace(/^```(?:json)?\\s*/i, '').replace(/\\s*```$/i, '').trim();\n\n// Step 2: JSONã® { } ã‚’è¦‹ã¤ã‘ã‚‹\nconst jsonStart = jsonString.indexOf('{');\nconst jsonEnd = jsonString.lastIndexOf('}');\n\nif (jsonStart === -1 || jsonEnd === -1 || jsonEnd <= jsonStart) {\n  throw new Error('JSONã® { } ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚LLMå‡ºåŠ›: ' + rawText.substring(0, 200));\n}\n\njsonString = jsonString.substring(jsonStart, jsonEnd + 1);\nconsole.log('ğŸ“ JSONæŠ½å‡ºå®Œäº†ï¼ˆé•·ã•: ' + jsonString.length + 'æ–‡å­—ï¼‰');\n\n// Step 3: å …ç‰¢ãªJSONãƒ‘ãƒ¼ã‚µãƒ¼\nfunction robustJSONParse(str) {\n  // è©¦è¡Œ1: ãã®ã¾ã¾ãƒ‘ãƒ¼ã‚¹\n  try {\n    return JSON.parse(str);\n  } catch (e1) {\n    console.log('âš ï¸ é€šå¸¸ãƒ‘ãƒ¼ã‚¹å¤±æ•—ã€ä¿®æ­£ã‚’è©¦è¡Œ...');\n  }\n  \n  // è©¦è¡Œ2: åˆ¶å¾¡æ–‡å­—ã‚’é™¤å»\n  let fixed = str;\n  \n  // åˆ¶å¾¡æ–‡å­—ï¼ˆ0x00-0x1Fã€ãŸã ã—\\t\\n\\rã¯é™¤ãï¼‰ã‚’é™¤å»\n  fixed = fixed.replace(/[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F]/g, '');\n  \n  try {\n    return JSON.parse(fixed);\n  } catch (e2) {\n    console.log('âš ï¸ åˆ¶å¾¡æ–‡å­—é™¤å»å¾Œã‚‚å¤±æ•—ã€ã•ã‚‰ã«ä¿®æ­£...');\n  }\n  \n  // è©¦è¡Œ3: content_markdownå†…ã®å•é¡Œã‚’ä¿®æ­£\n  // \"content_markdown\": \"...\" ã®éƒ¨åˆ†ã‚’ç‰¹å®šã—ã¦å‡¦ç†\n  const cmMatch = fixed.match(/\"content_markdown\"\\s*:\\s*\"/);\n  if (cmMatch) {\n    const cmStart = fixed.indexOf(cmMatch[0]) + cmMatch[0].length;\n    \n    // çµ‚äº†ä½ç½®ã‚’æ¢ã™ï¼ˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã¦ã„ãªã„\"ï¼‰\n    let cmEnd = cmStart;\n    let i = cmStart;\n    while (i < fixed.length) {\n      if (fixed[i] === '\\\\') {\n        i += 2; // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’ã‚¹ã‚­ãƒƒãƒ—\n        continue;\n      }\n      if (fixed[i] === '\"') {\n        cmEnd = i;\n        break;\n      }\n      i++;\n    }\n    \n    if (cmEnd > cmStart) {\n      let content = fixed.substring(cmStart, cmEnd);\n      \n      // å®Ÿéš›ã®æ”¹è¡Œã‚’\\nã«å¤‰æ›\n      content = content.replace(/\\r\\n/g, '\\\\n').replace(/\\n/g, '\\\\n').replace(/\\r/g, '\\\\n');\n      \n      // ã‚¿ãƒ–ã‚’ã‚¹ãƒšãƒ¼ã‚¹ã«\n      content = content.replace(/\\t/g, '  ');\n      \n      fixed = fixed.substring(0, cmStart) + content + fixed.substring(cmEnd);\n    }\n  }\n  \n  try {\n    return JSON.parse(fixed);\n  } catch (e3) {\n    console.log('âš ï¸ content_markdownä¿®æ­£å¾Œã‚‚å¤±æ•—ã€æœ€çµ‚æ‰‹æ®µ...');\n  }\n  \n  // è©¦è¡Œ4: å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å€‹åˆ¥ã«æŠ½å‡ºã—ã¦å†æ§‹ç¯‰\n  const titleMatch = str.match(/\"title\"\\s*:\\s*\"([^\"]*)\"/i);\n  const descMatch = str.match(/\"description\"\\s*:\\s*\"([^\"]*)\"/i);\n  const categoryMatch = str.match(/\"category\"\\s*:\\s*\"([^\"]*)\"/i);\n  const tagsMatch = str.match(/\"tags\"\\s*:\\s*\"([^\"]*)\"/i);\n  \n  // content_markdownã¯ç‰¹æ®Šå‡¦ç†ï¼ˆé•·ã„ãŸã‚ï¼‰\n  const cmStartMatch = str.match(/\"content_markdown\"\\s*:\\s*\"/);\n  let contentMarkdown = '';\n  \n  if (cmStartMatch) {\n    const startIdx = str.indexOf(cmStartMatch[0]) + cmStartMatch[0].length;\n    // \"category\" ã‚„ \"tags\" ã®ç›´å‰ã¾ã§å–å¾—\n    const endPatterns = ['\"category\"', '\"tags\"', '\"description\"'];\n    let endIdx = str.length;\n    \n    for (const pattern of endPatterns) {\n      const idx = str.indexOf(pattern, startIdx);\n      if (idx > startIdx && idx < endIdx) {\n        // \"ã®å‰ã§çµ‚ã‚ã‚‹\n        let tempIdx = idx - 1;\n        while (tempIdx > startIdx && str[tempIdx] !== '\"') {\n          tempIdx--;\n        }\n        if (tempIdx > startIdx) {\n          endIdx = Math.min(endIdx, tempIdx);\n        }\n      }\n    }\n    \n    contentMarkdown = str.substring(startIdx, endIdx);\n    // æœ«å°¾ã®ä¸è¦ãªæ–‡å­—ã‚’é™¤å»\n    contentMarkdown = contentMarkdown.replace(/\\s*,\\s*$/, '').replace(/\"\\s*,\\s*$/, '');\n  }\n  \n  if (titleMatch && contentMarkdown) {\n    console.log('âœ… ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰å€‹åˆ¥æŠ½å‡ºã§æˆåŠŸ');\n    return {\n      title: titleMatch[1],\n      description: descMatch ? descMatch[1] : '',\n      content_markdown: contentMarkdown.replace(/\\\\n/g, '\\n').replace(/\\\\t/g, '\\t'),\n      category: categoryMatch ? categoryMatch[1] : 'ãƒã‚¤ãƒ³ãƒˆæ´»ç”¨',\n      tags: tagsMatch ? tagsMatch[1] : ''\n    };\n  }\n  \n  // å…¨ã¦å¤±æ•—\n  throw new Error('JSONãƒ‘ãƒ¼ã‚¹å¤±æ•—: ã™ã¹ã¦ã®ä¿®æ­£è©¦è¡ŒãŒå¤±æ•—ã—ã¾ã—ãŸ');\n}\n\nconst article = robustJSONParse(jsonString);\n\n// å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®æ¤œè¨¼\nif (!article.title) {\n  throw new Error('titleãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“');\n}\nif (!article.content_markdown) {\n  throw new Error('content_markdownãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“');\n}\n\n// ã‚¿ã‚¤ãƒˆãƒ«ã‚’ãƒ†ãƒ¼ãƒã§ä¸Šæ›¸ãï¼ˆç¢ºå®Ÿã«ãƒ†ãƒ¼ãƒ=ã‚¿ã‚¤ãƒˆãƒ«ã«ã™ã‚‹ï¼‰\nconst theme = $items('BuildArticlePrompt')[0].json.theme;\n\nconst result = {\n  ...article,\n  title: theme, // ãƒ†ãƒ¼ãƒã‚’ãã®ã¾ã¾ã‚¿ã‚¤ãƒˆãƒ«ã¨ã—ã¦ä½¿ç”¨\n  theme: theme,\n  level: $items('BuildArticlePrompt')[0].json.level,\n  themeNo: $items('BuildArticlePrompt')[0].json.themeNo\n};\n\nconsole.log('âœ… è¨˜äº‹ãƒ‘ãƒ¼ã‚¹å®Œäº†:', result.title);\n\nreturn [{ json: result }];"
      },
      "id": "e624c88a-72c7-45fa-b7ca-f7fbdad5a1cf",
      "name": "ParseArticleJSON",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -64,
        800
      ]
    },
    {
      "parameters": {
        "jsCode": "const articleData = $json;\n\n// æ—¥æœ¬èªå¯¾å¿œã®ã‚¹ãƒ©ãƒƒã‚°ç”Ÿæˆï¼ˆlib/columns.tsã¨å®Œå…¨ä¸€è‡´ï¼‰\nconst slug = articleData.title\n  .toLowerCase()\n  .replace(/[^a-z0-9\\u3040-\\u309f\\u30a0-\\u30ff\\u4e00-\\u9faf]+/g, '-')\n  .replace(/^-+|-+$/g, '');\n\nconst content_html = articleData.content_markdown\n  .replace(/^### (.*$)/gim, '<h3>$1</h3>')\n  .replace(/^## (.*$)/gim, '<h2>$1</h2>')\n  .replace(/^# (.*$)/gim, '<h1>$1</h1>')\n  .replace(/\\*\\*(.*?)\\*\\*/gim, '<strong>$1</strong>')\n  .replace(/\\*(.*?)\\*/gim, '<em>$1</em>')\n  .replace(/\\n\\n/gim, '</p><p>')\n  .replace(/\\n/gim, '<br>');\n\nconst columnData = {\n  slug: slug,\n  title: articleData.title,\n  description: articleData.description,\n  content_markdown: articleData.content_markdown,\n  content_html: '<p>' + content_html + '</p>',\n  category: articleData.category,\n  tags: articleData.tags,\n  thumbnail_url: '',\n  author: 'TokuSearch AI',\n  status: 'published',\n  is_featured: false,\n  theme: articleData.theme,\n  themeNo: articleData.themeNo\n};\n\nconsole.log('âœ… ãƒ‡ãƒ¼ã‚¿æº–å‚™å®Œäº†:', columnData.title);\nconsole.log('ğŸ“ ç”Ÿæˆã•ã‚ŒãŸã‚¹ãƒ©ãƒƒã‚°:', slug);\n\nreturn [{ json: columnData }];"
      },
      "id": "a7a49e42-f65f-4fce-a7ad-cb7856738020",
      "name": "PrepareColumnData",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        112,
        800
      ]
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://tokusearch.vercel.app/api/admin/columns",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpHeaderAuth",
        "sendBody": true,
        "specifyBody": "json",
        "jsonBody": "={{ $json }}",
        "options": {}
      },
      "id": "8c6786b4-11ea-4a23-9f1f-f9df2fc55520",
      "name": "PostColumn",
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        304,
        800
      ],
      "credentials": {
        "httpHeaderAuth": {
          "id": "RT6aq4TB1Vj8V2Tn",
          "name": "Credential Name"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "appendOrUpdate",
        "documentId": {
          "__rl": true,
          "value": "1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14",
          "mode": "list",
          "cachedResultName": "TokuSearch",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": 348743133,
          "mode": "list",
          "cachedResultName": "column_themes",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14/edit#gid=348743133"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "no": "={{$items('BuildArticlePrompt')[0].json.themeNo}}",
            "used": "TRUE",
            "used_at": "={{new Date().toISOString()}}"
          },
          "matchingColumns": [
            "no"
          ],
          "schema": [
            {
              "id": "no",
              "displayName": "no",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "level",
              "displayName": "level",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "theme",
              "displayName": "theme",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "used",
              "displayName": "used",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "used_at",
              "displayName": "used_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "row_number",
              "displayName": "row_number",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "readOnly": true,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "id": "636179be-4f5f-4b38-8548-61add7255fee",
      "name": "UpdateThemeUsed",
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1072,
        800
      ],
      "alwaysOutputData": true,
      "credentials": {
        "googleApi": {
          "id": "r9kAyVencycJeNjy",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const columnData = $items('PrepareColumnData')[0].json;\n\nconst message = `ğŸ‰ ã‚³ãƒ©ãƒ è‡ªå‹•ç”Ÿæˆå®Œäº†ï¼\n\nã‚¿ã‚¤ãƒˆãƒ«: ${columnData.title}\nã‚«ãƒ†ã‚´ãƒª: ${columnData.category}\nURL: https://tokusearch.vercel.app/columns/${columnData.slug}\n\nâ€»ç”»åƒãªã—ç‰ˆ`;\n\nconsole.log(message);\n\nreturn [{ json: { message, success: true } }];"
      },
      "id": "40edb6d5-a7ea-4a5f-924d-4fe0d2df818c",
      "name": "BuildCompletionMessage",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1312,
        800
      ]
    },
    {
      "parameters": {},
      "id": "e2595f60-9b68-4405-bb83-a3f23401e5c4",
      "name": "ErrorTrigger",
      "type": "n8n-nodes-base.errorTrigger",
      "typeVersion": 1,
      "position": [
        -1216,
        1264
      ]
    },
    {
      "parameters": {
        "jsCode": "// Error Triggerã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\nconst execution = $json.execution || {};\nconst workflow = $json.workflow || {};\n\nconst nodeName = execution.lastNodeExecuted || 'Unknown';\nconst errorData = execution.error || {};\nconst errorMessage = errorData.message || 'ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ';\nconst workflowName = workflow.name || 'ã‚³ãƒ©ãƒ è‡ªå‹•ç”Ÿæˆ';\n\nconst message = `âŒ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ\n\nãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼: ${workflowName}\nãƒãƒ¼ãƒ‰: ${nodeName}\nã‚¨ãƒ©ãƒ¼å†…å®¹: ${errorMessage}\næ™‚åˆ»: ${new Date().toISOString()}\n\nãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`;\n\nreturn [{ json: { text: message } }];"
      },
      "id": "3e45e904-93e9-4616-a482-63230e482a99",
      "name": "BuildSlackErrorMessage",
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -992,
        1264
      ]
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "#daily_o-toku",
          "mode": "name"
        },
        "text": "={{ $json.text }}",
        "otherOptions": {
          "includeLinkToWorkflow": true
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        -784,
        1264
      ],
      "id": "0cd77e2c-0341-46d4-ba6c-85af5d01570e",
      "name": "NotifySlackError",
      "webhookId": "a1ea8121-abd5-4a24-a6b4-655ddf5a6594",
      "credentials": {
        "slackApi": {
          "id": "kahTvH10blaEP2kb",
          "name": "Slack account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "ScheduleTrigger": {
      "main": [
        [
          {
            "node": "GetUnusedThemes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GetUnusedThemes": {
      "main": [
        [
          {
            "node": "FilterUnusedThemes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FilterUnusedThemes": {
      "main": [
        [
          {
            "node": "CheckThemeCount",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CheckThemeCount": {
      "main": [
        [
          {
            "node": "RandomThemeSelection",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "GetAllThemes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GetAllThemes": {
      "main": [
        [
          {
            "node": "CalculateNextNo",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CalculateNextNo": {
      "main": [
        [
          {
            "node": "BuildThemeGenerationPrompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildThemeGenerationPrompt": {
      "main": [
        [
          {
            "node": "GenerateThemes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GenerateThemes": {
      "main": [
        [
          {
            "node": "ParseThemeCSV",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ParseThemeCSV": {
      "main": [
        [
          {
            "node": "CheckThemeDuplicates",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CheckThemeDuplicates": {
      "main": [
        [
          {
            "node": "AddThemesToSheet",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AddThemesToSheet": {
      "main": [
        [
          {
            "node": "BuildSlackThemesMessage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildSlackThemesMessage": {
      "main": [
        [
          {
            "node": "NotifySlackThemesGenerated",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NotifySlackThemesGenerated": {
      "main": [
        [
          {
            "node": "SelectFromNewThemes",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SelectFromNewThemes": {
      "main": [
        [
          {
            "node": "BuildArticlePrompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RandomThemeSelection": {
      "main": [
        [
          {
            "node": "BuildArticlePrompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildArticlePrompt": {
      "main": [
        [
          {
            "node": "GenerateArticle",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GenerateArticle": {
      "main": [
        [
          {
            "node": "ParseArticleJSON",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ParseArticleJSON": {
      "main": [
        [
          {
            "node": "PrepareColumnData",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PrepareColumnData": {
      "main": [
        [
          {
            "node": "PostColumn",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "PostColumn": {
      "main": [
        [
          {
            "node": "BuildSlackPostedMessage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildSlackPostedMessage": {
      "main": [
        [
          {
            "node": "NotifySlackPosted",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "NotifySlackPosted": {
      "main": [
        [
          {
            "node": "UpdateThemeUsed",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UpdateThemeUsed": {
      "main": [
        [
          {
            "node": "BuildCompletionMessage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ErrorTrigger": {
      "main": [
        [
          {
            "node": "BuildSlackErrorMessage",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildSlackErrorMessage": {
      "main": [
        [
          {
            "node": "NotifySlackError",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "7af99a6f-779b-4633-a900-568db5906a3d",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "fefffd21e64fa94994bb4bf38b5a050c59f6cf28bd3cad9da0a5804220d9e97f"
  },
  "id": "lPXWsFe187M5lr0T",
  "tags": []
}