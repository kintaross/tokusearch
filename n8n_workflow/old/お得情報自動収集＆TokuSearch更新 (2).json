{
  "name": "ãŠå¾—æƒ…å ±è‡ªå‹•åé›†ï¼†TokuSearchæ›´æ–°",
  "nodes": [
    {
      "parameters": {
        "jsCode": "// Grokã‹ã‚‰è¿”ã£ã¦ããŸ\"choices[0].message.content\"ã«JSONæ–‡å­—åˆ—ãŒã‚ã‚‹\ntry {\n  const response = $json.choices[0].message.content;\n  const items = JSON.parse(response); // æ–‡å­—åˆ—â†’é…åˆ—ã«å¤‰æ›\n  return items.map(item => ({ json: item }));\n} catch (err) {\n  return [{ json: { error: true, message: err.message } }];\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1216,
        480
      ],
      "id": "c968a5b1-fe9c-493c-bbf1-280d33dcf7a2",
      "name": "ParseGrokResponse"
    },
    {
      "parameters": {
        "jsCode": "// æ—¥ä»˜ãƒ­ã‚¸ãƒƒã‚¯: éå»24æ™‚é–“ä»¥å†…ã«å¤‰æ›´ï¼ˆçµ‚äº†æƒ…å ±æ¸›ã‚‰ã™ï¼‰[1]\nconst now = new Date();\nconst oneDayAgo = new Date(now.getTime() - 24 * 60 * 60 * 1000);\nconst formatDate = (date) => date.toISOString().slice(0, 10);\nconst startDate = formatDate(oneDayAgo);\nconst endDate = formatDate(now);\n\n// æ”¹å–„ç‰ˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ: çµ‚äº†æƒ…å ±é™¤å¤–ã€ä¿¡é ¼æ€§ãƒ•ã‚£ãƒ«ã‚¿ã€é¡ä¼¼æƒ…å ±è¿½åŠ ã€æŠ½é¸/ãƒ•ã‚©ãƒ­ãƒ¼/æŠ•è³‡é™¤å¤–[1]\nconst prompt = `\n${startDate}ã€œ${endDate} ã®æœŸé–“ã«X(Twitter)ã§æŠ•ç¨¿ã•ã‚ŒãŸã€ŒãŠå¾—æƒ…å ±ã€ã‚’åé›†ã—ã€ä»¥ä¸‹ã®JSONé…åˆ—å½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ã€‚[1]\n\n**é‡è¦**: å‡ºåŠ›ã¯ç´”ç²‹ãªJSONã®ã¿ã€‚ã‚³ãƒ¼ãƒ‰ãƒ•ã‚§ãƒ³ã‚¹(\\`\\`\\`)ã‚„èª¬æ˜æ–‡ã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚[1]\n\n[\n{\n\"date\": \"YYYY-MM-DD\",\n\"title\": \"ãŠå¾—æƒ…å ±ã®è¦‹å‡ºã—\",\n\"summary\": \"çŸ­ã„è¦ç´„ï¼ˆæœ¬æ–‡ã‚’å‡ç¸®ï¼‰\",\n\"detail\": \"å‰²å¼•ãƒ»é‚„å…ƒã®å…·ä½“å†…å®¹ï¼ˆç‡/é¡ãƒ»ä¸Šé™ãƒ»å¯¾è±¡ï¼‰\", [2]\n\"steps\": \"åˆ©ç”¨/ç”³è¾¼ã®æ‰‹é †ï¼ˆã‚¢ãƒ—ãƒªãƒ»ã‚¯ãƒ¼ãƒãƒ³ãƒ»æ™‚é–“å¸¯ãªã©ï¼‰\", [2]\n\"service\": \"å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹ãƒ»åº—èˆ—å\", [2]\n\"url\": \"https://x.com/.../status/...\", [2]\n\"source_name\": \"å‡ºå…¸ã‚¢ã‚«ã‚¦ãƒ³ãƒˆå\", [2]\n\"source_id\": \"@handle\", [2]\n\"expiration\": \"YYYY-MM-DD ã‚‚ã—ãã¯ æœŸé–“ã®èª¬æ˜æ–‡ (çµ‚äº†æ¸ˆã¿ã¯null)\", [2]\n\"conditions\": \"æ–°è¦/æ—¢å­˜/å…ˆç€/æŠ½é¸/å›æ•°ãªã©\", [2]\n\"notes\": \"æ³¨æ„ç‚¹ãƒ»ä¾‹å¤–ãƒ»å‚™è€ƒ\" [2]\n}\n]\n\n# åé›†ãƒ«ãƒ¼ãƒ«\n- ç›£è¦–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’å„ªå…ˆã—ã¤ã¤ã€é¡ä¼¼ç³»çµ±ã®ä¿¡é ¼ã§ãã‚‹ã‚‚ã®ã‚‚å«ã‚ã‚‹ (ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼500ä»¥ä¸Š) [2]\n- è¨€ã„å›ã—ãŒé•ã£ã¦ã‚‚ã€Œå†…å®¹ãŒåŒã˜ã€ãªã‚‰çµ±åˆã—1ä»¶ã«ã¾ã¨ã‚ã‚‹ [2]\n- ä»¥ä¸‹ã®ã„ãšã‚Œã‹ãŒç•°ãªã‚‹å ´åˆã¯åˆ¥ä»¶ã¨ã™ã‚‹ï¼š [2]\n- å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹/åº—èˆ— [2]\n- å‰²å¼•/é‚„å…ƒã®ç‡ãƒ»ä¸Šé™ãƒ»æœŸé–“ [2]\n- åˆ©ç”¨/ç”³è¾¼æ‰‹é †ï¼ˆæ”¯æ‰•ã„æ‰‹æ®µãƒ»æ¡ä»¶ã®å·®ï¼‰ [2]\n- æ•°å€¤ã¯åŠè§’çµ±ä¸€ï¼ˆä¾‹: 20%, 1000å††, ä¸Šé™1000ãƒã‚¤ãƒ³ãƒˆï¼‰ [2]\n- æ¬ æã¯ null ã‚’å…¥ã‚Œã‚‹ï¼ˆç©ºæ–‡å­— \"\" ã¯ä½¿ã‚ãªã„ï¼‰ [2]\n- åŒæ§˜ã®æƒ…å ±ãŒè¤‡æ•°ã‚ã£ãŸå ´åˆã¯ã€ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼æ•°ãŒä¸€ç•ªå¤šã„å†…å®¹ã®urlã‚’æŒ¿å…¥ã™ã‚‹ [3]\n- çµ‚äº†ã—ãŸã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã¯é™¤å¤– (expirationãŒéå»ã®æ—¥ä»˜ã€ã¾ãŸã¯ã€Œçµ‚äº†ã€ã€Œçµ‚äº†é–“è¿‘ã€ã€Œä»Šæ—¥ã§çµ‚ã‚ã‚Šã€å«ã‚€ã‚‚ã®ã¯null) [3]\n- é«˜é¡é‚„å…ƒ/å‰²å¼• (10%ä»¥ä¸Šã€1000å††ä»¥ä¸Š) ã‚’å„ªå…ˆ [3]\n- ä¿¡é ¼æ€§ä½ã„ã‚‚ã® (ãƒ•ã‚©ãƒ­ãƒ¯ãƒ¼50æœªæº€) ã¯é™¤å¤– [3]\n- æŠ½é¸ã§å½“é¸ç‡ãŒä½ã„ã‚‚ã®ï¼ˆå½“é¸è€…10000åä»¥ä¸‹ï¼‰ã¯é™¤å¤– [3]\n- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒ•ã‚©ãƒ­ãƒ¼ã‚„ãƒªãƒã‚¹ãƒˆã‚’æ¡ä»¶ã¨ã™ã‚‹ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ã¯é™¤å¤– [3]\n- æŠ•è³‡é–¢é€£ï¼ˆæ ªã€æš—å·è³‡ç”£ã€ãƒˆãƒ¬ãƒ¼ãƒ‰ãªã©ï¼‰ã¯é™¤å¤– [3]\n- é‡è¤‡å†…å®¹ã¯çµ±åˆã—ã€1ä»¶ã«ã¾ã¨ã‚ã‚‹ [3]\n- **TikTokã«é–¢ã™ã‚‹å†…å®¹ã¯é™¤å¤– (ãŠå®¢æ§˜ã®è¦æœ›ã«ã‚ˆã‚Šå³å®ˆ)** [3]\n- ä¸Šå ´ä¼æ¥­ã®å…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆæƒ…å ±ã¯é™¤å¤–ï¼ˆå€‹äººã‚¤ãƒ³ãƒ•ãƒ«ã‚¨ãƒ³ã‚µãƒ¼ãƒ¬ãƒ™ãƒ«ã®æƒ…å ±ãŒã»ã—ã„ï¼‰ [3]\n- â—¯â—¯ã‚’è²·ã†ã¨1å€‹ç„¡æ–™ãªã©ã®ã€ã„ã‚ã‚†ã‚‹ã€Œãƒ—ãƒ©ã‚¤ãƒã€ã¯é™¤å¤– [3]\n- å›½å†…ã®æ—…ç³»(æ—…è¡Œç³»)ã®ãŠå¾—æƒ…å ±ã¯é‡è¦è¦–\n\n# å„ªå…ˆç›£è¦–ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ\nã“ã¨ã¯ã‚€ã€ãŠå¾—Ã—ãƒã‚¤æ´»ã€‘ @kotoham_pkt [3]\nã‚¯ãƒ¼ãƒãƒ¡ @tosu5580 [3]\nã‹ã‚Šã‚“@åŒ»ç™‚è„±æ¯›ãƒãƒ‹ã‚¢ @buran_umeda [3]\nãŸã£ãã‚“ @9kuIOQMh1T85626 [3]\nã‚ã‚“ã“ @an89no23 [3]\nã¡ã³ã†ã•ğŸ°@ç„¡çµ¦å…ãƒ–ãƒ­ã‚¬ãƒ¼ @chibiusachi [3]\nã‚ãã³@ã‚ãã³ã‚¸ãƒ£ãƒ‘ãƒ³ @akubichan_sab [4]\nã‚ãã³@è‚²å…ã®åˆé–“ã«å‰¯æ¥­ã‚ã‚Œã“ã‚Œ @akubichan62124 [4]\nã‚ã®ã²ã¨@ä¸‡åšVIP CARDä¿æœ‰æ¸ˆ @2akautebon [4]\nHalohaloï½œæ—…è¡Œãƒ¬ã‚¸ãƒ£ãƒ¼æƒ…å ± @halohalo_travel [4]\nã¨ã‚‚ã‚ŠPay @tomor1nn [4]\nãƒãƒãƒ¼ã®çŠ¬ğŸ• @ourmoneybook [4]\nmao (ã¾ãŠ)@ãƒã‚¤æ´»ã§å®¶ã‚’è²·ã£ãŸä¸»å©¦ @mao_otk_tw [4]\nã‚ãã½ã‚“ @akipon229 [4]\nãƒ–ãƒ«ã‚¾ãƒ³@ãŠå¾—å¥½ã @BuruzonBBA [4]\nakiko_lawson @akiko_lawson [4]\nvtcosmetics_jp @vtcosmetics_jp [4]\nTraicyï¼ˆãƒˆãƒ©ã‚¤ã‚·ãƒ¼ï¼‰ @traicycom \n\n# è¿½åŠ æ¤œç´¢ãƒ«ãƒ¼ãƒ« (æƒ…å ±é‡å¢—åŠ ã®ãŸã‚ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å¤§å¹…ã«å¼·åŒ–)\n- ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ã§é¡ä¼¼æƒ…å ±ã‚’è£œå®Œ: \"ãŠå¾—æƒ…å ± ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ å‰²å¼• ã‚¯ãƒ¼ãƒãƒ³ ãƒã‚¤ãƒ³ãƒˆ é‚„å…ƒ MNP povo UQ JAL ANA ã‚½ãƒ©ã‚·ãƒ‰ ã‚¦ã‚¨ãƒ«æ´» ãƒãƒ³æ´» ãƒ‰ãƒªãƒã‚± Vãƒã‚¤ãƒ³ãƒˆ PayPay\"\n- ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢ã§æ–°é®®æƒ…å ±: \"(ãŠå¾— OR ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ OR å‰²å¼• OR ã‚¯ãƒ¼ãƒãƒ³ OR ãƒã‚¤ãƒ³ãƒˆ OR é‚„å…ƒ OR JAL OR ANA OR ã‚¸ã‚§ãƒƒãƒˆã‚¹ã‚¿ãƒ¼ OR ã‚½ãƒ©ã‚·ãƒ‰ OR ã‚¦ã‚¨ãƒ«æ´» OR ãƒãƒ³æ´» OR ãƒ‰ãƒªãƒã‚± OR MNP OR PayPay OR Vãƒã‚¤ãƒ³ãƒˆ) **min_faves:5** since:${startDate} -TikTok -çµ‚äº† -çµ‚ã‚ã‚Š -æŠ•è³‡ -æ ª -æš—å·è³‡ç”£ -ãƒˆãƒ¬ãƒ¼ãƒ‰\" **limit:50**\n`.trim();\n\nreturn [{ json: { prompt, startDate, endDate } }];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        816,
        480
      ],
      "id": "299591e7-f995-46fc-b2cc-947860b4c296",
      "name": "GeneratePrompt"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api.x.ai/v1/chat/completions",
        "authentication": "predefinedCredentialType",
        "nodeCredentialType": "xAiApi",
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "model",
              "value": "grok-4"
            },
            {
              "name": "search_parameters",
              "value": "={{ {   \"mode\": \"auto\",   \"from_date\": $json.startDate,   \"to_date\": $json.endDate,   \"max_search_results\": 30,   \"sources\": [{ \"type\": \"x\", \"post_favorite_count\": 10 }] } }}"
            },
            {
              "name": "messages",
              "value": "={{ [{ \"role\": \"user\", \"content\": $json.prompt }] }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        1008,
        480
      ],
      "id": "5ffb13b8-f2e1-459d-a360-34b799248509",
      "name": "CallGrokAI",
      "credentials": {
        "xAiApi": {
          "id": "m3OLs9FipQlOJmOA",
          "name": "xAi account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "documentId": {
          "__rl": true,
          "value": "1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14",
          "mode": "list",
          "cachedResultName": "TokuSearch",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "database",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14/edit#gid=0"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1568,
        704
      ],
      "id": "f94337fa-2317-48ac-a5dd-5282c912e1b0",
      "name": "GetSentHistory",
      "credentials": {
        "googleApi": {
          "id": "r9kAyVencycJeNjy",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst today = new Date().toISOString().slice(0, 10);\n\n// 0ä»¶ãƒã‚§ãƒƒã‚¯ï¼ˆTransformForTokuSearchã‹ã‚‰ç©ºãƒ‡ãƒ¼ã‚¿ãŒæ¥ãŸå ´åˆï¼‰\nif (items.length === 1 && items[0].json.isEmpty) {\n  const message = `ğŸ“… ${today}ã®æ–°ç€æƒ…å ±ï¼ˆ0ä»¶ï¼‰\\n\\nâœ… æœ¬æ—¥ã¯æ–°è¦ã®ãŠå¾—æƒ…å ±ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚\\næ—¢å­˜ã®ãŠå¾—æƒ…å ±ã¯ã™ã¹ã¦é‡è¤‡ãƒã‚§ãƒƒã‚¯ã§é™¤å¤–ã•ã‚Œã¾ã—ãŸã€‚`;\n  return [{ json: { text: message } }];\n}\n\nlet message = `ğŸ“… ${today}ã®æ–°ç€æƒ…å ±ï¼ˆ${items.length}ä»¶ï¼‰ï¼š\\n\\n`;\n\nfor (const item of items) {\n  const d = item.json;\n\n  // ã‚¿ã‚¤ãƒˆãƒ«ãŒãªã„ã‚‚ã®ã¯ã‚¹ã‚­ãƒƒãƒ—ã™ã‚‹ï¼ˆã¾ãŸã¯d.urlã§ã‚‚OKï¼‰\n  if (!d.title && !d.url) continue;\n\n  message += `ã€ã‚¿ã‚¤ãƒˆãƒ«ã€‘${d.title || 'ï¼ˆãªã—ï¼‰'}\\n`;\n  message += `ã€æ¦‚è¦ã€‘${d.summary || 'ï¼ˆãªã—ï¼‰'}\\n`;\n  message += `ã€æ‰‹é †ã€‘${d.steps || 'ï¼ˆãªã—ï¼‰'}\\n`;\n  message += `ã€æ¡ä»¶ã€‘${d.conditions || 'ï¼ˆãªã—ï¼‰'}\\n`;\n  message += `ã€æœŸé–“ã€‘${d.expiration || 'ï¼ˆä¸æ˜ï¼‰'}\\n`;\n  message += `ã€URLã€‘${d.url || ''} (${d.source_id || '??'})\\n\\n`;\n}\n\nreturn [{ json: { text: message.trim() } }];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1552,
        1152
      ],
      "id": "b7a84ae9-e263-4b94-9091-796c97f9b5ac",
      "name": "BuildSlackMessage"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "#daily_o-toku",
          "mode": "name"
        },
        "text": "={{ $json.text }}",
        "otherOptions": {
          "includeLinkToWorkflow": false
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        1712,
        1152
      ],
      "id": "f1071fee-ca92-454a-8542-e4b4c73c5922",
      "name": "SlackNotify",
      "webhookId": "a1ea8121-abd5-4a24-a6b4-655ddf5a6594",
      "credentials": {
        "slackApi": {
          "id": "kahTvH10blaEP2kb",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "authentication": "serviceAccount",
        "operation": "append",
        "documentId": {
          "__rl": true,
          "value": "1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14",
          "mode": "list",
          "cachedResultName": "TokuSearch",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14/edit?usp=drivesdk"
        },
        "sheetName": {
          "__rl": true,
          "value": "gid=0",
          "mode": "list",
          "cachedResultName": "database",
          "cachedResultUrl": "https://docs.google.com/spreadsheets/d/1iz1ApPwoLMMyqeQW_GA0XYM1qU74tzULNVq6vav3g14/edit#gid=0"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $json.id }}",
            "date": "={{ $json.date }}",
            "title": "={{ $json.title }}",
            "summary": "={{ $json.summary }}",
            "detail": "={{ $json.detail }}",
            "steps": "={{ $json.steps }}",
            "service": "={{ $json.service }}",
            "expiration": "={{ $json.expiration }}",
            "conditions": "={{ $json.conditions }}",
            "notes": "={{ $json.notes }}",
            "category_main": "={{ $json.category_main }}",
            "category_sub": "={{ $json.category_sub }}",
            "is_public": "={{ $json.is_public }}",
            "priority": "={{ $json.priority }}",
            "discount_rate": "={{ $json.discount_rate }}",
            "discount_amount": "={{ $json.discount_amount }}",
            "score": "={{ $json.score }}",
            "created_at": "={{ $json.created_at }}",
            "updated_at": "={{ $json.updated_at }}",
            "difficulty": "={{ $json.difficulty }}",
            "area_type": "={{ $json.area_type }}",
            "target_user_type": "={{ $json.target_user_type }}",
            "usage_type": "={{ $json.usage_type }}",
            "is_welkatsu": "={{ $json.is_welkatsu }}",
            "tags": "={{ $json.tags }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "date",
              "displayName": "date",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "summary",
              "displayName": "summary",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "detail",
              "displayName": "detail",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "steps",
              "displayName": "steps",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "service",
              "displayName": "service",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "expiration",
              "displayName": "expiration",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "conditions",
              "displayName": "conditions",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "notes",
              "displayName": "notes",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "category_main",
              "displayName": "category_main",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "category_sub",
              "displayName": "category_sub",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "is_public",
              "displayName": "is_public",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "priority",
              "displayName": "priority",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "discount_rate",
              "displayName": "discount_rate",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "discount_amount",
              "displayName": "discount_amount",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "score",
              "displayName": "score",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "updated_at",
              "displayName": "updated_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "difficulty",
              "displayName": "difficulty",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "area_type",
              "displayName": "area_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "target_user_type",
              "displayName": "target_user_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "usage_type",
              "displayName": "usage_type",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "is_welkatsu",
              "displayName": "is_welkatsu",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            },
            {
              "id": "tags",
              "displayName": "tags",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.googleSheets",
      "typeVersion": 4.7,
      "position": [
        1552,
        976
      ],
      "id": "e0db0e70-7147-462e-b117-5e25379b318d",
      "name": "SaveToHistory",
      "credentials": {
        "googleApi": {
          "id": "r9kAyVencycJeNjy",
          "name": "Google Service Account account 2"
        }
      }
    },
    {
      "parameters": {
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-flash",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-flash"
        },
        "messages": {
          "values": [
            {
              "content": "={{$json.prompt}}"
            }
          ]
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        400,
        1072
      ],
      "id": "9110f9f9-a8a4-4b44-a357-29d05c4ef391",
      "name": "Message a model",
      "credentials": {
        "googlePalmApi": {
          "id": "gojn353h4HLDUzF2",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "16265a7f-47e9-4372-aba4-5cbb3efc89b9",
              "name": "prompt",
              "value": "={{(() => {\n  // 0ä»¶ãƒã‚§ãƒƒã‚¯ï¼ˆWrapItemsAsArrayã‹ã‚‰ç©ºãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ©ã‚°ãŒæ¥ãŸå ´åˆï¼‰\n  if ($json.isEmpty) {\n    return 'æ–°è¦ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã®ãŸã‚ã€ç©ºã®é…åˆ—ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚\\n\\nå‡ºåŠ›å½¢å¼ï¼š[]\\n\\nâ€»èª¬æ˜ä¸è¦ã€ç´”ç²‹ãªJSONé…åˆ—ã®ã¿ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚';\n  }\n  \n  const newItems = $json.allItems; // æ–°è¦ãƒ‡ãƒ¼ã‚¿ï¼ˆåˆ¤å®šå¯¾è±¡ï¼‰\n  const existingItems = $items('FilterRecentHistory', 0).map(i => i.json); // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ï¼ˆå‚è€ƒç”¨ï¼‰\n  \n  // æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ç°¡ç•¥åŒ–ï¼ˆå‚è€ƒæƒ…å ±ã¨ã—ã¦æ¸¡ã™ï¼‰\n  const simplifiedExisting = existingItems.map(item => ({\n    title: item.title || '',\n    service: item.service || '',\n    expiration: item.expiration || 'ãªã—',\n    detail: item.detail ? item.detail.substring(0, 100) : '',\n    url: item.url || ''\n  }));\n  \n  // æ–°è¦ãƒ‡ãƒ¼ã‚¿ã‚’ç°¡ç•¥åŒ–ï¼ˆåˆ¤å®šå¯¾è±¡ï¼‰\n  const simplifiedNew = newItems.map((item, idx) => ({\n    index: idx,\n    title: item.title || '',\n    service: item.service || '',\n    expiration: item.expiration || 'ãªã—',\n    detail: item.detail ? item.detail.substring(0, 150) : '',\n    conditions: item.conditions || '',\n    url: item.url || ''\n  }));\n  \n  return 'ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚\\n\\n' +\n    'ã€æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ï¼ˆéå»7æ—¥åˆ†ï¼‰ã€‘\\n' +\n    JSON.stringify(simplifiedExisting, null, 2) + '\\n\\n' +\n    'ã€æ–°è¦ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ¬æ—¥å–å¾—ï¼‰ã€‘\\n' +\n    JSON.stringify(simplifiedNew, null, 2) + '\\n\\n' +\n    'â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\\n' +\n    'ğŸ“‹ ã€ã‚¿ã‚¹ã‚¯ã€‘\\n' +\n    'ä¸Šè¨˜ã®ã€Œæ–°è¦ãƒ‡ãƒ¼ã‚¿ã€ã®ä¸­ã‹ã‚‰ã€ã€Œæ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã€ã¨**é‡è¤‡ã—ã¦ã„ãªã„ã‚‚ã®ã®ã¿**ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç•ªå·ã‚’é…åˆ—ã§è¿”ã—ã¦ãã ã•ã„ã€‚\\n' +\n    'æ–°è¦ãƒ‡ãƒ¼ã‚¿åŒå£«ã§é‡è¤‡ãŒã‚ã‚‹å ´åˆã¯ã€æœ€åˆã®1ã¤ã®ã¿æ®‹ã—ã¦ãã ã•ã„ã€‚\\n\\n' +\n    'âš ï¸ ã€å‡ºåŠ›å½¢å¼ã€‘\\n' +\n    'ç´”ç²‹ãªJSONé…åˆ—ã®ã¿ã€‚èª¬æ˜æ–‡ã€ã‚³ãƒ¡ãƒ³ãƒˆã€ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³è¨˜æ³•(```json)ã¯ä¸€åˆ‡ä¸è¦ã§ã™ã€‚\\n' +\n    'ä¾‹: [0, 2, 5, 8]\\n\\n' +\n    'ğŸ“ ã€é‡è¤‡åˆ¤å®šã®å³å¯†ãªåŸºæº–ã€‘\\n' +\n    'ä»¥ä¸‹ã®**ã™ã¹ã¦**ãŒä¸€è‡´ã™ã‚‹å ´åˆã®ã¿é‡è¤‡ã¨åˆ¤å®šï¼š\\n' +\n    '1. ã‚µãƒ¼ãƒ“ã‚¹åãŒå®Ÿè³ªçš„ã«åŒã˜ï¼ˆè¡¨è¨˜æºã‚ŒOK: ã€ŒYahoo!ã€=ã€Œãƒ¤ãƒ•ãƒ¼ã€ï¼‰\\n' +\n    '2. ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³å†…å®¹ãŒå®Ÿè³ªçš„ã«åŒã˜ï¼ˆã€Œãƒ–ãƒ©ãƒƒã‚¯ãƒ•ãƒ©ã‚¤ãƒ‡ãƒ¼ã€=ã€Œãƒ–ãƒ©ãƒ•ãƒ©ã€=ã€ŒBFã€ï¼‰\\n' +\n    '3. æœ‰åŠ¹æœŸé™ãŒåŒã˜ï¼ˆã¾ãŸã¯ä¸¡æ–¹ã¨ã‚‚æœŸé™ãªã—ï¼‰\\n\\n' +\n    'âœ… ã€åˆ¥ä»¶ã¨ã—ã¦æ®‹ã™ã‚±ãƒ¼ã‚¹ã€‘\\n' +\n    '- é‚„å…ƒç‡/å‰²å¼•é¡ãŒç•°ãªã‚‹ï¼ˆ20% vs 30%ï¼‰\\n' +\n    '- å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç•°ãªã‚‹ï¼ˆæ–°è¦é™å®š vs èª°ã§ã‚‚ï¼‰\\n' +\n    '- æœ‰åŠ¹æœŸé™ãŒç•°ãªã‚‹\\n' +\n    '- URLï¼ˆTwitter IDï¼‰ãŒç•°ãªã‚Œã°åŸºæœ¬çš„ã«åˆ¥ä»¶\\n\\n' +\n    'ã€å†ç¢ºèªã€‘è¿”ã™ã®ã¯æ–°è¦ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹é…åˆ—ã®ã¿: [0, 1, 3]';\n})()}}\n",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        592,
        832
      ],
      "id": "ff079b07-d339-4cd4-92f9-be4acd5963ec",
      "name": "BuildGeminiPrompt"
    },
    {
      "parameters": {
        "content": "Grokå‡¦ç†ï¼ˆé †æ¬¡å®Ÿè¡Œï¼‰\n\nå±¥æ­´å–å¾—å®Œäº†å¾Œã«é–‹å§‹:\n1. GeneratePrompt: æ¤œç´¢ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆç”Ÿæˆ\n2. CallGrokAI: Grok APIå‘¼ã³å‡ºã—\n3. ParseGrokResponse: ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’ãƒ‘ãƒ¼ã‚¹",
        "height": 208,
        "width": 656,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        736,
        432
      ],
      "typeVersion": 1,
      "id": "d1d20e1e-afae-4c86-bcbc-519877a75900",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "jsCode": "// ä¸€åº¦ã§ã‚‚å®Ÿè¡Œã•ã‚ŒãŸã‚‰1ä»¶ã ã‘è¿”ã™ã‚ˆã†ã«ã™ã‚‹\nif ($runIndex !== 0) return [];\n\nconst items = $input.all().map(item => item.json);\n\n// 0ä»¶ãƒã‚§ãƒƒã‚¯ï¼ˆFilterByIDã‹ã‚‰ç©ºãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ©ã‚°ãŒæ¥ãŸå ´åˆï¼‰\nif (items.length === 1 && items[0].isEmpty) {\n  console.log('âš ï¸ WrapItemsAsArray: ç©ºãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ©ã‚°ã‚’å—ä¿¡ã€ãã®ã¾ã¾æ¬¡ã¸æ¸¡ã—ã¾ã™');\n  return [{ json: { isEmpty: true, count: 0 } }];\n}\n\nreturn [\n  {\n    json: {\n      allItems: items\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        400,
        832
      ],
      "id": "fcf0fb0b-a548-4bcf-8dae-200a39c0600b",
      "name": "WrapItemsAsArray"
    },
    {
      "parameters": {
        "jsCode": "// 0ä»¶ãƒã‚§ãƒƒã‚¯ï¼ˆBuildGeminiPromptã‹ã‚‰ç©ºãƒ‡ãƒ¼ã‚¿ã®å ´åˆï¼‰\nif (!$json.content || !$json.content.parts) {\n  console.log('âš ï¸ UnpackGeminiResults: Geminiå¿œç­”ãŒãªã„ãŸã‚ã€ç©ºãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ©ã‚°ã‚’è¿”ã—ã¾ã™');\n  return [{ json: { isEmpty: true, count: 0 } }];\n}\n\nconst rawText = $json.content.parts[0].text;\n\n// ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯è¨˜å·ï¼ˆ```json\\n...```ï¼‰ã‚’é™¤å»\nconst jsonString = rawText\n  .replace(/^```json\\s*/, '')  // ```json ã§å§‹ã¾ã‚‹éƒ¨åˆ†ã‚’å‰Šé™¤\n  .replace(/```$/m, '')         // æœ€å¾Œã® ``` ã‚’å‰Šé™¤\n  .trim();\n\nlet indexArray;\ntry {\n  indexArray = JSON.parse(jsonString);\n} catch (e) {\n  throw new Error(\"âŒ Geminiã®å‡ºåŠ›ã‹ã‚‰JSONã¨ã—ã¦ãƒ‘ãƒ¼ã‚¹ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚å†…å®¹: \" + jsonString);\n}\n\nif (!Array.isArray(indexArray)) {\n  throw new Error(\"âŒ Geminiã®å‡ºåŠ›ãŒé…åˆ—ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚å†…å®¹: \" + jsonString);\n}\n\n// WrapItemsAsArrayã§ä¿å­˜ã•ã‚ŒãŸå…ƒã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—\nconst originalItems = $items(\"WrapItemsAsArray\", 0)[0].json.allItems;\n\n// ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç•ªå·ã«åŸºã¥ã„ã¦å…ƒã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’æŠ½å‡º\nconst filteredItems = indexArray\n  .filter(idx => idx >= 0 && idx < originalItems.length)\n  .map(idx => originalItems[idx]);\n\nconsole.log(`âœ… GeminiãŒé¸æŠã—ãŸæ–°è¦æƒ…å ±: ${filteredItems.length}ä»¶`);\n\n// 0ä»¶ã®å ´åˆã§ã‚‚å‡¦ç†ã‚’ç¶šã‘ã‚‹ãŸã‚ã«ã€ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™\nif (filteredItems.length === 0) {\n  console.log('âš ï¸ æ–°è¦æƒ…å ±ãŒ0ä»¶ã®ãŸã‚ã€ç©ºãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¾ã™');\n  return [{ json: { isEmpty: true, count: 0 } }];\n}\n\n// å‡ºåŠ›å½¢å¼ã‚’ n8n ç”¨ã«å¤‰æ›\nreturn filteredItems.map(item => ({ json: item }));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1104,
        1072
      ],
      "id": "43cd1b5f-babd-49cd-808d-005e051e34c2",
      "name": "UnpackGeminiResults"
    },
    {
      "parameters": {
        "jsCode": "// ã€Œä»Šæ—¥ã‹ã‚‰éå»7æ—¥ä»¥å†…ã€ã®å±¥æ­´ã ã‘ã‚’æ®‹ã™ï¼ˆé‡è¤‡ãƒã‚§ãƒƒã‚¯æœŸé–“ï¼‰\nconst sevenDaysAgo = new Date();\nsevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);\n\nreturn items.filter(item => {\n  const dateStr = item.json.date || item.json.created_at;\n  if (!dateStr) return false;\n\n  const itemDate = new Date(dateStr);\n  return itemDate >= sevenDaysAgo;\n});\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1744,
        704
      ],
      "id": "762c2cc9-09c8-440c-a135-7d8d6e125cd4",
      "name": "FilterRecentHistory"
    },
    {
      "parameters": {
        "content": "å±¥æ­´å–å¾—ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆéå»7æ—¥åˆ†ï¼‰\n\né †æ¬¡å®Ÿè¡Œãƒ•ãƒ­ãƒ¼:\n1. GetSentHistory: ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‹ã‚‰å…¨ä»¶å–å¾—\n2. FilterRecentHistory: éå»7æ—¥åˆ†ã«ãƒ•ã‚£ãƒ«ã‚¿\n3. GeneratePromptä»¥é™: Grokå‡¦ç†é–‹å§‹\n\nâ€»FilterByID, BuildGeminiPromptã§$items()ã‚’ä½¿ã£ã¦å‚ç…§",
        "height": 464,
        "width": 416,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1504,
        432
      ],
      "typeVersion": 1,
      "id": "8b01d497-270e-4f17-b781-5c5055fbf773",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "é‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆé«˜é€Ÿäº‹å‰ãƒ•ã‚£ãƒ«ã‚¿ + Geminiæœ€çµ‚åˆ¤å®šï¼‰\n\n1. FilterByID: Twitter URLé‡è¤‡ã‚’é«˜é€Ÿé™¤å¤–\n2. Geminiåˆ¤å®š: æ—¢å­˜ãƒ‡ãƒ¼ã‚¿(7æ—¥åˆ†)ã¨æ–°è¦ãƒ‡ãƒ¼ã‚¿ã‚’ç…§åˆ\n   â†’ æ–°è¦ãƒ‡ãƒ¼ã‚¿ã®ä¸­ã§é‡è¤‡ã—ã¦ã„ãªã„ã‚‚ã®ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’è¿”ã™",
        "height": 560,
        "width": 656,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        208,
        720
      ],
      "typeVersion": 1,
      "id": "f86e7465-bacb-4742-ad16-1a2484e6ea15",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "æœ€çµ‚å‡¦ç†ï¼ˆSlacké€šçŸ¥ãƒ»å±¥æ­´ä¿å­˜ï¼‰",
        "height": 384,
        "width": 384
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1520,
        928
      ],
      "typeVersion": 1,
      "id": "98b57a9e-cfd6-4360-b8d7-ccddc6cf35ae",
      "name": "Sticky Note3"
    },
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "triggerAtHour": 10
            },
            {
              "triggerAtHour": 20
            },
            {
              "triggerAtHour": 12
            }
          ]
        }
      },
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.2,
      "position": [
        432,
        480
      ],
      "id": "be7cf1de-8c51-4f4c-93b8-b8f4e585463a",
      "name": "TriggerEvery1"
    },
    {
      "parameters": {
        "jsCode": "// ========================================\n// TransformForTokuSearch ãƒãƒ¼ãƒ‰ï¼ˆv2.0å¯¾å¿œï¼‰\n// æ±ºå®šçš„IDç”Ÿæˆ + TokuSearchå½¢å¼å¤‰æ› + æ–°ã‚«ãƒ©ãƒ å¯¾å¿œ\n// ========================================\n\n// ãƒ†ã‚­ã‚¹ãƒˆæ­£è¦åŒ–é–¢æ•°ï¼ˆè¡¨ç¾ã®æºã‚Œã‚’å¸åï¼‰\nfunction normalizeText(text) {\n  if (!text) return '';\n  return text\n    .toLowerCase()\n    .replace(/[ï¼!ï¼Ÿ?ã€€\\s\\n]/g, '') // è¨˜å·ãƒ»ã‚¹ãƒšãƒ¼ã‚¹ãƒ»æ”¹è¡Œå‰Šé™¤\n    .replace(/ã€.*?ã€‘/g, '') // ã€ã€‘å†…å‰Šé™¤\n    .replace(/\\(.*?\\)/g, '') // ()å†…å‰Šé™¤\n    .replace(/ï¼ˆ.*?ï¼‰/g, '') // ï¼ˆï¼‰å†…å‰Šé™¤\n    .trim();\n}\n\n// ã‚·ãƒ³ãƒ—ãƒ«ãªãƒãƒƒã‚·ãƒ¥é–¢æ•°\nfunction simpleHash(str) {\n  let hash = 0;\n  for (let i = 0; i < str.length; i++) {\n    const char = str.charCodeAt(i);\n    hash = ((hash << 5) - hash) + char;\n    hash = hash & hash; // 32bitæ•´æ•°ã«å¤‰æ›\n  }\n  return Math.abs(hash).toString(36);\n}\n\n// URLãƒ™ãƒ¼ã‚¹IDç”Ÿæˆ\nfunction generateURLBasedID(url) {\n  if (!url) return null;\n  const match = url.match(/status\\/(\\d+)/);\n  return match ? `x-${match[1]}` : null;\n}\n\n// å†…å®¹ãƒ™ãƒ¼ã‚¹IDç”Ÿæˆ\nfunction generateContentBasedID(data) {\n  const service = (data.service || '').toLowerCase().replace(/[^a-z0-9]/g, '');\n  const normalizedTitle = normalizeText(data.title || '');\n  const expiration = data.expiration || 'none';\n  \n  // ã‚µãƒ¼ãƒ“ã‚¹åã®çŸ­ç¸®å½¢ã‚‚è€ƒæ…®\n  const serviceKey = service\n    .replace(/yahoo!?ã‚·ãƒ§ãƒƒãƒ”ãƒ³ã‚°/g, 'yahoo')\n    .replace(/yahoo!?ã—ã‚‡ã£ã´ã‚“ã/g, 'yahoo')\n    .replace(/paypay/g, 'paypay')\n    .replace(/aupay/g, 'aupay')\n    .replace(/aupa-i/g, 'aupay');\n  \n  const compositeKey = `${serviceKey}|${normalizedTitle.substring(0, 50)}|${expiration}`;\n  return `deal-${simpleHash(compositeKey)}`;\n}\n\n// æ±ºå®šçš„IDç”Ÿæˆï¼ˆURLå„ªå…ˆã€ãªã‘ã‚Œã°å†…å®¹ãƒ™ãƒ¼ã‚¹ï¼‰\nfunction generateDeterministicID(data) {\n  const urlID = generateURLBasedID(data.url);\n  const contentID = generateContentBasedID(data);\n  \n  // ãƒ—ãƒ©ã‚¤ãƒãƒªIDã¯URLå„ªå…ˆï¼ˆURLãŒã‚ã‚‹å ´åˆï¼‰\n  return urlID || contentID;\n}\n\n// ã‚«ãƒ†ã‚´ãƒªåˆ¤å®šé–¢æ•°\nfunction determineCategory(service, title, detail) {\n  const text = `${service} ${title} ${detail}`.toLowerCase();\n  \n  // ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢ãƒ»æ—¥ç”¨å“\n  if (/ãƒãƒ„ã‚­ãƒ¨|ã‚µãƒ³ãƒ‰ãƒ©ãƒƒã‚°|ãƒ„ãƒ«ãƒ|ã‚¦ã‚¨ãƒ«ã‚·ã‚¢|ã‚³ã‚³ã‚«ãƒ©|ãƒ‰ãƒ©ãƒƒã‚°|æ—¥ç”¨å“|åŒ–ç²§å“|åŒ»è–¬å“|è–¬|è„±æ¯›/.test(text)) {\n    return 'ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢ãƒ»æ—¥ç”¨å“';\n  }\n  \n  // ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ»é‡è²©åº—ãƒ»EC\n  if (/ã‚¤ã‚ªãƒ³|ã‚¤ãƒˆãƒ¼ãƒ¨ãƒ¼ã‚«ãƒ‰ãƒ¼|è¥¿å‹|ãƒ©ã‚¤ãƒ•|amazon|æ¥½å¤©|yahoo|ãƒ¤ãƒ•ãƒ¼|ec|é€šè²©|ã‚»ãƒ–ãƒ³|ãƒ•ã‚¡ãƒŸãƒ|ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆ|ãƒ­ãƒ¼ã‚½ãƒ³|ã‚³ãƒ³ãƒ“ãƒ‹/.test(text)) {\n    return 'ã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒ»é‡è²©åº—ãƒ»EC';\n  }\n  \n  // ã‚°ãƒ«ãƒ¡ãƒ»å¤–é£Ÿ\n  if (/ã‚¹ã‚¿ãƒ|ã‚¹ã‚¿ãƒ¼ãƒãƒƒã‚¯ã‚¹|ãƒãƒƒã‚¯|ãƒã‚¯ãƒ‰ãƒŠãƒ«ãƒ‰|ã™ãå®¶|æ¾å±‹|å‰é‡å®¶|å¤–é£Ÿ|ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³|é£²é£Ÿ|ã‚°ãƒ«ãƒ¡|é£Ÿäº‹|ãƒ©ãƒ³ãƒ|ãƒ‡ã‚£ãƒŠãƒ¼/.test(text)) {\n    return 'ã‚°ãƒ«ãƒ¡ãƒ»å¤–é£Ÿ';\n  }\n  \n  // æ—…è¡Œãƒ»äº¤é€š\n  if (/jr|jal|ana|ã‚½ãƒ©ã‚·ãƒ‰|ã‚¸ã‚§ãƒƒãƒˆ|ã‚¹ã‚¿ãƒ¼|traicy|æ—…è¡Œ|ãƒ›ãƒ†ãƒ«|å®¿æ³Š|èˆªç©º|æ–°å¹¹ç·š|é›»è»Š|äº¤é€š|ãƒˆãƒ©ãƒ™ãƒ«|é£›è¡Œæ©Ÿ|his/.test(text)) {\n    return 'æ—…è¡Œãƒ»äº¤é€š';\n  }\n  \n  // æ±ºæ¸ˆãƒ»ãƒã‚¤ãƒ³ãƒˆ\n  if (/paypay|line pay|dæ‰•ã„|æ¥½å¤©pay|au pay|ãƒ¡ãƒ«ãƒšã‚¤|ãƒã‚¤ãƒ³ãƒˆ|ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒãƒƒã‚¯|é‚„å…ƒ|ã‚¯ãƒ¼ãƒãƒ³|æ±ºæ¸ˆ|pay|ãƒšã‚¤|ã‚¦ã‚¨ãƒ«æ´»|ãƒãƒ³æ´»|ãƒ‰ãƒªãƒã‚±|vãƒã‚¤ãƒ³ãƒˆ|mnp|povo|uq/.test(text)) {\n    return 'æ±ºæ¸ˆãƒ»ãƒã‚¤ãƒ³ãƒˆ';\n  }\n  \n  // ã‚¿ãƒã‚³ãƒ»å—œå¥½å“\n  if (/ã‚¿ãƒã‚³|ãŸã°ã“|ç…™è‰|é›»å­ã‚¿ãƒã‚³|åŠ ç†±å¼|vape|ã‚¢ã‚¤ã‚³ã‚¹|ãƒ—ãƒ«ãƒ¼ãƒ |ã‚°ãƒ­ãƒ¼/.test(text)) {\n    return 'ã‚¿ãƒã‚³ãƒ»å—œå¥½å“';\n  }\n  \n  return 'ãã®ä»–';\n}\n\n// å‰²å¼•ç‡ãƒ»é‡‘é¡ã‚’æŠ½å‡ºã™ã‚‹é–¢æ•°\nfunction extractDiscountInfo(detail, summary) {\n  const text = `${detail} ${summary}`;\n  let rate = null;\n  let amount = null;\n  \n  // å‰²å¼•ç‡ã®æŠ½å‡ºï¼ˆ%ï¼‰\n  const rateMatch = text.match(/(\\d+)%|é‚„å…ƒç‡[:ï¼š]?\\s*(\\d+)/);\n  if (rateMatch) {\n    rate = parseInt(rateMatch[1] || rateMatch[2]);\n  }\n  \n  // é‡‘é¡ã®æŠ½å‡ºï¼ˆå††ï¼‰\n  const amountMatch = text.match(/(\\d{1,3}(?:,\\d{3})*)å††|é‚„å…ƒé¡[:ï¼š]?\\s*(\\d{1,3}(?:,\\d{3})*)/);\n  if (amountMatch) {\n    const amountStr = (amountMatch[1] || amountMatch[2]).replace(/,/g, '');\n    amount = parseInt(amountStr);\n  }\n  \n  return { rate, amount };\n}\n\n// å„ªå…ˆåº¦åˆ¤å®šé–¢æ•°\nfunction determinePriority(discountRate, discountAmount) {\n  // A: 20%ä»¥ä¸Š ã¾ãŸã¯ 3000å††ä»¥ä¸Š\n  if ((discountRate && discountRate >= 20) || (discountAmount && discountAmount >= 3000)) {\n    return 'A';\n  }\n  \n  // B: 10%ä»¥ä¸Š ã¾ãŸã¯ 1000å††ä»¥ä¸Š\n  if ((discountRate && discountRate >= 10) || (discountAmount && discountAmount >= 1000)) {\n    return 'B';\n  }\n  \n  // C: ãã®ä»–\n  return 'C';\n}\n\n// ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°é–¢æ•°ï¼ˆ0-100ï¼‰\nfunction calculateScore(discountRate, discountAmount, priority, hasExpiration) {\n  let score = 50; // ãƒ™ãƒ¼ã‚¹ã‚¹ã‚³ã‚¢\n  \n  // å„ªå…ˆåº¦ã«ã‚ˆã‚‹ãƒœãƒ¼ãƒŠã‚¹\n  if (priority === 'A') score += 30;\n  else if (priority === 'B') score += 20;\n  else score += 10;\n  \n  // å‰²å¼•ç‡ã«ã‚ˆã‚‹ãƒœãƒ¼ãƒŠã‚¹\n  if (discountRate) {\n    score += Math.min(discountRate / 2, 10); // æœ€å¤§10ç‚¹\n  }\n  \n  // å‰²å¼•é¡ã«ã‚ˆã‚‹ãƒœãƒ¼ãƒŠã‚¹\n  if (discountAmount) {\n    score += Math.min(discountAmount / 500, 10); // æœ€å¤§10ç‚¹\n  }\n  \n  // æœŸé™æƒ…å ±ãŒã‚ã‚‹ã‹ã©ã†ã‹\n  if (hasExpiration) {\n    score += 5;\n  }\n  \n  // 100ç‚¹æº€ç‚¹ã«æ­£è¦åŒ–\n  return Math.min(Math.round(score), 100);\n}\n\n// ãƒ¡ã‚¤ãƒ³å‡¦ç†\nconst items = $input.all();\nconst transformedItems = [];\n\n// 0ä»¶ãƒã‚§ãƒƒã‚¯ï¼ˆSimpleLLMTaggingã‹ã‚‰ç©ºãƒ‡ãƒ¼ã‚¿ãŒæ¥ãŸå ´åˆï¼‰\nif (items.length === 1 && items[0].json.isEmpty) {\n  console.log('âš ï¸ æ–°è¦ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã®ãŸã‚ã€å¤‰æ›ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™');\n  // SaveToHistoryã«ã¯ç©ºãƒ‡ãƒ¼ã‚¿ã€BuildSlackMessageã«ã¯0ä»¶ãƒ•ãƒ©ã‚°ã‚’æ¸¡ã™\n  return [{ json: { isEmpty: true, count: 0 } }];\n}\n\nconsole.log(`ğŸ”„ TransformForTokuSearch: ${items.length}ä»¶ã‚’å‡¦ç†é–‹å§‹`);\n\nfor (const item of items) {\n  const data = item.json;\n  \n  // æ±ºå®šçš„IDç”Ÿæˆï¼ˆURLå„ªå…ˆã€ãªã‘ã‚Œã°å†…å®¹ãƒ™ãƒ¼ã‚¹ï¼‰\n  const id = generateDeterministicID(data);\n  console.log(`ğŸ“ ç”ŸæˆID: ${id} (ã‚¿ã‚¤ãƒˆãƒ«: ${data.title})`);\n  \n  // ã‚«ãƒ†ã‚´ãƒªåˆ¤å®š\n  const category_main = determineCategory(data.service || '', data.title || '', data.detail || '');\n  \n  // å‰²å¼•æƒ…å ±æŠ½å‡º\n  const { rate, amount } = extractDiscountInfo(data.detail || '', data.summary || '');\n  \n  // å„ªå…ˆåº¦åˆ¤å®š\n  const priority = determinePriority(rate, amount);\n  \n  // ã‚¹ã‚³ã‚¢è¨ˆç®—\n  const score = calculateScore(rate, amount, priority, !!data.expiration);\n  \n  // notesã«è¿½è¨˜ï¼ˆURLã€å‡ºå…¸æƒ…å ±ï¼‰\n  let notes = data.notes || '';\n  if (data.url) {\n    notes += notes ? '\\n' : '';\n    notes += `ã€å‡ºå…¸ã€‘${data.source_name || ''} (${data.source_id || ''})\\n${data.url}`;\n  }\n  \n  // ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—\n  const now = new Date().toISOString();\n  \n  // TokuSearchå½¢å¼ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ\n  const transformed = {\n    id: id,\n    date: data.date || new Date().toISOString().slice(0, 10),\n    title: data.title || '',\n    summary: data.summary || '',\n    detail: data.detail || '',\n    steps: data.steps || '',\n    service: data.service || '',\n    expiration: data.expiration || '',\n    conditions: data.conditions || '',\n    notes: notes,\n    category_main: category_main,\n    category_sub: '', // ã‚ªãƒ—ã‚·ãƒ§ãƒ³\n    is_public: 'TRUE',\n    priority: priority,\n    discount_rate: rate || '',\n    discount_amount: amount || '',\n    score: score,\n    created_at: now,\n    updated_at: now,\n    // v2.0 æ–°è¦è¿½åŠ ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆLLMã‚¿ã‚°ä»˜ã‘ãƒãƒ¼ãƒ‰ã‹ã‚‰å–å¾—ï¼‰\n    difficulty: '',\n    area_type: data.area_type || 'online+store',\n    target_user_type: data.target_user_type || 'all',\n    usage_type: data.usage_type || 'other',\n    is_welkatsu: data.is_welkatsu === true ? 'TRUE' : 'FALSE',\n    tags: data.tags || ''\n  };\n  \n  transformedItems.push({ json: transformed });\n}\n\nconsole.log(`âœ… TransformForTokuSearch: ${transformedItems.length}ä»¶ã®å¤‰æ›å®Œäº†`);\n\nreturn transformedItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1344,
        1072
      ],
      "id": "11c38b90-8396-4346-8115-efae6f54165a",
      "name": "TransformForTokuSearch"
    },
    {
      "parameters": {
        "content": "TokuSearchå¤‰æ›ï¼ˆv2.0å¯¾å¿œï¼‰",
        "height": 288,
        "width": 160,
        "color": 7
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        1312,
        992
      ],
      "typeVersion": 1,
      "id": "f2cbebd3-f6ab-4023-a465-c734d3c63b2b",
      "name": "Sticky Note4"
    },
    {
      "parameters": {
        "jsCode": "// ========================================\n// FilterByID: é«˜é€Ÿäº‹å‰ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆURLé‡è¤‡ãƒã‚§ãƒƒã‚¯å¼·åŒ–ç‰ˆï¼‰\n// notesãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰ã‚‚URLã‚’æŠ½å‡ºã—ã¦ç¢ºå®Ÿã«é‡è¤‡ã‚’é™¤å¤–\n// ========================================\n\n// URLãƒ™ãƒ¼ã‚¹IDç”Ÿæˆï¼ˆURLæ–‡å­—åˆ—ã¾ãŸã¯notesãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰ï¼‰\nfunction extractTwitterID(text) {\n  if (!text) return null;\n  const match = text.match(/status\\/(\\d+)/);\n  return match ? `x-${match[1]}` : null;\n}\n\n// ãƒ¡ã‚¤ãƒ³å‡¦ç†\n// æ–°è¦ãƒ‡ãƒ¼ã‚¿ï¼ˆParseGrokResponseã‹ã‚‰ï¼‰\nconst grokItems = $input.all().map(i => i.json);\n\n// æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ï¼ˆFilterRecentHistoryã‹ã‚‰$items()ã§å‚ç…§ï¼‰\nconst historyItems = $items('FilterRecentHistory').map(i => i.json);\n\n// å±¥æ­´ã®URL-IDä¸€è¦§ï¼ˆIDã¨notesä¸¡æ–¹ã‹ã‚‰æŠ½å‡ºï¼‰\nconst historyTwitterIDs = new Set();\n\nhistoryItems.forEach(item => {\n  // IDãŒx-ã§å§‹ã¾ã‚‹å ´åˆï¼ˆTwitter IDï¼‰\n  if (item.id && item.id.startsWith('x-')) {\n    historyTwitterIDs.add(item.id);\n  }\n  \n  // notesãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰ã‚‚Twitter IDã‚’æŠ½å‡º\n  if (item.notes) {\n    const twitterID = extractTwitterID(item.notes);\n    if (twitterID) historyTwitterIDs.add(twitterID);\n  }\n});\n\nconsole.log(`ğŸ“Š å±¥æ­´Twitter-IDæ•°: ${historyTwitterIDs.size}`);\nconsole.log(`ğŸ“Š Grokçµæœæ•°: ${grokItems.length}`);\n\n// URLé‡è¤‡ãƒã‚§ãƒƒã‚¯ï¼ˆå³å¯†ãªé‡è¤‡é™¤å¤–ï¼‰\nconst filtered = grokItems.filter(item => {\n  // Grokã®URLã‹ã‚‰Twitter IDã‚’æŠ½å‡º\n  const twitterID = extractTwitterID(item.url);\n  \n  if (twitterID && historyTwitterIDs.has(twitterID)) {\n    console.log(`âš ï¸ URLé‡è¤‡é™¤å¤–: ${item.title} (${twitterID})`);\n    return false; // é‡è¤‡\n  }\n  \n  return true; // æ–°è¦\n});\n\nconsole.log(`âœ… FilterByIDå®Œäº†: ${filtered.length}ä»¶ãŒæ–°è¦ï¼ˆ${grokItems.length - filtered.length}ä»¶ã‚’é™¤å¤–ï¼‰`);\n\n// 0ä»¶ã®å ´åˆã§ã‚‚å¾Œç¶šå‡¦ç†ã‚’ç¶šã‘ã‚‹ãŸã‚ã«ã€ç©ºãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ©ã‚°ã‚’è¿”ã™\nif (filtered.length === 0) {\n  console.log('âš ï¸ FilterByID: æ–°è¦ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã®ãŸã‚ã€ç©ºãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ©ã‚°ã‚’è¿”ã—ã¾ã™');\n  return [{ json: { isEmpty: true, count: 0, message: 'ã™ã¹ã¦é‡è¤‡ã¨ã—ã¦é™¤å¤–ã•ã‚Œã¾ã—ãŸ' } }];\n}\n\nconsole.log(`â¡ï¸ æ¬¡ã«Geminiã§å†…å®¹ãƒ™ãƒ¼ã‚¹é‡è¤‡ã‚’æœ€çµ‚åˆ¤å®šã—ã¾ã™`);\n\nreturn filtered.map(i => ({ json: i }));\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        208,
        832
      ],
      "id": "2daceeb1-77bc-4d39-bfd9-422c2e07dfc1",
      "name": "FilterByID"
    },
    {
      "parameters": {
        "content": "ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¿ã‚°ä»˜ã‘ï¼ˆv2.0 - é«˜é€Ÿãƒ»ä½ã‚³ã‚¹ãƒˆï¼‰",
        "height": 288,
        "width": 416,
        "color": 3
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        880,
        992
      ],
      "typeVersion": 1,
      "id": "34d3c757-5161-4973-aab2-687a2ecb6d75",
      "name": "Sticky Note5"
    },
    {
      "parameters": {
        "jsCode": "// ========================================\n// SimpleLLMTagging: ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¿ã‚°ä»˜ã‘ï¼ˆv2.0ï¼‰\n// difficultyã¯ä½¿ç”¨ã—ãªã„ãŸã‚å‰Šé™¤æ¸ˆã¿\n// ========================================\n\nconst items = $input.all();\nconst enrichedItems = [];\n\n// 0ä»¶ãƒã‚§ãƒƒã‚¯ï¼ˆUnpackGeminiResultsã‹ã‚‰ç©ºãƒ‡ãƒ¼ã‚¿ãŒæ¥ãŸå ´åˆï¼‰\nif (items.length === 1 && items[0].json.isEmpty) {\n  console.log('âš ï¸ æ–°è¦ãƒ‡ãƒ¼ã‚¿ãŒ0ä»¶ã®ãŸã‚ã€ã‚¿ã‚°ä»˜ã‘ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã™');\n  return [{ json: { isEmpty: true, count: 0 } }];\n}\n\n// ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹åˆ¤å®š\nconst ruleBasedTagging = (item) => {\n  const text = `${item.title} ${item.service} ${item.detail}`.toLowerCase();\n  \n  // ã‚¦ã‚¨ãƒ«æ´»åˆ¤å®š\n  const is_welkatsu = /ã‚¦ã‚¨ãƒ«ã‚·ã‚¢|ã‚¦ã‚¨ãƒ«æ´»/.test(text);\n  \n  // ãƒãƒ£ãƒãƒ«åˆ¤å®š\n  let area_type = 'online+store';\n  if (/ã‚ªãƒ³ãƒ©ã‚¤ãƒ³|ec|é€šè²©|amazon|æ¥½å¤©|yahoo/.test(text)) area_type = 'online';\n  else if (/åº—èˆ—|æ¥åº—|å®Ÿåº—/.test(text)) area_type = 'store';\n  \n  // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¿ã‚¤ãƒ—åˆ¤å®š\n  let target_user_type = 'all';\n  if (/åˆã‚ã¦|æ–°è¦|åˆ©ç”¨ãªã—|ä¹…ã—ã¶ã‚Š/.test(text)) target_user_type = 'new_or_inactive';\n  else if (/é™å®š|å®¶æ—|å­¦ç”Ÿ|ä¼šå“¡/.test(text)) target_user_type = 'limited';\n  \n  // ç”¨é€”åˆ¤å®š\n  let usage_type = 'other';\n  if (/ãƒ‰ãƒ©ãƒƒã‚°|æ—¥ç”¨å“|åŒ–ç²§å“/.test(text)) usage_type = 'daily_goods';\n  else if (/ã‚°ãƒ«ãƒ¡|å¤–é£Ÿ|ãƒ¬ã‚¹ãƒˆãƒ©ãƒ³|é£²é£Ÿ/.test(text)) usage_type = 'eating_out';\n  else if (/æ—…è¡Œ|ãƒ›ãƒ†ãƒ«|èˆªç©º|jr/.test(text)) usage_type = 'travel';\n  else if (/paypay|æ±ºæ¸ˆ|ãƒã‚¤ãƒ³ãƒˆ|é‚„å…ƒ|éŠ€è¡Œ/.test(text)) usage_type = 'financial';\n  \n  // ã‚¿ã‚°ç”Ÿæˆ\n  const tags = [];\n  if (item.service) tags.push(item.service);\n  if (/paypay/.test(text)) tags.push('PayPay');\n  if (/ã‚»ãƒ¼ãƒ«|ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³/.test(text)) tags.push('ã‚»ãƒ¼ãƒ«');\n  if (is_welkatsu) tags.push('ã‚¦ã‚¨ãƒ«æ´»');\n  tags.push(usage_type === 'daily_goods' ? 'æ—¥ç”¨å“' : 'å‰²å¼•');\n  \n  return { area_type, target_user_type, usage_type, is_welkatsu, tags: tags.slice(0, 5).join(',') };\n};\n\nconsole.log(`ğŸ·ï¸ ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¿ã‚°ä»˜ã‘é–‹å§‹: ${items.length}ä»¶`);\n\n// å…¨ã‚¢ã‚¤ãƒ†ãƒ ã«ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¿ã‚°ä»˜ã‘ã‚’é©ç”¨\nfor (const item of items) {\n  const data = item.json;\n  const tagging = ruleBasedTagging(data);\n  \n  enrichedItems.push({\n    json: {\n      ...data,\n      ...tagging\n    }\n  });\n}\n\nconsole.log(`âœ… ã‚¿ã‚°ä»˜ã‘å®Œäº†: ${enrichedItems.length}ä»¶ï¼ˆãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ãƒ»é«˜é€Ÿï¼‰`);\n\nreturn enrichedItems;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        960,
        1072
      ],
      "id": "0eee3e35-4eeb-4e16-b9c9-6f21cfec42c0",
      "name": "SimpleLLMTagging"
    }
  ],
  "pinData": {},
  "connections": {
    "ParseGrokResponse": {
      "main": [
        [
          {
            "node": "FilterByID",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GeneratePrompt": {
      "main": [
        [
          {
            "node": "CallGrokAI",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "CallGrokAI": {
      "main": [
        [
          {
            "node": "ParseGrokResponse",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "GetSentHistory": {
      "main": [
        [
          {
            "node": "FilterRecentHistory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildSlackMessage": {
      "main": [
        [
          {
            "node": "SlackNotify",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Message a model": {
      "main": [
        [
          {
            "node": "UnpackGeminiResults",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "BuildGeminiPrompt": {
      "main": [
        [
          {
            "node": "Message a model",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WrapItemsAsArray": {
      "main": [
        [
          {
            "node": "BuildGeminiPrompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "UnpackGeminiResults": {
      "main": [
        [
          {
            "node": "SimpleLLMTagging",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FilterRecentHistory": {
      "main": [
        [
          {
            "node": "GeneratePrompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TransformForTokuSearch": {
      "main": [
        [
          {
            "node": "BuildSlackMessage",
            "type": "main",
            "index": 0
          },
          {
            "node": "SaveToHistory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "TriggerEvery1": {
      "main": [
        [
          {
            "node": "GetSentHistory",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "FilterByID": {
      "main": [
        [
          {
            "node": "WrapItemsAsArray",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SimpleLLMTagging": {
      "main": [
        [
          {
            "node": "TransformForTokuSearch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "03c2ad89-b3d1-4aab-9cd0-5fd1d3a03832",
  "meta": {
    "instanceId": "fefffd21e64fa94994bb4bf38b5a050c59f6cf28bd3cad9da0a5804220d9e97f"
  },
  "id": "9Q6T3O2xHWhcAjFC",
  "tags": []
}