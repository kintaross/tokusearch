# メンテナンスモード（MAINTENANCE_MODE）

ドメインにアクセスした一般ユーザーをメンテナンスページ（`/maintenance`）に誘導する機能です。

## 有効化・解除

### 有効化（メンテ開始）

1. 本番環境の環境変数に **`MAINTENANCE_MODE=1`** を設定する。
2. デプロイする（または環境変数を保存して再デプロイ）。

例（Vercel）: Project → Settings → Environment Variables → `MAINTENANCE_MODE` = `1` を追加し、本番用に保存。

### 解除（メンテ終了）

1. **`MAINTENANCE_MODE`** を削除するか、値を `0` に変更する。
2. 再デプロイする。

## 動作

- **MAINTENANCE_MODE=1** のとき:
  - 一般ユーザーがトップ（`/`）やお得情報ページなどにアクセスすると、自動で **`/maintenance`** にリダイレクトされます。
  - API・静的ファイル（`/api/*`, `_next/static`, `favicon.ico` など）は従来どおり利用可能です。

## 管理者の裏口

メンテ中でも管理者がサイトを利用できるようにするため、次の「裏口」があります。

1. **ログイン済みの場合**: NextAuth のセッション（JWT）が有効なユーザーは、メンテ中でも **全ページ**（トップ、お得情報、管理画面など）を通常どおり閲覧できます。
2. **未ログインの場合**: 次のパスはメンテ中でもアクセス可能です。
   - **`/login`** … 管理者ログイン画面
   - **`/admin`** … 管理画面（ログイン必須のため、未ログインならログイン画面へ誘導されます）

### 運用の流れ

1. 管理者はメンテページ下部の「**管理者の方はログイン**」から `/login` へ進む。
2. ログインすると、そのあとはトップやお得情報ページ、管理画面を含め、サイト全体を利用できる。

## 関連ファイル

- **middleware**: [middleware.ts](../middleware.ts) … リダイレクトとセッション判定
- **メンテページ**: [app/maintenance/page.tsx](../app/maintenance/page.tsx)
- **カウントダウン日時**: 環境変数 **`NEXT_PUBLIC_MAINTENANCE_END_AT`**（例: `2026-02-16T00:00:00+09:00`）で指定。未設定時は 2026年2月16日 0:00 JST がデフォルト。
