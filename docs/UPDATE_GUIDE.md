# 記事更新ガイド

このサイトは**Google Sheets**をデータソースとして使用しています。記事を更新するには、Googleスプレッドシートに直接データを追加・編集してください。

## 📋 必要なスプレッドシートの形式

### シート名
- デフォルト: `Sheet1`
- カスタムシート名を使用する場合は、環境変数 `GOOGLE_SHEETS_SHEET_NAME` で指定可能

### 必須カラム（ヘッダー行）

| カラム名 | 説明 | 必須 | 例 |
|---------|------|------|-----|
| `id` | ユニークID（UUID推奨） | ✅ | `550e8400-e29b-41d4-a716-446655440000` |
| `date` | 掲載日（YYYY-MM-DD形式） | ✅ | `2024-01-15` |
| `title` | タイトル | ✅ | `PayPayボーナス還元キャンペーン` |
| `summary` | サマリー（概要） | ✅ | `PayPayで最大20%還元！期間限定のお得なキャンペーンです。` |
| `category_main` | メインカテゴリ | ✅ | `決済・ポイント` |
| `is_public` | 公開フラグ（TRUE/FALSE） | ✅ | `TRUE` |
| `priority` | 優先度（A/B/C） | ✅ | `A` |
| `detail` | 詳細内容 | | `【詳細】\nPayPayで実施中の特別キャンペーンです。` |
| `steps` | 利用手順 | | `【利用手順】\n1. PayPayアプリを開く\n2. キャンペーンページからエントリー` |
| `service` | サービス名 | | `PayPay` |
| `expiration` | 期限（YYYY-MM-DD形式） | | `2024-02-15` |
| `conditions` | 適用条件・注意点 | | `新規会員限定 / 先着順 / 1回限り` |
| `notes` | 備考 | | `※還元額は購入金額により変動します` |
| `category_sub` | サブカテゴリ | | `QR` |
| `discount_rate` | 割引率（数値） | | `20` |
| `discount_amount` | 還元額（数値） | | `5000` |
| `score` | スコア（0-100） | | `85` |
| `created_at` | 作成日時（ISO形式） | | `2024-01-15T10:00:00Z` |
| `updated_at` | 更新日時（ISO形式） | | `2024-01-15T10:00:00Z` |

### カテゴリ一覧

**メインカテゴリ（`category_main`）:**
- `ドラッグストア・日用品`
- `スーパー・量販店・EC`
- `グルメ・外食`
- `旅行・交通`
- `決済・ポイント`
- `タバコ・嗜好品`
- `その他`

**優先度（`priority`）:**
- `A`: 注目案件（🔥 注目として表示）
- `B`: おすすめ（⭐ おすすめとして表示）
- `C`: 通常（✨ 通常として表示）

## 🔄 更新方法

### 方法1: Googleスプレッドシートで直接編集

1. Googleスプレッドシートを開く
2. 新しい行を追加、または既存の行を編集
3. 各カラムに適切な値を入力
4. `is_public` を `TRUE` に設定（公開する場合）
5. 保存（自動保存）

**注意点:**
- `id` は重複しないように注意してください（UUID推奨）
- `is_public` が `FALSE` の記事はサイトに表示されません
- 日付は `YYYY-MM-DD` 形式で入力してください

### 方法2: n8n + LLM による自動収集（推奨）

初期設計書に記載されている通り、n8n + LLMを使用した自動収集・整形・分類システムを構築することを推奨します。

**ワークフロー例:**
1. **n8n トリガー**: X（Twitter）の特定アカウントやハッシュタグを監視
2. **LLM処理**: 収集した情報を構造化（タイトル、サマリー、詳細、カテゴリ分類など）
3. **Google Sheets書き込み**: 整形されたデータをスプレッドシートに自動追加

**n8n設定例:**
- **トリガー**: Twitter API / RSS Feed / Webhook
- **LLM処理**: OpenAI API / Anthropic Claude API など
- **データ整形**: カテゴリ分類、優先度判定、スコア算出
- **出力**: Google Sheets API で書き込み

### 方法3: CSVインポート

大量のデータを一度に追加する場合:

1. CSVファイルを準備（上記のカラム形式に準拠）
2. Googleスプレッドシートで「ファイル」→「インポート」→「アップロード」
3. CSVファイルを選択してインポート

**CSV生成スクリプト:**
```bash
npm run generate:test-data > deals.csv
```

## 🔍 データの反映タイミング

- **開発環境**: ページをリロードすると最新データが反映されます（Next.jsの動的レンダリング）
- **本番環境**: デプロイ時にデータが取得されます。リアルタイム更新が必要な場合は、ISR（Incremental Static Regeneration）の設定を検討してください

## 📝 データ例

```csv
id,date,title,summary,category_main,is_public,priority,service,expiration,discount_rate,discount_amount,score
550e8400-e29b-41d4-a716-446655440000,2024-01-15,PayPayボーナス還元キャンペーン,PayPayで最大20%還元！期間限定のお得なキャンペーンです。,決済・ポイント,TRUE,A,PayPay,2024-02-15,20,5000,85
```

## ⚙️ 環境変数の設定

記事更新には、以下の環境変数が正しく設定されている必要があります:

```env
# 必須
GOOGLE_SHEETS_SPREADSHEET_ID=your_spreadsheet_id

# 認証（いずれか一方）
GOOGLE_SHEETS_API_KEY=your_api_key
# または
GOOGLE_SERVICE_ACCOUNT_KEY={"type":"service_account",...}

# オプション
GOOGLE_SHEETS_SHEET_NAME=Sheet1
```

## 🚨 トラブルシューティング

### 記事が表示されない場合

1. **`is_public` が `TRUE` になっているか確認**
2. **必須フィールド（`id`, `title`, `date`）が入力されているか確認**
3. **環境変数が正しく設定されているか確認**
4. **スプレッドシートの共有設定を確認**（サービスアカウントを使用している場合）

### データが更新されない場合

- ブラウザのキャッシュをクリア
- 開発サーバーを再起動
- 環境変数を再確認

## 📚 関連ドキュメント

- [README.md](../README.md) - セットアップ手順
- [types/deal.ts](../types/deal.ts) - データ型定義

