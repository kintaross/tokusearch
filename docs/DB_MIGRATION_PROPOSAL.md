# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŒ–ã®ææ¡ˆ

## ðŸ“Š ç¾çŠ¶ã®å•é¡Œç‚¹

ç¾åœ¨ã€Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€ä»¥ä¸‹ã®èª²é¡ŒãŒã‚ã‚Šã¾ã™ï¼š

1. **é‚„å…ƒçŽ‡ãƒ»é‚„å…ƒé¡ã®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ãŒä¸æ­£ç¢º**
   - n8nãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§æ­£è¦è¡¨ç¾ã«ã‚ˆã‚‹æŠ½å‡ºã‚’è¡Œã£ã¦ã„ã‚‹ãŒã€èª¤æ¤œå‡ºãŒå¤šã„
   - ä¾‹ï¼šã€Œå®¶æ—6äºº23760å††ã€â†’ 23760å††ãŒé‚„å…ƒé¡ã¨ã—ã¦èª¤æŠ½å‡ºã•ã‚Œã‚‹

2. **ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ãŒä¿ã¡ã«ãã„**
   - ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã§ã¯åž‹ãƒã‚§ãƒƒã‚¯ãŒå¼±ã„
   - è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚¢ãƒ—ãƒªå´ã§å®Ÿè£…ã§ããªã„

3. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹ã®åˆ¶ç´„**
   - æ¯Žå›žAPIçµŒç”±ã§å…¨ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
   - ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥ãŒé™å®šçš„

4. **æŸ”è»Ÿãªã‚¯ã‚¨ãƒªãŒã§ããªã„**
   - è¤‡é›‘ãªæ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãŒå›°é›£
   - é›†è¨ˆå‡¦ç†ãŒã§ããªã„

## âœ… DBåŒ–ã®ãƒ¡ãƒªãƒƒãƒˆ

1. **é‚„å…ƒçŽ‡ãƒ»é‚„å…ƒé¡ã®æ­£ç¢ºãªè¨ˆç®—**
   - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å´ã§è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…å¯èƒ½
   - ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§ã‚’ä¿è¨¼ã§ãã‚‹

2. **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒžãƒ³ã‚¹å‘ä¸Š**
   - ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã‚ˆã‚‹é«˜é€Ÿæ¤œç´¢
   - å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã®ã¿å–å¾—å¯èƒ½

3. **æŸ”è»Ÿãªã‚¯ã‚¨ãƒª**
   - SQLã«ã‚ˆã‚‹è¤‡é›‘ãªæ¤œç´¢ãƒ»é›†è¨ˆãŒå¯èƒ½
   - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å¯¾å¿œ

4. **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**
   - å¤§é‡ãƒ‡ãƒ¼ã‚¿ã«ã‚‚å¯¾å¿œå¯èƒ½
   - ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚·ãƒƒãƒ—ã®ç®¡ç†ãŒå®¹æ˜“

## ðŸŽ¯ æŽ¨å¥¨DBé¸æŠžè‚¢

### 1. Vercel Postgresï¼ˆæœ€æŽ¨å¥¨ï¼‰

**ãƒ¡ãƒªãƒƒãƒˆ:**
- Vercelã¨å®Œå…¨çµ±åˆã€è¨­å®šãŒæœ€ã‚‚ç°¡å˜
- ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹å‘ã‘ã«æœ€é©åŒ–
- è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°
- ç„¡æ–™æž ã‚ã‚Šï¼ˆ60æ™‚é–“/æœˆï¼‰

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- Vercelå°‚ç”¨ï¼ˆä»–ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§ã¯ä½¿ç”¨ä¸å¯ï¼‰

**æ–™é‡‘:**
- Hobby: ç„¡æ–™ï¼ˆ60æ™‚é–“/æœˆï¼‰
- Pro: $20/æœˆï¼ˆ512æ™‚é–“/æœˆï¼‰

### 2. Supabaseï¼ˆæ¬¡ç‚¹æŽ¨å¥¨ï¼‰

**ãƒ¡ãƒªãƒƒãƒˆ:**
- PostgreSQLãƒ™ãƒ¼ã‚¹ã€æ¨™æº–SQLãŒä½¿ãˆã‚‹
- ç„¡æ–™æž ãŒå……å®Ÿï¼ˆ500MB DBã€2GBè»¢é€ï¼‰
- Vercelã¨ç›¸æ€§ãŒè‰¯ã„
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ©Ÿèƒ½ã‚ã‚Š
- ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒä½¿ã„ã‚„ã™ã„

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- åˆ¥ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆVercelã¨ã¯åˆ¥ç®¡ç†ï¼‰

**æ–™é‡‘:**
- Free: ç„¡æ–™ï¼ˆ500MB DBï¼‰
- Pro: $25/æœˆï¼ˆ8GB DBï¼‰

### 3. PlanetScale

**ãƒ¡ãƒªãƒƒãƒˆ:**
- MySQLäº’æ›ã€ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹å‘ã‘
- ç„¡æ–™æž ã‚ã‚Šï¼ˆ5GB DBï¼‰
- ãƒ–ãƒ©ãƒ³ãƒæ©Ÿèƒ½ï¼ˆé–‹ç™ºç’°å¢ƒã®åˆ†é›¢ï¼‰

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- MySQLæ§‹æ–‡ï¼ˆPostgreSQLã‚ˆã‚Šåˆ¶ç´„ã‚ã‚Šï¼‰

**æ–™é‡‘:**
- Free: ç„¡æ–™ï¼ˆ5GB DBï¼‰
- Scaler: $29/æœˆï¼ˆ10GB DBï¼‰

### 4. Neon

**ãƒ¡ãƒªãƒƒãƒˆ:**
- PostgreSQLã€ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹å‘ã‘
- ç„¡æ–™æž ã‚ã‚Šï¼ˆ3GB DBï¼‰
- è‡ªå‹•ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:**
- æ¯”è¼ƒçš„æ–°ã—ã„ã‚µãƒ¼ãƒ“ã‚¹

**æ–™é‡‘:**
- Free: ç„¡æ–™ï¼ˆ3GB DBï¼‰
- Launch: $19/æœˆï¼ˆ10GB DBï¼‰

## ðŸ—ï¸ æŽ¨å¥¨æ§‹æˆ

### é¸æŠž: **Supabase** ã¾ãŸã¯ **Vercel Postgres**

**ç†ç”±:**
- Vercel Postgres: Vercelã‚’ä½¿ã£ã¦ã„ã‚‹ãªã‚‰æœ€ã‚‚ç°¡å˜
- Supabase: ã‚ˆã‚ŠæŸ”è»Ÿã§ã€ç„¡æ–™æž ã‚‚å……å®Ÿ

## ðŸ“‹ å®Ÿè£…è¨ˆç”»

### Phase 1: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

1. **DBé¸æŠžã¨ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**
   - Vercel Postgres ã¾ãŸã¯ Supabase ã‚’é¸æŠž
   - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ

2. **ã‚¹ã‚­ãƒ¼ãƒžè¨­è¨ˆ**
   ```sql
   CREATE TABLE deals (
     id VARCHAR(255) PRIMARY KEY,
     date DATE NOT NULL,
     title VARCHAR(500) NOT NULL,
     summary TEXT,
     detail TEXT,
     steps TEXT,
     service VARCHAR(200),
     expiration VARCHAR(100),
     conditions TEXT,
     notes TEXT,
     category_main VARCHAR(100) NOT NULL,
     category_sub VARCHAR(100),
     is_public BOOLEAN DEFAULT true,
     priority CHAR(1) DEFAULT 'C',
     discount_rate DECIMAL(5,2),  -- é‚„å…ƒçŽ‡ï¼ˆ%ï¼‰
     discount_amount INTEGER,      -- é‚„å…ƒé¡ï¼ˆå††ï¼‰
     score INTEGER DEFAULT 0,
     created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
     updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
     -- æ–°è¦ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
     difficulty VARCHAR(50),
     area_type VARCHAR(50),
     target_user_type VARCHAR(50),
     usage_type VARCHAR(50),
     is_welkatsu BOOLEAN DEFAULT false,
     tags TEXT
   );

   CREATE INDEX idx_deals_category ON deals(category_main);
   CREATE INDEX idx_deals_priority ON deals(priority);
   CREATE INDEX idx_deals_date ON deals(date);
   CREATE INDEX idx_deals_public ON deals(is_public);
   ```

3. **ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ**
   - Google Sheetsã‹ã‚‰DBã¸ã®ç§»è¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆ
   - æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œ

### Phase 2: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

1. **DBæŽ¥ç¶šãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å°Žå…¥**
   ```bash
   # Supabaseã®å ´åˆ
   npm install @supabase/supabase-js
   
   # Vercel Postgresã®å ´åˆ
   npm install @vercel/postgres
   
   # ã¾ãŸã¯æ±Žç”¨PostgreSQL
   npm install pg
   ```

2. **ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ã®å®Ÿè£…**
   - `lib/db.ts` - DBæŽ¥ç¶šç®¡ç†
   - `lib/deals.ts` - Dealãƒ‡ãƒ¼ã‚¿ã®CRUDæ“ä½œ
   - é‚„å…ƒçŽ‡ãƒ»é‚„å…ƒé¡ã®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚’å®Ÿè£…

3. **é‚„å…ƒçŽ‡ãƒ»é‚„å…ƒé¡ã®è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯**
   ```typescript
   // é‚„å…ƒé¡ã‚’è¨ˆç®—ã™ã‚‹é–¢æ•°
   function calculateDiscountAmount(
     detail: string,
     summary: string,
     discountRate?: number
   ): number | null {
     // 1. æ˜Žç¤ºçš„ã«ã€Œé‚„å…ƒé¡ã€ã¨è¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹å ´åˆ
     const explicitMatch = /é‚„å…ƒé¡[:ï¼š]?\s*(\d{1,3}(?:,\d{3})*)/.exec(detail + summary);
     if (explicitMatch) {
       return parseInt(explicitMatch[1].replace(/,/g, ''));
     }
     
     // 2. é‚„å…ƒçŽ‡ã¨ä¾¡æ ¼æƒ…å ±ã‹ã‚‰è¨ˆç®—
     if (discountRate) {
       const priceMatch = /(\d{1,3}(?:,\d{3})*)å††/.exec(detail + summary);
       if (priceMatch) {
         const price = parseInt(priceMatch[1].replace(/,/g, ''));
         // ä¾¡æ ¼ãŒå¦¥å½“ãªç¯„å›²å†…ï¼ˆ1000å††ã€œ100ä¸‡å††ï¼‰ã®å ´åˆã®ã¿è¨ˆç®—
         if (price >= 1000 && price <= 1000000) {
           return Math.round(price * discountRate / 100);
         }
       }
     }
     
     return null;
   }
   ```

### Phase 3: ç§»è¡Œã¨ãƒ†ã‚¹ãƒˆ

1. **æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã®ç§»è¡Œ**
   - Google Sheetsã‹ã‚‰DBã¸ä¸€æ‹¬ç§»è¡Œ
   - ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã®ç¢ºèª

2. **æ®µéšŽçš„åˆ‡ã‚Šæ›¿ãˆ**
   - ä¸€æ™‚çš„ã«ä¸¡æ–¹ã®ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’ã‚µãƒãƒ¼ãƒˆ
   - å‹•ä½œç¢ºèªå¾Œã«Google Sheetsã‚’å»ƒæ­¢

3. **n8nãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®æ›´æ–°**
   - DBã¸ã®ç›´æŽ¥æ›¸ãè¾¼ã¿ã«å¤‰æ›´
   - é‚„å…ƒçŽ‡ãƒ»é‚„å…ƒé¡ã®è¨ˆç®—ã‚’n8nå´ã§ã‚‚æ”¹å–„

## ðŸš€ å®Ÿè£…æ‰‹é †ï¼ˆSupabaseã®å ´åˆï¼‰

### 1. Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

1. https://supabase.com/ ã«ã‚¢ã‚¯ã‚»ã‚¹
2. æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ
3. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆURLã¨APIã‚­ãƒ¼ã‚’å–å¾—

### 2. ç’°å¢ƒå¤‰æ•°è¨­å®š

```env
NEXT_PUBLIC_SUPABASE_URL=https://your-project.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
```

### 3. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install @supabase/supabase-js
```

### 4. DBæŽ¥ç¶šå®Ÿè£…

`lib/supabase.ts` ã‚’ä½œæˆ

### 5. ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤å®Ÿè£…

`lib/deals.ts` ã‚’æ›´æ–°ã—ã¦Supabaseã‚’ä½¿ç”¨

## ðŸš€ å®Ÿè£…æ‰‹é †ï¼ˆVercel Postgresã®å ´åˆï¼‰

### 1. Vercel Postgresä½œæˆ

1. Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ Storage â†’ Create Database
2. Postgresã‚’é¸æŠž
3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ

### 2. ç’°å¢ƒå¤‰æ•°è‡ªå‹•è¨­å®š

VercelãŒè‡ªå‹•çš„ã«ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šï¼š
- `POSTGRES_URL`
- `POSTGRES_PRISMA_URL`
- `POSTGRES_URL_NON_POOLING`

### 3. ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install @vercel/postgres
```

### 4. ã‚¹ã‚­ãƒ¼ãƒžä½œæˆ

Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®SQL Editorã§ã‚¹ã‚­ãƒ¼ãƒžã‚’å®Ÿè¡Œ

### 5. ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤å®Ÿè£…

`lib/deals.ts` ã‚’æ›´æ–°ã—ã¦Vercel Postgresã‚’ä½¿ç”¨

## ðŸ“Š æ¯”è¼ƒè¡¨

| é …ç›® | Vercel Postgres | Supabase | PlanetScale | Neon |
|------|----------------|----------|-------------|------|
| çµ±åˆæ€§ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­ |
| ç„¡æ–™æž  | 60æ™‚é–“/æœˆ | 500MB DB | 5GB DB | 3GB DB |
| è¨­å®šã®ç°¡å˜ã• | â­â­â­â­â­ | â­â­â­â­ | â­â­â­ | â­â­â­ |
| æŸ”è»Ÿæ€§ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | â­â­â­â­ |
| æ–™é‡‘ | $20/æœˆ | $25/æœˆ | $29/æœˆ | $19/æœˆ |

## ðŸŽ¯ æŽ¨å¥¨

**Vercel Postgres** ã‚’æŽ¨å¥¨ã—ã¾ã™ã€‚

**ç†ç”±:**
- Vercelã¨å®Œå…¨çµ±åˆã§è¨­å®šãŒç°¡å˜
- ç’°å¢ƒå¤‰æ•°ãŒè‡ªå‹•è¨­å®šã•ã‚Œã‚‹
- ã‚µãƒ¼ãƒãƒ¼ãƒ¬ã‚¹å‘ã‘ã«æœ€é©åŒ–
- ç„¡æ–™æž ã§ååˆ†ãªå ´åˆãŒå¤šã„

ãŸã ã—ã€ã‚ˆã‚ŠæŸ”è»Ÿæ€§ãŒå¿…è¦ãªå ´åˆã¯ **Supabase** ã‚‚è‰¯ã„é¸æŠžè‚¢ã§ã™ã€‚
