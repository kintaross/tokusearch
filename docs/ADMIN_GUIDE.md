# TokuSearch 管理画面ガイド

TokuSearchの管理画面の使い方を説明します。

## 📚 目次

1. [初期セットアップ](#初期セットアップ)
2. [ログイン](#ログイン)
3. [ダッシュボード](#ダッシュボード)
4. [コラム管理](#コラム管理)
5. [お得情報管理](#お得情報管理)

---

## 初期セットアップ

### 1. Google Sheetsのシートを作成

```bash
node scripts/create-admin-sheets.js
```

このコマンドで以下のシートが作成されます：
- `columns` - コラム記事データ
- `admin_users` - 管理者アカウント

### 2. 初期管理者アカウントを作成

```bash
node scripts/create-default-admin.js
```

デフォルトのログイン情報：
- **ユーザー名**: `admin`
- **パスワード**: `admin123`

⚠️ **セキュリティのため、初回ログイン後に必ずパスワードを変更してください！**

### 3. 環境変数の設定

`.env.local`に以下を追加（まだの場合）：

```
NEXTAUTH_SECRET=ランダムな文字列（32文字以上推奨）
NEXTAUTH_URL=http://localhost:3000
```

NEXTAUTH_SECRETは以下のコマンドで生成できます：

```bash
openssl rand -base64 32
```

---

## ログイン

1. ブラウザで `/admin/login` にアクセス
2. ユーザー名とパスワードを入力
3. 「ログイン」ボタンをクリック

ログインに成功すると、ダッシュボードにリダイレクトされます。

---

## ダッシュボード

ダッシュボード（`/admin/dashboard`）では以下の情報が表示されます：

- 📊 **統計情報**
  - 公開中のコラム数
  - 下書きのコラム数
  - 公開中のお得情報数
  - 総閲覧数

- 📝 **最近のコラム**（最新5件）
- 💰 **最近のお得情報**（最新5件）

---

## コラム管理

### コラム一覧（`/admin/columns`）

すべてのコラムの一覧が表示されます。

- **新規作成**: 「新規作成」ボタンをクリック
- **編集**: 各コラムの「編集」リンクをクリック

### コラムの作成（`/admin/columns/new`）

#### 基本情報

- **タイトル** (必須): コラムのタイトル
- **URLスラッグ**: URL用の文字列（空欄の場合は自動生成）
- **概要**: SEO用の説明文（検索結果に表示されます）

#### カテゴリとタグ

- **カテゴリ**: 以下から選択
  - ポイント活用術
  - 決済サービス
  - お得活用事例
  - 基礎知識
  - その他

- **タグ**: カンマ区切りで複数指定可能
  - 例: `マイル, ANA, ポイント交換`

#### サムネイル画像

1. 画像アップロードエリアをクリック
2. 画像ファイルを選択（PNG, JPG, GIF / 最大5MB）
3. アップロードが完了すると、画像が表示されます

#### 本文の執筆

2種類のエディタを切り替えて使用できます：

**1. マークダウンエディタ**
- マークダウン記法で執筆
- プレビューをリアルタイム表示
- シンプルで軽量

**2. リッチエディタ**
- ビジュアル編集
- ツールバーでフォーマット
- Word感覚で執筆可能

#### 公開設定

- **注目記事にする**: チェックすると、コラム一覧の上部に表示されます
- **ステータス**:
  - **下書き**: 非公開（執筆途中）
  - **公開**: サイトに公開される
  - **アーカイブ**: 非公開（過去記事）

#### 保存

- **下書き保存**: 公開せずに保存
- **公開する**: 即座に公開

### コラムの編集（`/admin/columns/[id]/edit`）

作成と同じフォームですが、以下の機能が追加されています：

- **削除ボタン**: コラムを完全に削除（要確認）

---

## お得情報管理

### お得情報一覧（`/admin/deals`）

n8nで自動収集されたお得情報の一覧が表示されます。

- 最新50件のみ表示
- 公開/非公開の切り替え（準備中）
- 優先度の変更（準備中）

⚠️ **注意**: お得情報の詳細編集機能は現在準備中です。

---

## Tips & トラブルシューティング

### Q. ログインできません

A. 以下を確認してください：
1. ユーザー名とパスワードが正しいか
2. 管理者アカウントが作成されているか（`scripts/create-default-admin.js`を実行）
3. `.env.local`に`NEXTAUTH_SECRET`が設定されているか

### Q. 画像がアップロードできません

A. 以下を確認してください：
1. ファイルサイズが5MB以下か
2. ファイル形式が画像か（PNG, JPG, GIF）
3. `public/columns/images/`ディレクトリが書き込み可能か

### Q. コラムが公開されません

A. 以下を確認してください：
1. ステータスが「公開」になっているか
2. Google Sheetsに正しく保存されているか
3. ブラウザのキャッシュをクリアしてみる

### Q. 管理画面が表示されません

A. 以下を確認してください：
1. Next.jsサーバーが起動しているか（`npm run dev`）
2. `/admin/login`にアクセスしているか
3. NextAuth.jsが正しく設定されているか

---

## セキュリティ

### パスワードの変更

現在、パスワード変更機能は準備中です。
Google Sheetsで直接パスワードハッシュを更新するか、新しいアカウントを作成してください。

### アクセス制限

管理画面（`/admin/*`）は認証が必要です。
ログインしていない場合は自動的にログインページにリダイレクトされます。

---

## サポート

問題が解決しない場合は、開発者にお問い合わせください。

© 2025 TokuSearch. All rights reserved.

